cc.DOM={};
cc.DOM._addMethods=function(a){for(var b in cc.DOM.methods)a[b]=cc.DOM.methods[b];cc.defineGetterSetter(a,"x",a.getPositionX,a.setPositionX);cc.defineGetterSetter(a,"y",a.getPositionY,a.setPositionY);cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight);cc.defineGetterSetter(a,"anchorX",a._getAnchorX,a._setAnchorX);cc.defineGetterSetter(a,"anchorY",a._getAnchorY,a._setAnchorY);cc.defineGetterSetter(a,"scale",a.getScale,a.setScale);cc.defineGetterSetter(a,
"scaleX",a.getScaleX,a.setScaleX);cc.defineGetterSetter(a,"scaleY",a.getScaleY,a.getScaleY);cc.defineGetterSetter(a,"rotation",a.getRotation,a.setRotation);cc.defineGetterSetter(a,"skewX",a.getSkewX,a.setSkewX);cc.defineGetterSetter(a,"skewY",a.getSkewY,a.setSkewY);cc.defineGetterSetter(a,"visible",a.isVisible,a.setVisible);cc.defineGetterSetter(a,"parent",a.getParent,a.setParent);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity)};
cc.DOM.methods={setPosition:function(a,b){void 0===b?(this._position.x=a.x,this._position.y=a.y):(this._position.x=a,this._position.y=b);this.setNodeDirty();this.dom.translates(this._position.x,-this._position.y)},setPositionY:function(a){this._position.y=a;this.setNodeDirty();this.dom.translates(this._position.x,-this._position.y)},setPositionX:function(a){this._position.x=a;this.setNodeDirty();this.dom.translates(this._position.x,-this._position.y)},setScale:function(a,b){this._scaleX=a;this._scaleY=
b||a;this.setNodeDirty();this.dom.resize(this._scaleX,this._scaleY)},setScaleX:function(a){this._scaleX=a;this.setNodeDirty();this.dom.resize(this._scaleX,this._scaleY)},setScaleY:function(a){this._scaleY=a;this.setNodeDirty();this.dom.resize(this._scaleX,this._scaleY)},setAnchorPoint:function(a,b){var c=this._anchorPoint;void 0===b?(c.x=a.x,c.y=a.y):(c.x=a,c.y=b);var d=this._anchorPointInPoints,e=this._contentSize;d.x=e.width*c.x;d.y=e.height*c.y;this.dom.style[cc.$.pfx+"TransformOrigin"]=""+d.x+
"px "+-d.y+"px";this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):(this.dom.style.marginLeft=this.isToggler?0:-d.x+"px",this.dom.style.marginBottom=-d.y+"px");this.setNodeDirty()},_setAnchorX:function(a){var b=this._anchorPoint;a!==b.x&&(b.x=a,a=this._anchorPointInPoints,a.x=this._contentSize.width*b.x,this.dom.style[cc.$.pfx+"TransformOrigin"]=""+a.x+"px "+-a.y+"px",this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):this.dom.style.marginLeft=
this.isToggler?0:-a.x+"px",this.setNodeDirty())},_setAnchorY:function(a){var b=this._anchorPoint;a!==b.y&&(b.y=a,a=this._anchorPointInPoints,a.y=this._contentSize.height*b.y,this.dom.style[cc.$.pfx+"TransformOrigin"]=""+a.x+"px "+-a.y+"px",this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):this.dom.style.marginBottom=-a.y+"px",this.setNodeDirty())},setContentSize:function(a,b){var c=this._contentSize;void 0===b?(c.width=a.width,c.height=a.height):(c.width=a,c.height=b);
var d=this._anchorPointInPoints,e=this._anchorPoint;d.x=c.width*e.x;d.y=c.height*e.y;this.dom.width=c.width;this.dom.height=c.height;this.setAnchorPoint(this.getAnchorPoint());this.canvas&&(this.canvas.width=c.width,this.canvas.height=c.height);this.setNodeDirty();this.redraw()},_setWidth:function(a){var b=this._contentSize;a!==b.width&&(b.width=a,a=this._anchorPoint,this._anchorPointInPoints.x=b.width*a.x,this.dom.width=b.width,this.anchorX=a.x,this.canvas&&(this.canvas.width=b.width),this.setNodeDirty(),
this.redraw())},_setHeight:function(a){var b=this._contentSize;a!==b.height&&(b.height=a,a=this._anchorPoint,this._anchorPointInPoints.y=b.height*a.y,this.dom.height=b.height,this.anchorY=a.y,this.canvas&&(this.canvas.height=b.height),this.setNodeDirty(),this.redraw())},setRotation:function(a){this._rotation!=a&&(this._rotationX=this._rotationY=a,this._rotationRadiansX=this._rotationX*(Math.PI/180),this._rotationRadiansY=this._rotationY*(Math.PI/180),this.setNodeDirty(),this.dom.rotate(a))},setSkewX:function(a){this._skewX=
a;this.setNodeDirty();this.dom.setSkew(this._skewX,this._skewY)},setSkewY:function(a){this._skewY=a;this.setNodeDirty();this.dom.setSkew(this._skewX,this._skewY)},setVisible:function(a){this._visible=a;this.setNodeDirty();this.dom&&(this.dom.style.display=a?"block":"none")},_setLocalZOrder:function(a){this._localZOrder=a;this.setNodeDirty();this.dom&&(this.dom.zIndex=a)},setParent:function(a){this._parent=a;null!==a&&(a.setAnchorPoint(a.getAnchorPoint()),this.setNodeDirty(),cc.DOM.parentDOM(this))},
resume:function(){this.getScheduler().resumeTarget(this);this.getActionManager().resumeTarget(this);cc.eventManager.resumeTarget(this);this.dom&&!this.dom.parentNode&&(this.getParent()?cc.DOM.parentDOM(this):this.dom.appendTo(cc.container));this.dom&&(this.dom.style.visibility="visible")},pause:function(){this.getScheduler().pauseTarget(this);this.getActionManager().pauseTarget(this);cc.eventManager.pauseTarget(this);this.dom&&(this.dom.style.visibility="hidden")},cleanup:function(){this.stopAllActions();
this.unscheduleAllCallbacks();this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.cleanup);this.dom&&this.dom.remove()},removeFromParentAndCleanup:function(){this.dom.remove()},setOpacity:function(a){this._opacity=a;this.dom.style.opacity=a/255},redraw:function(){if(this.isSprite){var a=this._children;this._children=[];cc.Sprite.prototype.visit.call(this,this.ctx);this._children=a}else cc.Sprite.prototype.visit.call(this,this.ctx)}};
cc.DOM._resetEGLViewDiv=function(){var a=cc.$("#EGLViewDiv");if(a){var b=cc.view,c=b.getDesignResolutionSize(),d=b.getViewPortRect(),e=b.getFrameSize(),f=b.getDevicePixelRatio(),g=c.width,h=c.height;0===c.width&&0===c.height&&(g=e.width,h=e.height);c=d.width/f;0===d.width&&0===d.height&&(c=e.width);a.style.position="absolute";a.style.width=g+"px";a.style.maxHeight=h+"px";a.style.margin=0;a.resize(b.getScaleX()/f,b.getScaleY()/f);a.style.left=(c-g)/2+"px";a.style.bottom="0px"}};
cc.DOM.parentDOM=function(a){var b=a.getParent();if(!b||!a.dom)return!1;b.dom||(cc.DOM.placeHolder(b),b.setParent=cc.DOM.methods.setParent);a.dom.appendTo(b.dom);b.setAnchorPoint(b.getAnchorPoint());if(b.getParent())cc.DOM.parentDOM(b);else if(b.isRunning())if(a=cc.$("#EGLViewDiv"))b.dom.appendTo(a);else{a=cc.$new("div");a.id="EGLViewDiv";var c=cc.view,d=c.getDesignResolutionSize(),e=c.getViewPortRect(),f=c.getFrameSize(),g=c.getDevicePixelRatio(),h=d.width,k=d.height;0===d.width&&0===d.height&&(h=
f.width,k=f.height);d=e.width/g;0===e.width&&0===e.height&&(d=f.width);a.style.position="absolute";a.style.width=h+"px";a.style.maxHeight=k+"px";a.style.margin=0;a.resize(c.getScaleX()/g,c.getScaleY()/g);a.style.left=(d-h)/2+"px";a.style.bottom="0px";b.dom.appendTo(a);a.appendTo(cc.container)}return!0};
cc.DOM.setTransform=function(a){if(a.ctx)if(a.ctx.translate(a.getAnchorPointInPoints().x,a.getAnchorPointInPoints().y),a.isSprite){var b=a._children;a._children=[];cc.Sprite.prototype.visit.call(a,a.ctx);a._children=b}else cc.Sprite.prototype.visit.call(a,a.ctx);a.dom&&(a.dom.position.x=a.getPositionX(),a.dom.position.y=-a.getPositionY(),a.dom.rotation=a.getRotation(),a.dom.scale={x:a.getScaleX(),y:a.getScaleY()},a.dom.skew={x:a.getSkewX(),y:a.getSkewY()},a.setAnchorPoint&&a.setAnchorPoint(a.getAnchorPoint()),
a.dom.transforms())};cc.DOM.forSprite=function(a){a.dom=cc.$new("div");a.canvas=cc.$new("canvas");var b=a.getContentSize();a.canvas.width=b.width;a.canvas.height=b.height;a.dom.style.position="absolute";a.dom.style.bottom=0;a.ctx=a.canvas.getContext("2d");a.dom.appendChild(a.canvas);a.getParent()&&cc.DOM.parentDOM(a);a.isSprite=!0};
cc.DOM.placeHolder=function(a){a.dom=cc.$new("div");a.placeholder=!0;a.dom.style.position="absolute";a.dom.style.bottom=0;a.dom.style.width=(a.getContentSize().width||cc.director.getWinSize().width)+"px";a.dom.style.maxHeight=(a.getContentSize().height||cc.director.getWinSize().height)+"px";a.dom.style.margin=0;cc.DOM.setTransform(a);a.dom.transforms();cc.DOM._addMethods(a)};
cc.DOM.convert=function(a){if(1<arguments.length)cc.DOM.convert(arguments);else if(1==arguments.length&&!arguments[0].length)cc.DOM.convert([arguments[0]]);else for(var b=arguments[0],c=0;c<b.length;c++)b[c]instanceof cc.Sprite?b[c].dom||cc.DOM.forSprite(b[c]):cc.log("DOM converter only supports sprite and menuitems yet"),cc.DOM._addMethods(b[c]),b[c].visit=function(){},b[c].transform=function(){},cc.DOM.setTransform(b[c]),b[c].setVisible(b[c].isVisible())};cc.KEYBOARD_RETURNTYPE_DEFAULT=0;cc.KEYBOARD_RETURNTYPE_DONE=1;cc.KEYBOARD_RETURNTYPE_SEND=2;cc.KEYBOARD_RETURNTYPE_SEARCH=3;cc.KEYBOARD_RETURNTYPE_GO=4;cc.EDITBOX_INPUT_MODE_ANY=0;cc.EDITBOX_INPUT_MODE_EMAILADDR=1;cc.EDITBOX_INPUT_MODE_NUMERIC=2;cc.EDITBOX_INPUT_MODE_PHONENUMBER=3;cc.EDITBOX_INPUT_MODE_URL=4;cc.EDITBOX_INPUT_MODE_DECIMAL=5;cc.EDITBOX_INPUT_MODE_SINGLELINE=6;cc.EDITBOX_INPUT_FLAG_PASSWORD=0;cc.EDITBOX_INPUT_FLAG_SENSITIVE=1;cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD=2;
cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE=3;cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS=4;cc.EditBoxDelegate=cc.Class.extend({editBoxEditingDidBegin:function(a){},editBoxEditingDidEnd:function(a){},editBoxTextChanged:function(a,b){},editBoxReturn:function(a){}});
cc.EditBox=cc.ControlButton.extend({_domInputSprite:null,_delegate:null,_editBoxInputMode:cc.EDITBOX_INPUT_MODE_ANY,_editBoxInputFlag:cc.EDITBOX_INPUT_FLAG_SENSITIVE,_keyboardReturnType:cc.KEYBOARD_RETURNTYPE_DEFAULT,_text:"",_placeholderText:"",_textColor:null,_placeholderColor:null,_maxLength:50,_adjustHeight:18,_edTxt:null,_edFontSize:14,_edFontName:"Arial",_placeholderFontName:"",_placeholderFontSize:14,_tooltip:!1,_className:"EditBox",ctor:function(a){cc.ControlButton.prototype.ctor.call(this);
this._textColor=cc.color.WHITE;this._placeholderColor=cc.color.GRAY;this.setContentSize(a);var b=this._domInputSprite=new cc.Sprite;b.draw=function(){};this.addChild(b);var c=this,d=this._edTxt=cc.newElement("input");d.type="text";d.style.fontSize=this._edFontSize+"px";d.style.color="#000000";d.style.border=0;d.style.background="transparent";d.style.width="100%";d.style.height="100%";d.style.active=0;d.style.outline="medium";cc._addEventListener(d,"input",function(){c._delegate&&c._delegate.editBoxTextChanged&&
c._delegate.editBoxTextChanged(c,this.value)});cc._addEventListener(d,"keypress",function(a){a.keyCode===cc.KEY.enter&&(a.stopPropagation(),a.preventDefault(),cc._canvas.focus())});cc._addEventListener(d,"focus",function(){this.value==c._placeholderText&&(this.value="",this.style.fontSize=c._edFontSize+"px",this.style.color=cc.colorToHex(c._textColor));c._delegate&&c._delegate.editBoxEditingDidBegin&&c._delegate.editBoxEditingDidBegin(c)});cc._addEventListener(d,"blur",function(){""==this.value&&
(this.value=c._placeholderText,this.style.fontSize=c._placeholderFontSize+"px",this.style.color=cc.colorToHex(c._placeholderColor));c._delegate&&c._delegate.editBoxEditingDidEnd&&c._delegate.editBoxEditingDidEnd(c);c._delegate&&c._delegate.editBoxReturn&&c._delegate.editBoxReturn(c)});cc.DOM.convert(b);b.dom.appendChild(d);b.dom.showTooltipDiv=!1;b.dom.style.width=a.width-6+"px";b.dom.style.height=a.height-6+"px";b.canvas.remove()},setFont:function(a,b){this._edFontSize=b;this._edFontName=a;this._setFontToEditBox()},
_setFont:function(a){if(a=cc.LabelTTF._fontStyleRE.exec(a))this._edFontSize=parseInt(a[1]),this._edFontName=a[2],this._setFontToEditBox()},setFontName:function(a){this._edFontName=a;this._setFontToEditBox()},setFontSize:function(a){this._edFontSize=a;this._setFontToEditBox()},_setFontToEditBox:function(){this._edTxt.value!=this._placeholderText&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px")},setText:function(a){cc.log("Please use the setString");
null!=a&&(""==a?(this._edTxt.value=this._placeholderText,this._edTxt.style.color=cc.colorToHex(this._placeholderColor)):(this._edTxt.value=a,this._edTxt.style.color=cc.colorToHex(this._textColor)))},setString:function(a){null!=a&&(""==a?(this._edTxt.value=this._placeholderText,this._edTxt.style.color=cc.colorToHex(this._placeholderColor)):(this._edTxt.value=a,this._edTxt.style.color=cc.colorToHex(this._textColor)))},setFontColor:function(a){this._textColor=a;this._edTxt.value!=this._placeholderText&&
(this._edTxt.style.color=cc.colorToHex(a))},setMaxLength:function(a){!isNaN(a)&&0<a&&(this._maxLength=a,this._edTxt.maxLength=a)},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(a){if(null!=a){var b=this._placeholderText;this._placeholderText=a;this._edTxt.value==b&&(this._edTxt.value=a,this._edTxt.style.color=cc.colorToHex(this._placeholderColor),this._setPlaceholderFontToEditText())}},setPlaceholderFont:function(a,b){this._placeholderFontName=a;this._placeholderFontSize=
b;this._setPlaceholderFontToEditText()},_setPlaceholderFont:function(a){if(a=cc.LabelTTF._fontStyleRE.exec(a))this._placeholderFontName=a[2],this._placeholderFontSize=parseInt(a[1]),this._setPlaceholderFontToEditText()},setPlaceholderFontName:function(a){this._placeholderFontName=a;this._setPlaceholderFontToEditText()},setPlaceholderFontSize:function(a){this._placeholderFontSize=a;this._setPlaceholderFontToEditText()},_setPlaceholderFontToEditText:function(){this._edTxt.value==this._placeholderText&&
(this._edTxt.style.fontFamily=this._placeholderFontName,this._edTxt.style.fontSize=this._placeholderFontSize+"px")},setPlaceholderFontColor:function(a){this._placeholderColor=a;this._edTxt.value==this._placeholderText&&(this._edTxt.style.color=cc.colorToHex(a))},setInputFlag:function(a){this._editBoxInputFlag=a;this._edTxt.type=a==cc.EDITBOX_INPUT_FLAG_PASSWORD?"password":"text"},getText:function(){cc.log("Please use the getString");return this._edTxt.value},getString:function(){return this._edTxt.value},
initWithSizeAndBackgroundSprite:function(a,b){return this.initWithBackgroundSprite(b)?(this._domInputSprite.x=3,this._domInputSprite.y=3,this.setZoomOnTouchDown(!1),this.setPreferredSize(a),this.y=this.x=0,this._addTargetWithActionForControlEvent(this,this.touchDownAction,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),!0):!1},setDelegate:function(a){this._delegate=a},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(a){this._editBoxInputMode=a},setReturnType:function(a){this._keyboardReturnType=
a},keyboardWillShow:function(a){var b=cc.EditBox.getRect(this);b.y-=4;b.intersectsRect(a.end)?this._adjustHeight=a.end.getMaxY()-b.getMinY():cc.log("needn't to adjust view layout.")},keyboardDidShow:function(a){},keyboardWillHide:function(a){},keyboardDidHide:function(a){},touchDownAction:function(a,b){},initWithBackgroundColor:function(a,b){this._edWidth=a.width;this.dom.style.width=this._edWidth.toString()+"px";this._edHeight=a.height;this.dom.style.height=this._edHeight.toString()+"px";this.dom.style.backgroundColor=
cc.colorToHex(b)}});var _p=cc.EditBox.prototype;cc.defineGetterSetter(_p,"font",null,_p._setFont);cc.defineGetterSetter(_p,"fontName",null,_p.setFontName);cc.defineGetterSetter(_p,"fontSize",null,_p.setFontSize);cc.defineGetterSetter(_p,"fontColor",null,_p.setFontColor);cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength);cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);
cc.defineGetterSetter(_p,"placeHolderFont",null,_p._setPlaceholderFont);cc.defineGetterSetter(_p,"placeHolderFontName",null,_p.setPlaceholderFontName);cc.defineGetterSetter(_p,"placeHolderFontSize",null,_p.setPlaceholderFontSize);cc.defineGetterSetter(_p,"placeHolderFontColor",null,_p.setPlaceholderFontColor);cc.defineGetterSetter(_p,"inputFlag",null,_p.setInputFlag);cc.defineGetterSetter(_p,"delegate",null,_p.setDelegate);cc.defineGetterSetter(_p,"inputMode",null,_p.setInputMode);
cc.defineGetterSetter(_p,"returnType",null,_p.setReturnType);_p=null;cc.EditBox.getRect=function(a){var b=a.getContentSize(),b=cc.rect(0,0,b.width,b.height);return cc.RectApplyAffineTransform(b,a.nodeToWorldTransform())};cc.EditBox.create=function(a,b,c,d){var e=new cc.EditBox(a);e.initWithSizeAndBackgroundSprite(a,b)&&(c&&e.setBackgroundSpriteForState(c,cc.CONTROL_STATE_HIGHLIGHTED),d&&e.setBackgroundSpriteForState(d,cc.CONTROL_STATE_DISABLED));return e};