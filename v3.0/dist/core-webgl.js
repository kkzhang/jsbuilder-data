var cc=cc||{};cc._tmp=cc._tmp||{},cc._tmp.WebGLColor=function(){cc.color=function(a,b,c,d,e,f){if(void 0===a)return new cc.Color(0,0,0,255,e,f);if(cc.isString(a)){var g=cc.hexToColor(a);return new cc.Color(g.r,g.g,g.b,g.a)}return cc.isObject(a)?new cc.Color(a.r,a.g,a.b,a.a,a.arrayBuffer,a.offset):new cc.Color(a,b,c,d,e,f)},cc.Color=function(a,b,c,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc.Color.BYTES_PER_ELEMENT),this._offset=f||0;var g=this._arrayBuffer,h=this._offset,i=Uint8Array.BYTES_PER_ELEMENT;this._rU8=new Uint8Array(g,h,1),this._gU8=new Uint8Array(g,h+i,1),this._bU8=new Uint8Array(g,h+2*i,1),this._aU8=new Uint8Array(g,h+3*i,1),this._rU8[0]=a||0,this._gU8[0]=b||0,this._bU8[0]=c||0,this._aU8[0]=null==d?255:d,void 0===d&&(this.a_undefined=!0)},cc.Color.BYTES_PER_ELEMENT=4;var a=cc.Color.prototype;a._getR=function(){return this._rU8[0]},a._setR=function(a){this._rU8[0]=0>a?0:a},a._getG=function(){return this._gU8[0]},a._setG=function(a){this._gU8[0]=0>a?0:a},a._getB=function(){return this._bU8[0]},a._setB=function(a){this._bU8[0]=0>a?0:a},a._getA=function(){return this._aU8[0]},a._setA=function(a){this._aU8[0]=0>a?0:a},a.r,cc.defineGetterSetter(a,"r",a._getR,a._setR),a.g,cc.defineGetterSetter(a,"g",a._getG,a._setG),a.b,cc.defineGetterSetter(a,"b",a._getB,a._setB),a.a,cc.defineGetterSetter(a,"a",a._getA,a._setA),cc.Vertex2F=function(a,b,c,d){this._arrayBuffer=c||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=d||0,this._xF32=new Float32Array(this._arrayBuffer,this._offset,1),this._yF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._xF32[0]=a||0,this._yF32[0]=b||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,Object.defineProperties(cc.Vertex2F.prototype,{x:{get:function(){return this._xF32[0]},set:function(a){this._xF32[0]=a},enumerable:!0},y:{get:function(){return this._yF32[0]},set:function(a){this._yF32[0]=a},enumerable:!0}}),cc.Vertex3F=function(a,b,c,d,e){this._arrayBuffer=d||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=e||0;var f=this._arrayBuffer,g=this._offset;this._xF32=new Float32Array(f,g,1),this._xF32[0]=a||0,this._yF32=new Float32Array(f,g+Float32Array.BYTES_PER_ELEMENT,1),this._yF32[0]=b||0,this._zF32=new Float32Array(f,g+2*Float32Array.BYTES_PER_ELEMENT,1),this._zF32[0]=c||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,Object.defineProperties(cc.Vertex3F.prototype,{x:{get:function(){return this._xF32[0]},set:function(a){this._xF32[0]=a},enumerable:!0},y:{get:function(){return this._yF32[0]},set:function(a){this._yF32[0]=a},enumerable:!0},z:{get:function(){return this._zF32[0]},set:function(a){this._zF32[0]=a},enumerable:!0}}),cc.Tex2F=function(a,b,c,d){this._arrayBuffer=c||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=d||0,this._uF32=new Float32Array(this._arrayBuffer,this._offset,1),this._vF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._uF32[0]=a||0,this._vF32[0]=b||0},cc.Tex2F.BYTES_PER_ELEMENT=8,Object.defineProperties(cc.Tex2F.prototype,{u:{get:function(){return this._uF32[0]},set:function(a){this._uF32[0]=a},enumerable:!0},v:{get:function(){return this._vF32[0]},set:function(a){this._vF32[0]=a},enumerable:!0}}),cc.Quad2=function(a,b,c,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=f||0;var g=this._arrayBuffer,h=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=a?new cc.Vertex2F(a.x,a.y,g,0):new cc.Vertex2F(0,0,g,0),this._tr=b?new cc.Vertex2F(b.x,b.y,g,h):new cc.Vertex2F(0,0,g,h),this._bl=c?new cc.Vertex2F(c.x,c.y,g,2*h):new cc.Vertex2F(0,0,g,2*h),this._br=d?new cc.Vertex2F(d.x,d.y,g,3*h):new cc.Vertex2F(0,0,g,3*h)},cc.Quad2.BYTES_PER_ELEMENT=32,cc.Quad3=function(a,b,c,d){this.bl=a||new cc.Vertex3F(0,0,0),this.br=b||new cc.Vertex3F(0,0,0),this.tl=c||new cc.Vertex3F(0,0,0),this.tr=d||new cc.Vertex3F(0,0,0)},Object.defineProperties(cc.Quad2.prototype,{tl:{get:function(){return this._tl},set:function(a){this._tl.x=a.x,this._tl.y=a.y},enumerable:!0},tr:{get:function(){return this._tr},set:function(a){this._tr.x=a.x,this._tr.y=a.y},enumerable:!0},bl:{get:function(){return this._bl},set:function(a){this._bl.x=a.x,this._bl.y=a.y},enumerable:!0},br:{get:function(){return this._br},set:function(a){this._br.x=a.x,this._br.y=a.y},enumerable:!0}}),cc.V3F_C4B_T2F=function(a,b,c,d,e){this._arrayBuffer=d||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=e||0;var f=this._arrayBuffer,g=this._offset,h=cc.Vertex3F.BYTES_PER_ELEMENT;this._vertices=a?new cc.Vertex3F(a.x,a.y,a.z,f,g):new cc.Vertex3F(0,0,0,f,g),this._colors=b?cc.color(b.r,b.g,b.b,b.a,f,g+h):cc.color(0,0,0,0,f,g+h),this._texCoords=c?new cc.Tex2F(c.u,c.v,f,g+h+cc.Color.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,f,g+h+cc.Color.BYTES_PER_ELEMENT)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,Object.defineProperties(cc.V3F_C4B_T2F.prototype,{vertices:{get:function(){return this._vertices},set:function(a){var b=this._vertices;b.x=a.x,b.y=a.y,b.z=a.z},enumerable:!0},colors:{get:function(){return this._colors},set:function(a){var b=this._colors;b.r=a.r,b.g=a.g,b.b=a.b,b.a=a.a},enumerable:!0},texCoords:{get:function(){return this._texCoords},set:function(a){this._texCoords.u=a.u,this._texCoords.v=a.v},enumerable:!0}}),cc.V3F_C4B_T2F_Quad=function(a,b,c,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=f||0;var g=this._arrayBuffer,h=this._offset,i=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=a?new cc.V3F_C4B_T2F(a.vertices,a.colors,a.texCoords,g,h):new cc.V3F_C4B_T2F(null,null,null,g,h),this._bl=b?new cc.V3F_C4B_T2F(b.vertices,b.colors,b.texCoords,g,h+i):new cc.V3F_C4B_T2F(null,null,null,g,h+i),this._tr=c?new cc.V3F_C4B_T2F(c.vertices,c.colors,c.texCoords,g,h+2*i):new cc.V3F_C4B_T2F(null,null,null,g,h+2*i),this._br=d?new cc.V3F_C4B_T2F(d.vertices,d.colors,d.texCoords,g,h+3*i):new cc.V3F_C4B_T2F(null,null,null,g,h+3*i)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,Object.defineProperties(cc.V3F_C4B_T2F_Quad.prototype,{tl:{get:function(){return this._tl},set:function(a){var b=this._tl;b.vertices=a.vertices,b.colors=a.colors,b.texCoords=a.texCoords},enumerable:!0},bl:{get:function(){return this._bl},set:function(a){var b=this._bl;b.vertices=a.vertices,b.colors=a.colors,b.texCoords=a.texCoords},enumerable:!0},tr:{get:function(){return this._tr},set:function(a){var b=this._tr;b.vertices=a.vertices,b.colors=a.colors,b.texCoords=a.texCoords},enumerable:!0},br:{get:function(){return this._br},set:function(a){var b=this._br;b.vertices=a.vertices,b.colors=a.colors,b.texCoords=a.texCoords},enumerable:!0},arrayBuffer:{get:function(){return this._arrayBuffer},enumerable:!0}}),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(a){if(!a)return cc.V3F_C4B_T2F_QuadZero();var b=a.tl,c=a.bl,d=a.tr,e=a.br;return{tl:{vertices:{x:b.vertices.x,y:b.vertices.y,z:b.vertices.z},colors:{r:b.colors.r,g:b.colors.g,b:b.colors.b,a:b.colors.a},texCoords:{u:b.texCoords.u,v:b.texCoords.v}},bl:{vertices:{x:c.vertices.x,y:c.vertices.y,z:c.vertices.z},colors:{r:c.colors.r,g:c.colors.g,b:c.colors.b,a:c.colors.a},texCoords:{u:c.texCoords.u,v:c.texCoords.v}},tr:{vertices:{x:d.vertices.x,y:d.vertices.y,z:d.vertices.z},colors:{r:d.colors.r,g:d.colors.g,b:d.colors.b,a:d.colors.a},texCoords:{u:d.texCoords.u,v:d.texCoords.v}},br:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;c++)b.push(cc.V3F_C4B_T2F_QuadCopy(a[c]));return b},cc.V2F_C4B_T2F=function(a,b,c,d,e){this._arrayBuffer=d||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=e||0;var f=this._arrayBuffer,g=this._offset,h=cc.Vertex2F.BYTES_PER_ELEMENT;this._vertices=a?new cc.Vertex2F(a.x,a.y,f,g):new cc.Vertex2F(0,0,f,g),this._colors=b?cc.color(b.r,b.g,b.b,b.a,f,g+h):cc.color(0,0,0,0,f,g+h),this._texCoords=c?new cc.Tex2F(c.u,c.v,f,g+h+cc.Color.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,f,g+h+cc.Color.BYTES_PER_ELEMENT)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,Object.defineProperties(cc.V2F_C4B_T2F.prototype,{vertices:{get:function(){return this._vertices},set:function(a){this._vertices.x=a.x,this._vertices.y=a.y},enumerable:!0},colors:{get:function(){return this._colors},set:function(a){var b=this._colors;b.r=a.r,b.g=a.g,b.b=a.b,b.a=a.a},enumerable:!0},texCoords:{get:function(){return this._texCoords},set:function(a){this._texCoords.u=a.u,this._texCoords.v=a.v},enumerable:!0}}),cc.V2F_C4B_T2F_Triangle=function(a,b,c,d,e){this._arrayBuffer=d||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=e||0;var f=this._arrayBuffer,g=this._offset,h=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=a?new cc.V2F_C4B_T2F(a.vertices,a.colors,a.texCoords,f,g):new cc.V2F_C4B_T2F(null,null,null,f,g),this._b=b?new cc.V2F_C4B_T2F(b.vertices,b.colors,b.texCoords,f,g+h):new cc.V2F_C4B_T2F(null,null,null,f,g+h),this._c=c?new cc.V2F_C4B_T2F(c.vertices,c.colors,c.texCoords,f,g+2*h):new cc.V2F_C4B_T2F(null,null,null,f,g+2*h)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,Object.defineProperties(cc.V2F_C4B_T2F_Triangle.prototype,{a:{get:function(){return this._a},set:function(a){var b=this._a;b.vertices=a.vertices,b.colors=a.colors,b.texCoords=a.texCoords},enumerable:!0},b:{get:function(){return this._b},set:function(a){var b=this._b;b.vertices=a.vertices,b.colors=a.colors,b.texCoords=a.texCoords},enumerable:!0},c:{get:function(){return this._c},set:function(a){var b=this._c;b.vertices=a.vertices,b.colors=a.colors,b.texCoords=a.texCoords},enumerable:!0}})},cc._tmp.WebGLCCNode=function(){var a=cc.Node.prototype;a._transform4x4=null,a._stackMatrix=null,a._glServerState=null,a._camera=null,a.ctor=function(){var a=this;a._initNode();var b=new cc.kmMat4;b.mat[2]=b.mat[3]=b.mat[6]=b.mat[7]=b.mat[8]=b.mat[9]=b.mat[11]=b.mat[14]=0,b.mat[10]=b.mat[15]=1,a._transform4x4=b,a._glServerState=0,a._stackMatrix=new cc.kmMat4},a.setNodeDirty=function(){this._transformDirty===!1&&(this._transformDirty=this._inverseDirty=!0)},a.visit=function(){var a=this;if(a._visible){var b,c=cc._renderContext,d=cc.current_stack;d.stack.push(d.top),cc.kmMat4Assign(a._stackMatrix,d.top),d.top=a._stackMatrix;var e=a.grid;e&&e._active&&e.beforeDraw(),a.transform();var f=a._children;if(f&&f.length>0){var g=f.length;for(a.sortAllChildren(),b=0;g>b&&(f[b]&&f[b]._localZOrder<0);b++)f[b].visit();for(a.draw(c);g>b;b++)f[b]&&f[b].visit()}else a.draw(c);a.arrivalOrder=0,e&&e._active&&e.afterDraw(a),d.top=d.stack.pop()}},a.transform=function(){var a=this,b=a._transform4x4,c=cc.current_stack.top,d=a.nodeToParentTransform(),e=b.mat;if(e[0]=d.a,e[4]=d.c,e[12]=d.tx,e[1]=d.b,e[5]=d.d,e[13]=d.ty,e[14]=a._vertexZ,cc.kmMat4Multiply(c,c,b),null!=a._camera&&(null==a.grid||!a.grid.isActive())){var f=a._anchorPointInPoints.x,g=a._anchorPointInPoints.y,h=0!==f||0!==g;h?(cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(f=0|f,g=0|g),cc.kmGLTranslatef(f,g,0),a._camera.locate(),cc.kmGLTranslatef(-f,-g,0)):a._camera.locate()}},a.getNodeToParentTransform=a._getNodeToParentTransformForWebGL},cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_isLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,_loadedEventListeners:null,ctor:function(){this._contentSize=cc.size(0,0),this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj),cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(a){this.maxS=a},getMaxT:function(){return this.maxT},setMaxT:function(a){this.maxT=a},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(a){this.shaderProgram=a},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){var a=this;return"<cc.Texture2D | Name = "+a._name+" | Dimensions = "+a._pixelsWide+" x "+a._pixelsHigh+" | Coordinates = ("+a.maxS+", "+a.maxT+")>"},releaseData:function(a){a=null},keepData:function(a){return a},initWithData:function(a,b,c,d,e){var f=this,g=cc.Texture2D,h=cc._renderContext,i=h.RGBA,j=h.UNSIGNED_BYTE,k=cc.Texture2D._B[b],l=c*k/8;switch(l%8===0?h.pixelStorei(h.UNPACK_ALIGNMENT,8):l%4===0?h.pixelStorei(h.UNPACK_ALIGNMENT,4):l%2===0?h.pixelStorei(h.UNPACK_ALIGNMENT,2):h.pixelStorei(h.UNPACK_ALIGNMENT,1),f._webTextureObj=h.createTexture(),cc.glBindTexture2D(f),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),b){case g.PIXEL_FORMAT_RGBA8888:i=h.RGBA;break;case g.PIXEL_FORMAT_RGB888:i=h.RGB;break;case g.PIXEL_FORMAT_RGBA4444:j=h.UNSIGNED_SHORT_4_4_4_4;break;case g.PIXEL_FORMAT_RGB5A1:j=h.UNSIGNED_SHORT_5_5_5_1;break;case g.PIXEL_FORMAT_RGB565:j=h.UNSIGNED_SHORT_5_6_5;break;case g.PIXEL_FORMAT_AI88:i=h.LUMINANCE_ALPHA;break;case g.PIXEL_FORMAT_A8:i=h.ALPHA;break;case g.PIXEL_FORMAT_I8:i=h.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}return h.texImage2D(h.TEXTURE_2D,0,i,c,d,0,i,j,a),f._contentSize.width=e.width,f._contentSize.height=e.height,f._pixelsWide=c,f._pixelsHigh=d,f._pixelFormat=b,f.maxS=e.width/c,f.maxT=e.height/d,f._hasPremultipliedAlpha=!1,f._hasMipmaps=!1,f.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),f._isLoaded=!0,!0},drawAtPoint:function(a){var b=this,c=[0,b.maxT,b.maxS,b.maxT,0,0,b.maxS,0],d=b._pixelsWide*b.maxS,e=b._pixelsHigh*b.maxT,f=[a.x,a.y,0,d+a.x,a.y,0,a.x,e+a.y,0,d+a.x,e+a.y,0];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),b._shaderProgram.use(),b._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(b);var g=cc._renderContext;g.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,g.FLOAT,!1,0,f),g.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,g.FLOAT,!1,0,c),g.drawArrays(g.TRIANGLE_STRIP,0,4)},drawInRect:function(a){var b=this,c=[0,b.maxT,b.maxS,b.maxT,0,0,b.maxS,0],d=[a.x,a.y,a.x+a.width,a.y,a.x,a.y+a.height,a.x+a.width,a.y+a.height];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),b._shaderProgram.use(),b._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(b);var e=cc._renderContext;e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,d),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,0,c),e.drawArrays(e.TRIANGLE_STRIP,0,4)},initWithImage:function(a){if(null==a)return cc.log(cc._LogInfos.Texture2D_initWithImage),!1;var b=a.getWidth(),c=a.getHeight(),d=cc.configuration.getMaxTextureSize();return b>d||c>d?(cc.log(cc._LogInfos.Texture2D_initWithImage_2,b,c,d,d),!1):(this._isLoaded=!0,this._initPremultipliedATextureWithImage(a,b,c))},initWithElement:function(a){a&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=a)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._isLoaded},handleLoadedTexture:function(){var a=this;if(cc._rendererInitialized){if(!a._htmlElementObj){var b=cc.loader.getRes(a.url);if(!b)return;a.initWithElement(b)}if(a._htmlElementObj.width&&a._htmlElementObj.height){a._isLoaded=!0;var c=cc._renderContext;cc.glBindTexture2D(a),c.pixelStorei(c.UNPACK_ALIGNMENT,4),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a._htmlElementObj),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),a.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),cc.glBindTexture2D(null);var d=a._htmlElementObj.width,e=a._htmlElementObj.height;a._pixelsWide=a._contentSize.width=d,a._pixelsHigh=a._contentSize.height=e,a._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,a.maxS=1,a.maxT=1,a._hasPremultipliedAlpha=!1,a._hasMipmaps=!1,this._callLoadedEventCallbacks()}}},initWithString:function(){return cc.log(cc._LogInfos.Texture2D_initWithString),null},initWithETCFile:function(){return cc.log(cc._LogInfos.Texture2D_initWithETCFile_2),!1},initWithPVRFile:function(){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2),!1},initWithPVRTCData:function(){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2),!1},setTexParameters:function(a,b,c,d){var e=this,f=cc._renderContext;void 0!==b&&(a={minFilter:a,magFilter:b,wrapS:c,wrapT:d}),cc.assert(e._pixelsWide==cc.NextPOT(e._pixelsWide)&&e._pixelsHigh==cc.NextPOT(e._pixelsHigh)||a.wrapS==f.CLAMP_TO_EDGE&&a.wrapT==f.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,a.minFilter),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,a.magFilter),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a.wrapS),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a.wrapT)},setAntiAliasTexParameters:function(){var a=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)},setAliasTexParameters:function(){var a=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST_MIPMAP_NEAREST):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)},generateMipmap:function(){var a=this;cc.assert(a._pixelsWide==cc.NextPOT(a._pixelsWide)&&a._pixelsHigh==cc.NextPOT(a._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(a),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),a._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(a){a=a||this._pixelFormat;var b=cc.Texture2D._B[a];return null!=b?b:(cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,a),-1)},_initPremultipliedATextureWithImage:function(a,b,c){var d,e=cc.Texture2D,f=a.getData(),g=null,h=null,i=a.hasAlpha(),j=cc.size(a.getWidth(),a.getHeight()),k=e.defaultPixelFormat,l=a.getBitsPerComponent();i||(l>=8?k=e.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),k=e.PIXEL_FORMAT_RGB565));var m=b*c;if(k==e.PIXEL_FORMAT_RGB565)if(i)for(f=new Uint16Array(b*c),g=a.getData(),d=0;m>d;++d)f[d]=(g[d]>>0&255)>>3<<11|(g[d]>>8&255)>>2<<5|(g[d]>>16&255)>>3<<0;else for(f=new Uint16Array(b*c),h=a.getData(),d=0;m>d;++d)f[d]=(255&h[d])>>3<<11|(255&h[d])>>2<<5|(255&h[d])>>3<<0;else if(k==e.PIXEL_FORMAT_RGBA4444)for(f=new Uint16Array(b*c),g=a.getData(),d=0;m>d;++d)f[d]=(g[d]>>0&255)>>4<<12|(g[d]>>8&255)>>4<<8|(g[d]>>16&255)>>4<<4|(g[d]>>24&255)>>4<<0;else if(k==e.PIXEL_FORMAT_RGB5A1)for(f=new Uint16Array(b*c),g=a.getData(),d=0;m>d;++d)f[d]=(g[d]>>0&255)>>3<<11|(g[d]>>8&255)>>3<<6|(g[d]>>16&255)>>3<<1|(g[d]>>24&255)>>7<<0;else if(k==e.PIXEL_FORMAT_A8)for(f=new Uint8Array(b*c),g=a.getData(),d=0;m>d;++d)f[d]=g>>24&255;if(i&&k==e.PIXEL_FORMAT_RGB888)for(g=a.getData(),f=new Uint8Array(b*c*3),d=0;m>d;++d)f[3*d]=g>>0&255,f[3*d+1]=g>>8&255,f[3*d+2]=g>>16&255;return this.initWithData(f,k,b,c,j),f!=a.getData()&&(f=null),this._hasPremultipliedAlpha=a.isPremultipliedAlpha(),!0},addLoadedEventListener:function(a,b){this._loadedEventListeners||(this._loadedEventListeners=[]),this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},removeLoadedEventListener:function(a){if(this._loadedEventListeners)for(var b=this._loadedEventListeners,c=0;c<b.length;c++){var d=b[c];d.eventTarget==a&&b.splice(c,1)}},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){for(var a=this._loadedEventListeners,b=0,c=a.length;c>b;b++){var d=a[b];d.eventCallback.call(d.eventTarget,this)}a.length=0}}})},cc._tmp.WebGLTextureAtlas=function(){var a=cc.TextureAtlas.prototype;a._setupVBO=function(){var a=this,b=cc._renderContext;a._buffersVBO[0]=b.createBuffer(),a._buffersVBO[1]=b.createBuffer(),a._quadsWebBuffer=b.createBuffer(),a._mapBuffers()},a._mapBuffers=function(){var a=this,b=cc._renderContext;b.bindBuffer(b.ARRAY_BUFFER,a._quadsWebBuffer),b.bufferData(b.ARRAY_BUFFER,a._quadsArrayBuffer,b.DYNAMIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a._buffersVBO[1]),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a._indices,b.STATIC_DRAW)},a.drawNumberOfQuads=function(a,b){var c=this;if(b=b||0,0!==a&&c.texture&&c.texture.isLoaded()){var d=cc._renderContext;cc.glBindTexture2D(c.texture),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),d.bindBuffer(d.ARRAY_BUFFER,c._quadsWebBuffer),c.dirty&&d.bufferData(d.ARRAY_BUFFER,c._quadsArrayBuffer,d.DYNAMIC_DRAW),d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,d.FLOAT,!1,24,0),d.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,d.UNSIGNED_BYTE,!0,24,12),d.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,d.FLOAT,!1,24,16),c.dirty&&(c.dirty=!1),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c._buffersVBO[1]),cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?d.drawElements(d.TRIANGLE_STRIP,6*a,d.UNSIGNED_SHORT,6*b*c._indices.BYTES_PER_ELEMENT):d.drawElements(d.TRIANGLES,6*a,d.UNSIGNED_SHORT,6*b*c._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}}},cc._tmp.WebGLTextureCache=function(){var a=cc.textureCache;a.handleLoadedTexture=function(a){var b=this._textures;cc._rendererInitialized||(b=this._loadedTexturesBefore);var c=b[a];c||(c=b[a]=new cc.Texture2D,c.url=a),c.handleLoadedTexture()},a.addImage=function(a,b,c){cc.assert(a,cc._LogInfos.Texture2D_addImage_2);var d=this._textures;cc._rendererInitialized||(d=this._loadedTexturesBefore);var e=d[a]||d[cc.loader._aliases[a]];return e?(b&&b.call(c,e),e):(cc.loader.getRes(a)||(cc.loader._checkIsImageURL(a)?cc.loader.load(a,function(){b&&b.call(c)}):cc.loader.loadImg(a,function(d,f){return d?b?b(d):d:(cc.loader.cache[a]=f,cc.textureCache.handleLoadedTexture(a),void(b&&b.call(c,e)))})),e=d[a]=new cc.Texture2D,e.url=a,e)},delete a},cc._tmp.LayerDefineForWebGL=function(){var a=cc.Layer.prototype;a.bake=function(){},a.unbake=function(){},a.visit=cc.Node.prototype.visit},cc._tmp.WebGLLayerColor=function(){var a=cc.LayerColor.prototype;a._squareVertices=null,a._squareColors=null,a._verticesFloat32Buffer=null,a._colorsUint8Buffer=null,a._squareVerticesAB=null,a._squareColorsAB=null,a.ctor=function(a,b,c){var d=this;d._squareVerticesAB=new ArrayBuffer(32),d._squareColorsAB=new ArrayBuffer(16);var e=d._squareVerticesAB,f=d._squareColorsAB,g=cc.Vertex2F.BYTES_PER_ELEMENT,h=cc.Color.BYTES_PER_ELEMENT;d._squareVertices=[new cc.Vertex2F(0,0,e,0),new cc.Vertex2F(0,0,e,g),new cc.Vertex2F(0,0,e,2*g),new cc.Vertex2F(0,0,e,3*g)],d._squareColors=[cc.color(0,0,0,255,f,0),cc.color(0,0,0,255,f,h),cc.color(0,0,0,255,f,2*h),cc.color(0,0,0,255,f,3*h)],d._verticesFloat32Buffer=cc._renderContext.createBuffer(),d._colorsUint8Buffer=cc._renderContext.createBuffer(),cc.Layer.prototype.ctor.call(d),d._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),cc.LayerColor.prototype.init.call(d,a,b,c)},a.setContentSize=function(a,b){var c=this._squareVertices;void 0===b?(c[1].x=a.width,c[2].y=a.height,c[3].x=a.width,c[3].y=a.height):(c[1].x=a,c[2].y=b,c[3].x=a,c[3].y=b),this._bindLayerVerticesBufferData(),cc.Layer.prototype.setContentSize.call(this,a,b)},a._setWidth=function(a){var b=this._squareVertices;b[1].x=a,b[3].x=a,this._bindLayerVerticesBufferData(),cc.Layer.prototype._setWidth.call(this,a)},a._setHeight=function(a){var b=this._squareVertices;b[2].y=a,b[3].y=a,this._bindLayerVerticesBufferData(),cc.Layer.prototype._setHeight.call(this,a)},a._updateColor=function(){for(var a=this._displayedColor,b=this._displayedOpacity,c=this._squareColors,d=0;4>d;d++)c[d].r=a.r,c[d].g=a.g,c[d].b=a.b,c[d].a=b;this._bindLayerColorsBufferData()},a.draw=function(a){var b=a||cc._renderContext;cc.nodeDrawSetup(this),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),b.bindBuffer(b.ARRAY_BUFFER,this._verticesFloat32Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._colorsUint8Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,0,0),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),b.drawArrays(b.TRIANGLE_STRIP,0,4)},a._bindLayerVerticesBufferData=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._verticesFloat32Buffer),a.bufferData(a.ARRAY_BUFFER,this._squareVerticesAB,a.STATIC_DRAW)},a._bindLayerColorsBufferData=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._colorsUint8Buffer),a.bufferData(a.ARRAY_BUFFER,this._squareColorsAB,a.STATIC_DRAW)}},cc._tmp.WebGLLayerGradient=function(){var a=cc.LayerGradient.prototype;a.draw=cc.LayerColor.prototype.draw,a._updateColor=function(){var a=this,b=a._alongVector,c=cc.pLength(b);if(0!==c){var d=Math.sqrt(2),e=cc.p(b.x/c,b.y/c);if(a._compressedInterpolation){var f=1/(Math.abs(e.x)+Math.abs(e.y));e=cc.pMult(e,f*d)}var g=a._displayedOpacity/255,h=a._displayedColor,i=a._endColor,j={r:h.r,g:h.g,b:h.b,a:a._startOpacity*g},k={r:i.r,g:i.g,b:i.b,a:a._endOpacity*g},l=a._squareColors,m=l[0],n=l[1],o=l[2],p=l[3];m.r=k.r+(j.r-k.r)*((d+e.x+e.y)/(2*d)),m.g=k.g+(j.g-k.g)*((d+e.x+e.y)/(2*d)),m.b=k.b+(j.b-k.b)*((d+e.x+e.y)/(2*d)),m.a=k.a+(j.a-k.a)*((d+e.x+e.y)/(2*d)),n.r=k.r+(j.r-k.r)*((d-e.x+e.y)/(2*d)),n.g=k.g+(j.g-k.g)*((d-e.x+e.y)/(2*d)),n.b=k.b+(j.b-k.b)*((d-e.x+e.y)/(2*d)),n.a=k.a+(j.a-k.a)*((d-e.x+e.y)/(2*d)),o.r=k.r+(j.r-k.r)*((d+e.x-e.y)/(2*d)),o.g=k.g+(j.g-k.g)*((d+e.x-e.y)/(2*d)),o.b=k.b+(j.b-k.b)*((d+e.x-e.y)/(2*d)),o.a=k.a+(j.a-k.a)*((d+e.x-e.y)/(2*d)),p.r=k.r+(j.r-k.r)*((d-e.x-e.y)/(2*d)),p.g=k.g+(j.g-k.g)*((d-e.x-e.y)/(2*d)),p.b=k.b+(j.b-k.b)*((d-e.x-e.y)/(2*d)),p.a=k.a+(j.a-k.a)*((d-e.x-e.y)/(2*d)),a._bindLayerColorsBufferData()}}},cc._tmp.WebGLSprite=function(){var a=cc.Sprite.prototype;a._spriteFrameLoadedCallback=function(a){this.setNodeDirty(!0),this.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize()),this._callLoadedEventCallbacks()},a.setOpacityModifyRGB=function(a){this._opacityModifyRGB!==a&&(this._opacityModifyRGB=a,this.updateColor())},a.updateDisplayedOpacity=function(a){cc.Node.prototype.updateDisplayedOpacity.call(this,a),this.updateColor()},a.ctor=function(a,b,c){var d=this;cc.Node.prototype.ctor.call(d),d._shouldBeHidden=!1,d._offsetPosition=cc.p(0,0),d._unflippedOffsetPositionFromCenter=cc.p(0,0),d._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},d._rect=cc.rect(0,0,0,0),d._quad=new cc.V3F_C4B_T2F_Quad,d._quadWebBuffer=cc._renderContext.createBuffer(),d._quadDirty=!0,d._textureLoaded=!0,d._softInit(a,b,c)},a.setBlendFunc=function(a,b){var c=this._blendFunc;void 0===b?(c.src=a.src,c.dst=a.dst):(c.src=a,c.dst=b)},a.init=function(){var a=this;if(arguments.length>0)return a.initWithFile(arguments[0],arguments[1]);cc.Node.prototype.init.call(a),a.dirty=a._recursiveDirty=!1,a._opacityModifyRGB=!0,a._blendFunc.src=cc.BLEND_SRC,a._blendFunc.dst=cc.BLEND_DST,a.texture=null,a._textureLoaded=!0,a._flippedX=a._flippedY=!1,a.anchorX=.5,a.anchorY=.5,a._offsetPosition.x=0,a._offsetPosition.y=0,a._hasChildren=!1;var b={r:255,g:255,b:255,a:255};return a._quad.bl.colors=b,a._quad.br.colors=b,a._quad.tl.colors=b,a._quad.tr.colors=b,a._quadDirty=!0,a.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0},a.initWithTexture=function(a,b,c){var d=this,e=arguments.length;if(cc.assert(0!=e,cc._LogInfos.Sprite_initWithTexture),c=c||!1,!cc.Node.prototype.init.call(d))return!1;d._batchNode=null,d._recursiveDirty=!1,d.dirty=!1,d._opacityModifyRGB=!0,d._blendFunc.src=cc.BLEND_SRC,d._blendFunc.dst=cc.BLEND_DST,d._flippedX=d._flippedY=!1,d.anchorX=.5,d.anchorY=.5,d._offsetPosition.x=0,d._offsetPosition.y=0,d._hasChildren=!1;var f=cc.color(255,255,255,255),g=d._quad;g.bl.colors=f,g.br.colors=f,g.tl.colors=f,g.tr.colors=f;var h=a.isLoaded();if(d._textureLoaded=h,!h){if(d._rectRotated=c||!1,b){var i=d._rect;i.x=b.x,i.y=b.y,i.width=b.width,i.height=b.height}return a.addLoadedEventListener(d._textureLoadedCallback,d),!0}if(b||(b=cc.rect(0,0,a.width,a.height)),a&&a.url){var j,k;c?(j=b.x+b.height,k=b.y+b.width):(j=b.x+b.width,k=b.y+b.height),j>a.width&&cc.error(cc._LogInfos.RectWidth,a.url),k>a.height&&cc.error(cc._LogInfos.RectHeight,a.url)}return d.texture=a,d.setTextureRect(b,c),d.batchNode=null,d._quadDirty=!0,!0},a._textureLoadedCallback=function(a){var b=this;if(!b._textureLoaded){b._textureLoaded=!0;var c=b._rect;c?cc._rectEqualToZero(c)&&(c.width=a.width,c.height=a.height):c=cc.rect(0,0,a.width,a.height),b.texture=a,b.setTextureRect(c,b._rectRotated),b.batchNode=b._batchNode,b._quadDirty=!0,b._callLoadedEventCallbacks()}},a.setTextureRect=function(a,b,c){var d=this;d._rectRotated=b||!1,d.setContentSize(c||a),d.setVertexRect(a),d._setTextureCoords(a);var e=d._unflippedOffsetPositionFromCenter;d._flippedX&&(e.x=-e.x),d._flippedY&&(e.y=-e.y);var f=d._rect;if(d._offsetPosition.x=e.x+(d._contentSize.width-f.width)/2,d._offsetPosition.y=e.y+(d._contentSize.height-f.height)/2,d._batchNode)d.dirty=!0;else{var g=0+d._offsetPosition.x,h=0+d._offsetPosition.y,i=g+f.width,j=h+f.height,k=d._quad;k.bl.vertices={x:g,y:h,z:0},k.br.vertices={x:i,y:h,z:0},k.tl.vertices={x:g,y:j,z:0},k.tr.vertices={x:i,y:j,z:0},d._quadDirty=!0}},a.updateTransform=function(){var a=this;if(a.dirty){var b=a._quad,c=a._parent;if(!a._visible||c&&c!=a._batchNode&&c._shouldBeHidden)b.br.vertices=b.tl.vertices=b.tr.vertices=b.bl.vertices={x:0,y:0,z:0},a._shouldBeHidden=!0;else{a._shouldBeHidden=!1,a._transformToBatch=c&&c!=a._batchNode?cc.affineTransformConcat(a.nodeToParentTransform(),c._transformToBatch):a.nodeToParentTransform();var d=a._transformToBatch,e=a._rect,f=a._offsetPosition.x,g=a._offsetPosition.y,h=f+e.width,i=g+e.height,j=d.tx,k=d.ty,l=d.a,m=d.b,n=d.d,o=-d.c,p=f*l-g*o+j,q=f*m+g*n+k,r=h*l-g*o+j,s=h*m+g*n+k,t=h*l-i*o+j,u=h*m+i*n+k,v=f*l-i*o+j,w=f*m+i*n+k,x=a._vertexZ;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(p=0|p,q=0|q,r=0|r,s=0|s,t=0|t,u=0|u,v=0|v,w=0|w),b.bl.vertices={x:p,y:q,z:x},b.br.vertices={x:r,y:s,z:x},b.tl.vertices={x:v,y:w,z:x},b.tr.vertices={x:t,y:u,z:x}}a.textureAtlas.updateQuad(b,a.atlasIndex),a._recursiveDirty=!1,a.dirty=!1}if(a._hasChildren&&a._arrayMakeObjectsPerformSelector(a._children,cc.Node._StateCallbackType.updateTransform),cc.SPRITE_DEBUG_DRAW){var y=[cc.p(a._quad.bl.vertices.x,a._quad.bl.vertices.y),cc.p(a._quad.br.vertices.x,a._quad.br.vertices.y),cc.p(a._quad.tr.vertices.x,a._quad.tr.vertices.y),cc.p(a._quad.tl.vertices.x,a._quad.tl.vertices.y)];cc._drawingUtil.drawPoly(y,4,!0)}},a.addChild=function(a,b,c){var d=this;if(cc.assert(a,cc._LogInfos.Sprite_addChild_3),null==b&&(b=a._localZOrder),null==c&&(c=a.tag),d._batchNode){if(!(a instanceof cc.Sprite))return void cc.log(cc._LogInfos.Sprite_addChild);a.texture._webTextureObj!==d.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2),d._batchNode.appendChild(a),d._reorderChildDirty||d._setReorderChildDirtyRecursively()}cc.Node.prototype.addChild.call(d,a,b,c),d._hasChildren=!0},a.setOpacity=function(a){cc.Node.prototype.setOpacity.call(this,a),this.updateColor()},a.setColor=function(a){cc.Node.prototype.setColor.call(this,a),this.updateColor()},a.updateDisplayedColor=function(a){cc.Node.prototype.updateDisplayedColor.call(this,a),this.updateColor()
},a.setSpriteFrame=function(a){var b=this;cc.isString(a)&&(a=cc.spriteFrameCache.getSpriteFrame(a),cc.assert(a,cc._LogInfos.Sprite_setSpriteFrame)),b.setNodeDirty(!0);var c=a.getOffset();b._unflippedOffsetPositionFromCenter.x=c.x,b._unflippedOffsetPositionFromCenter.y=c.y;var d=a.getTexture(),e=a.textureLoaded();e||(b._textureLoaded=!1,a.addLoadedEventListener(function(a){b._textureLoaded=!0;var c=a.getTexture();c!=b._texture&&(b.texture=c),b.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize()),b._callLoadedEventCallbacks()},b)),d!=b._texture&&(b.texture=d),b._rectRotated=a.isRotated(),b.setTextureRect(a.getRect(),b._rectRotated,a.getOriginalSize())},a.isFrameDisplayed=function(a){return cc.rectEqualToRect(a.getRect(),this._rect)&&a.getTexture().getName()==this._texture.getName()&&cc.pointEqualToPoint(a.getOffset(),this._unflippedOffsetPositionFromCenter)},a.setBatchNode=function(a){var b=this;if(b._batchNode=a,b._batchNode)b._transformToBatch=cc.affineTransformIdentity(),b.textureAtlas=b._batchNode.textureAtlas;else{b.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED,b.textureAtlas=null,b._recursiveDirty=!1,b.dirty=!1;var c=b._offsetPosition.x,d=b._offsetPosition.y,e=c+b._rect.width,f=d+b._rect.height,g=b._quad;g.bl.vertices={x:c,y:d,z:0},g.br.vertices={x:e,y:d,z:0},g.tl.vertices={x:c,y:f,z:0},g.tr.vertices={x:e,y:f,z:0},b._quadDirty=!0}},a.setTexture=function(a){var b=this;if(a&&cc.isString(a)){a=cc.textureCache.addImage(a),b.setTexture(a);var c=a.getContentSize();return void b.setTextureRect(cc.rect(0,0,c.width,c.height))}return cc.assert(!a||a instanceof cc.Texture2D,cc._LogInfos.Sprite_setTexture_2),b._batchNode&&b._batchNode.texture!=a?void cc.log(cc._LogInfos.Sprite_setTexture):(b.shaderProgram=cc.shaderCache.programForKey(a?cc.SHADER_POSITION_TEXTURECOLOR:cc.SHADER_POSITION_COLOR),void(b._batchNode||b._texture==a||(b._texture=a,b._updateBlendFunc())))},a.draw=function(){var a=this;if(a._textureLoaded){var b=cc._renderContext,c=a._texture;if(c?c._isLoaded&&(a._shaderProgram.use(),a._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(a._blendFunc.src,a._blendFunc.dst),cc.glBindTexture2DN(0,c),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),b.bindBuffer(b.ARRAY_BUFFER,a._quadWebBuffer),a._quadDirty&&(b.bufferData(b.ARRAY_BUFFER,a._quad.arrayBuffer,b.DYNAMIC_DRAW),a._quadDirty=!1),b.vertexAttribPointer(0,3,b.FLOAT,!1,24,0),b.vertexAttribPointer(1,4,b.UNSIGNED_BYTE,!0,24,12),b.vertexAttribPointer(2,2,b.FLOAT,!1,24,16),b.drawArrays(b.TRIANGLE_STRIP,0,4)):(a._shaderProgram.use(),a._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(a._blendFunc.src,a._blendFunc.dst),cc.glBindTexture2D(null),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),b.bindBuffer(b.ARRAY_BUFFER,a._quadWebBuffer),a._quadDirty&&(cc._renderContext.bufferData(cc._renderContext.ARRAY_BUFFER,a._quad.arrayBuffer,cc._renderContext.STATIC_DRAW),a._quadDirty=!1),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,b.FLOAT,!1,24,0),b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,24,12),b.drawArrays(b.TRIANGLE_STRIP,0,4)),cc.g_NumberOfDraws++,0!==cc.SPRITE_DEBUG_DRAW||a._showNode)if(1===cc.SPRITE_DEBUG_DRAW||a._showNode){var d=a._quad,e=[cc.p(d.tl.vertices.x,d.tl.vertices.y),cc.p(d.bl.vertices.x,d.bl.vertices.y),cc.p(d.br.vertices.x,d.br.vertices.y),cc.p(d.tr.vertices.x,d.tr.vertices.y)];cc._drawingUtil.drawPoly(e,4,!0)}else if(2===cc.SPRITE_DEBUG_DRAW){var f=a.getTextureRect(),g=a.getOffsetPosition(),h=[cc.p(g.x,g.y),cc.p(g.x+f.width,g.y),cc.p(g.x+f.width,g.y+f.height),cc.p(g.x,g.y+f.height)];cc._drawingUtil.drawPoly(h,4,!0)}}},delete a},cc._tmp.WebGLLabelTTF=function(){var a=cc.LabelTTF.prototype;a.setColor=cc.Sprite.prototype.setColor,a._setColorsString=function(){this._needUpdateTexture=!0;var a=this._strokeColor,b=this._textFillColor;this._shadowColorStr="rgba(128,128,128,"+this._shadowOpacity+")",this._fillColorStr="rgba("+(0|b.r)+","+(0|b.g)+","+(0|b.b)+", 1)",this._strokeColorStr="rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+", 1)"},a.updateDisplayedColor=cc.Sprite.prototype.updateDisplayedColor,a.setOpacity=cc.Sprite.prototype.setOpacity,a.updateDisplayedOpacity=cc.Sprite.prototype.updateDisplayedOpacity,a.initWithStringAndTextDefinition=function(a,b){return cc.Sprite.prototype.init.call(this)?(this.shaderProgram=cc.shaderCache.programForKey(cc.LabelTTF._SHADER_PROGRAM),this._updateWithTextDefinition(b,!1),this.string=a,!0):!1},a.setFontFillColor=function(a){var b=this._textFillColor;(b.r!=a.r||b.g!=a.g||b.b!=a.b)&&(b.r=a.r,b.g=a.g,b.b=a.b,this._setColorsString(),this._needUpdateTexture=!0)},a.draw=function(a){if(this._string&&""!=this._string){var b=a||cc._renderContext,c=this._texture;if(c&&c._isLoaded&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(c),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),b.bindBuffer(b.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(b.bufferData(b.ARRAY_BUFFER,this._quad.arrayBuffer,b.STATIC_DRAW),this._quadDirty=!1),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,b.FLOAT,!1,24,0),b.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,b.FLOAT,!1,24,16),b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,24,12),b.drawArrays(b.TRIANGLE_STRIP,0,4)),1===cc.SPRITE_DEBUG_DRAW){var d=this._quad,e=[cc.p(d.tl.vertices.x,d.tl.vertices.y),cc.p(d.bl.vertices.x,d.bl.vertices.y),cc.p(d.br.vertices.x,d.br.vertices.y),cc.p(d.tr.vertices.x,d.tr.vertices.y)];cc._drawingUtil.drawPoly(e,4,!0)}else if(2===cc.SPRITE_DEBUG_DRAW){var f=this.getTextureRect(),g=this.offsetX,h=this.offsetY,i=[cc.p(g,h),cc.p(g+f.width,h),cc.p(g+f.width,h+f.height),cc.p(g,h+f.height)];cc._drawingUtil.drawPoly(i,4,!0)}cc.g_NumberOfDraws++}},a.setTextureRect=cc.Sprite.prototype.setTextureRect},cc._tmp.DirectorWebGL=function(){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var a=cc.Director.prototype;a.setProjection=function(a){var b=this,c=b._winSizeInPoints;b.setViewport();var d=b._openGLView,e=d._viewPortRect.x/d._scaleX,f=d._viewPortRect.y/d._scaleY;switch(a){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var g=new cc.kmMat4;cc.kmMat4OrthographicProjection(g,0,c.width,0,c.height,-1024,1024),cc.kmGLMultMatrix(g),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var h=b.getZEye(),i=new cc.kmMat4,j=new cc.kmMat4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),cc.kmMat4PerspectiveProjection(i,60,c.width/c.height,.1,2*h),cc.kmGLMultMatrix(i),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();var k=cc.kmVec3Fill(null,-e+c.width/2,-f+c.height/2,h),l=cc.kmVec3Fill(null,-e+c.width/2,-f+c.height/2,0),m=cc.kmVec3Fill(null,0,1,0);cc.kmMat4LookAt(j,k,l,m),cc.kmGLMultMatrix(j);break;case cc.Director.PROJECTION_CUSTOM:b._projectionDelegate&&b._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}b._projection=a,cc.eventManager.dispatchEvent(b._eventProjectionChanged),cc.setProjectionMatrixDirty()},a.setDepthTest=function(a){var b=cc._renderContext;a?(b.clearDepth(1),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL)):b.disable(b.DEPTH_TEST)},a.setOpenGLView=function(a){var b=this;b._winSizeInPoints.width=cc._canvas.width,b._winSizeInPoints.height=cc._canvas.height,b._openGLView=a||cc.view;var c=cc.configuration;c.gatherGPUInfo(),c.dumpInfo(),b._createStatsLabel(),b.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},a._clear=function(){var a=cc._renderContext;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},a._beforeVisitScene=function(){cc.kmGLPushMatrix()},a._afterVisitScene=function(){cc.kmGLPopMatrix()},a._createStatsLabel=function(){var a=this;if(!cc.LabelAtlas)return void a._createStatsLabelForCanvas();if(null!=cc.Director._fpsImageLoaded&&0!=cc.Director._fpsImageLoaded){var b=new cc.Texture2D;b.initWithElement(cc.Director._fpsImage),b.handleLoadedTexture();var c=cc.view.getDesignResolutionSize().height/320;0===c&&(c=a._winSizeInPoints.height/320);var d=new cc.LabelAtlas;d._setIgnoreContentScaleFactor(!0),d.initWithString("00.0",b,12,32,"."),d.scale=c,a._FPSLabel=d,d=new cc.LabelAtlas,d._setIgnoreContentScaleFactor(!0),d.initWithString("0.000",b,12,32,"."),d.scale=c,a._SPFLabel=d,d=new cc.LabelAtlas,d._setIgnoreContentScaleFactor(!0),d.initWithString("000",b,12,32,"."),d.scale=c,a._drawsLabel=d;var e=cc.DIRECTOR_STATS_POSITION;a._drawsLabel.setPosition(e.x,34*c+e.y),a._SPFLabel.setPosition(e.x,17*c+e.y),a._FPSLabel.setPosition(e)}},a._createStatsLabelForCanvas=function(){var a=this,b=0;b=a._winSizeInPoints.width>a._winSizeInPoints.height?0|a._winSizeInPoints.height/320*24:0|a._winSizeInPoints.width/320*24,a._FPSLabel=cc.LabelTTF.create("000.0","Arial",b),a._SPFLabel=cc.LabelTTF.create("0.000","Arial",b),a._drawsLabel=cc.LabelTTF.create("0000","Arial",b);var c=cc.DIRECTOR_STATS_POSITION;a._drawsLabel.setPosition(a._drawsLabel.width/2+c.x,5*a._drawsLabel.height/2+c.y),a._SPFLabel.setPosition(a._SPFLabel.width/2+c.x,3*a._SPFLabel.height/2+c.y),a._FPSLabel.setPosition(a._FPSLabel.width/2+c.x,a._FPSLabel.height/2+c.y)},a.convertToGL=function(a){var b=new cc.kmMat4;cc.GLToClipTransform(b);var c=new cc.kmMat4;cc.kmMat4Inverse(c,b);var d=b.mat[14]/b.mat[15],e=this._openGLView.getDesignResolutionSize(),f=new cc.kmVec3(2*a.x/e.width-1,1-2*a.y/e.height,d),g=new cc.kmVec3;return cc.kmVec3TransformCoord(g,f,c),cc.p(g.x,g.y)},a.convertToUI=function(a){var b=new cc.kmMat4;cc.GLToClipTransform(b);var c=new cc.kmVec3,d=new cc.kmVec3(a.x,a.y,0);cc.kmVec3TransformCoord(c,d,b);var e=this._openGLView.getDesignResolutionSize();return cc.p(e.width*(.5*c.x+.5),e.height*(.5*-c.y+.5))},a.getVisibleSize=function(){return this._openGLView.getVisibleSize()},a.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},a.getZEye=function(){return this._winSizeInPoints.height/1.1566},a.setViewport=function(){var a=this._openGLView;if(a){var b=this._winSizeInPoints;a.setViewPortInPoints(-a._viewPortRect.x/a._scaleX,-a._viewPortRect.y/a._scaleY,b.width,b.height)}},a.getOpenGLView=function(){return this._openGLView},a.getProjection=function(){return this._projection},a.setAlphaBlending=function(a){a?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},a.setGLDefaultValues=function(){var a=this;a.setAlphaBlending(!0),a.setDepthTest(!1),a.setProjection(a._projection),cc._renderContext.clearColor(0,0,0,1)}},cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var a=this._valueDict;a["cocos2d.x.version"]=cc.ENGINE_VERSION,a["cocos2d.x.compiled_with_profiler"]=!1,a["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(a){return this._GlExtensions.indexOf(a)>-1},getValue:function(a,b){this._inited||this._init();var c=this._valueDict;return c[a]?c[a]:b},setValue:function(a,b){this._valueDict[a]=b},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc._RENDER_TYPE_CANVAS){this._inited||this._init();var a=cc._renderContext,b=this._valueDict;b["gl.vendor"]=a.getParameter(a.VENDOR),b["gl.renderer"]=a.getParameter(a.RENDERER),b["gl.version"]=a.getParameter(a.VERSION),this._GlExtensions="";for(var c=a.getSupportedExtensions(),d=0;d<c.length;d++)this._GlExtensions+=c[d]+" ";this._maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),b["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),b["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),b["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,b["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),b["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),b["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),b["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(a){this._inited||this._init();var b=cc.loader.getRes(a);if(!b)throw"Please load the resource first : "+a;cc.assert(b,cc._LogInfos.configuration_loadConfigFile_2,a);var c=b.data;if(!c)return void cc.log(cc._LogInfos.configuration_loadConfigFile,a);for(var d in c)this._valueDict[d]=c[d]}};