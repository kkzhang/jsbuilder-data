cc.PNGReader=cc.Class.extend({ctor:function(a){var b,d,c,e;this.data=a;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(c=null;;){b=this.readUInt32();e=a=void 0;e=[];for(a=0;4>a;++a)e.push(String.fromCharCode(this.data[this.pos++]));a=e.join("");switch(a){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=
this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(b);break;case "fcTL":c&&this.animation.frames.push(c);this.pos+=4;c={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};a=this.readUInt16();b=this.readUInt16()||100;c.delay=1E3*a/b;c.disposeOp=this.data[this.pos++];c.blendOp=this.data[this.pos++];
c.data=[];break;case "IDAT":case "fdAT":"fdAT"===a&&(this.pos+=4,b-=4);a=(null!=c?c.data:void 0)||this.imgData;for(e=0;0<=b?e<b:e>b;0<=b?++e:--e)a.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(b);b=255-this.transparency.indexed.length;if(0<b)for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(b)[0];break;case 2:this.transparency.rgb=this.read(b)}break;
case "tEXt":e=this.read(b);b=e.indexOf(0);a=String.fromCharCode.apply(String,e.slice(0,b));this.text[a]=String.fromCharCode.apply(String,e.slice(b+1));break;case "IEND":c&&this.animation.frames.push(c);a:{switch(this.colorType){case 0:case 3:case 4:c=1;break a;case 2:case 6:c=3;break a}c=void 0}this.colors=c;this.hasAlphaChannel=4===(d=this.colorType)||6===d;d=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*d;a:{switch(this.colors){case 1:d="DeviceGray";break a;case 3:d="DeviceRGB";
break a}d=void 0}this.colorSpace=d;Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData));return;default:this.pos+=b}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}},read:function(a){var b,d;d=[];for(b=0;0<=a?b<a:b>a;0<=a?++b:--b)d.push(this.data[this.pos++]);return d},readUInt32:function(){var a,b,d,c;a=this.data[this.pos++]<<24;b=this.data[this.pos++]<<16;d=this.data[this.pos++]<<8;c=this.data[this.pos++];return a|b|d|c},readUInt16:function(){var a,
b;a=this.data[this.pos++]<<8;b=this.data[this.pos++];return a|b},decodePixels:function(a){var b,d,c,e,f,g,h,k,l,n,s,t,r,q,m;null==a&&(a=this.imgData);if(0===a.length)return new Uint8Array(0);a=(new Zlib.Inflate(a,{index:0,verify:!1})).decompress();k=this.pixelBitlength/8;t=k*this.width;l=new Uint8Array(t*this.height);g=a.length;for(d=n=s=0;n<g;){switch(a[n++]){case 0:for(b=0;b<t;b+=1)l[d++]=a[n++];break;case 1:for(e=r=0;r<t;e=r+=1)b=a[n++],f=e<k?0:l[d-k],l[d++]=(b+f)%256;break;case 2:for(e=f=0;f<
t;e=f+=1)b=a[n++],c=(e-e%k)/k,r=s&&l[(s-1)*t+c*k+e%k],l[d++]=(r+b)%256;break;case 3:for(e=m=0;m<t;e=m+=1)b=a[n++],c=(e-e%k)/k,f=e<k?0:l[d-k],r=s&&l[(s-1)*t+c*k+e%k],l[d++]=(b+Math.floor((f+r)/2))%256;break;case 4:for(e=m=0;m<t;e=m+=1)b=a[n++],c=(e-e%k)/k,f=e<k?0:l[d-k],0===s?r=q=0:(r=l[(s-1)*t+c*k+e%k],q=c&&l[(s-1)*t+(c-1)*k+e%k]),h=f+r-q,e=Math.abs(h-f),c=Math.abs(h-r),h=Math.abs(h-q),f=e<=c&&e<=h?f:c<=h?r:q,l[d++]=(b+f)%256;break;default:throw Error("Invalid filter algorithm: "+a[n-1]);}s++}return l},
copyToImageData:function(a,b){var d,c,e,f,g,h,k,l;c=this.colors;l=null;d=this.hasAlphaChannel;this.palette.length&&(l=null!=(e=this._decodedPalette)?e:this._decodedPalette=this.decodePalette(),c=4,d=!0);e=a.data||a;k=e.length;g=l||b;f=h=0;if(1===c)for(;f<k;)c=l?4*b[f/4]:h,h=g[c++],e[f++]=h,e[f++]=h,e[f++]=h,e[f++]=d?g[c++]:255,h=c;else for(;f<k;)c=l?4*b[f/4]:h,e[f++]=g[c++],e[f++]=g[c++],e[f++]=g[c++],e[f++]=d?g[c++]:255,h=c},decodePalette:function(){var a,b,d,c,e,f,g,h,k;d=this.palette;f=this.transparency.indexed||
[];e=new Uint8Array((f.length||0)+d.length);b=g=a=c=0;for(h=d.length;g<h;b=g+=3)e[c++]=d[b],e[c++]=d[b+1],e[c++]=d[b+2],e[c++]=null!=(k=f[a++])?k:255;return e},render:function(a){var b;a.width=this.width;a.height=this.height;a=a.getContext("2d");b=a.createImageData(this.width,this.height);this.copyToImageData(b,this.decodePixels());return a.putImageData(b,0,0)}});cc.tiffReader={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(a){return this._tiffData[a]},getUint16:function(a){return this._littleEndian?this._tiffData[a+1]<<8|this._tiffData[a]:this._tiffData[a]<<8|this._tiffData[a+1]},getUint32:function(a){var b=this._tiffData;return this._littleEndian?b[a+3]<<24|b[a+2]<<16|b[a+1]<<8|b[a]:b[a]<<24|b[a+1]<<16|b[a+2]<<8|b[a+3]},checkLittleEndian:function(){var a=this.getUint16(0);if(18761===a)this.littleEndian=!0;else if(19789===a)this.littleEndian=
!1;else throw console.log(a),TypeError("Invalid byte order value.");return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(a){var b=this.fieldTypeNames;return a in b?b[a]:null},getFieldTagName:function(a){var b=this.fieldTagNames;if(a in b)return b[a];console.log("Unknown Field Tag:",a);return"Tag"+a},getFieldTypeLength:function(a){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(a)?1:-1!==["SHORT",
"SSHORT"].indexOf(a)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(a)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(a)?8:null},getFieldValues:function(a,b,d,c){a=[];var e=this.getFieldTypeLength(b);if(4>=e*d)!1===this.littleEndian?a.push(c>>>8*(4-e)):a.push(c);else for(var f=0;f<d;f++){var g=e*f;8<=e?-1!==["RATIONAL","SRATIONAL"].indexOf(b)?(a.push(this.getUint32(c+g)),a.push(this.getUint32(c+g+4))):cc.log("Can't handle this field type or size"):a.push(this.getBytes(e,c+g))}"ASCII"===b&&a.forEach(function(a,
b,c){c[b]=String.fromCharCode(a)});return a},getBytes:function(a,b){if(0>=a)cc.log("No bytes requested");else{if(1>=a)return this.getUint8(b);if(2>=a)return this.getUint16(b);if(3>=a)return this.getUint32(b)>>>8;if(4>=a)return this.getUint32(b);cc.log("Too many bytes requested")}},getBits:function(a,b,d){d=d||0;b+=Math.floor(d/8);var c=d+a;a=32-a;var e,f;0>=c?console.log("No bits requested"):8>=c?(e=24+d,f=this.getUint8(b)):16>=c?(e=16+d,f=this.getUint16(b)):32>=c?(e=d,f=this.getUint32(b)):console.log("Too many bits requested");
return{bits:f<<e>>>a,byteOffset:b+Math.floor(c/8),bitOffset:c%8}},parseFileDirectory:function(a){var b=this.getUint16(a),d=[];a+=2;for(var c=0;c<b;a+=12,c++){var e=this.getUint16(a),f=this.getUint16(a+2),g=this.getUint32(a+4),h=this.getUint32(a+8),e=this.getFieldTagName(e),f=this.getFieldTypeName(f),g=this.getFieldValues(e,f,g,h);d[e]={type:f,values:g}}this._fileDirectories.push(d);b=this.getUint32(a);0!==b&&this.parseFileDirectory(b)},clampColorSample:function(a,b){var d=Math.pow(2,8-b);return Math.floor(a*
d+(d-1))},parseTIFF:function(a,b){b=b||cc.newElement("canvas");this._tiffData=a;this.canvas=b;this.checkLittleEndian();if(this.hasTowel()){var d=this.getUint32(4);this._fileDirectories.length=0;this.parseFileDirectory(d);var c=this._fileDirectories[0],d=c.ImageWidth.values[0],e=c.ImageLength.values[0];this.canvas.width=d;this.canvas.height=e;var f=[],g=c.Compression?c.Compression.values[0]:1,h=c.SamplesPerPixel.values[0],k=[],l=0,n=!1;c.BitsPerSample.values.forEach(function(a,b,c){k[b]={bitsPerSample:a,
hasBytesPerSample:!1,bytesPerSample:void 0};0===a%8&&(k[b].hasBytesPerSample=!0,k[b].bytesPerSample=a/8);l+=a},this);if(0===l%8)var n=!0,s=l/8;var t=c.StripOffsets.values,r=t.length;if(c.StripByteCounts)var q=c.StripByteCounts.values;else if(cc.log("Missing StripByteCounts!"),1===r)q=[Math.ceil(d*e*l/8)];else throw Error("Cannot recover from missing StripByteCounts");for(var m=0;m<r;m++){var y=t[m];f[m]=[];for(var u=q[m],v=0,B=0,p=1,x=!0,w=[],E=0,D=0,F=0;v<u;v+=p)switch(g){case 1:p=0;for(w=[];p<h;p++)if(k[p].hasBytesPerSample)w.push(this.getBytes(k[p].bytesPerSample,
y+v+k[p].bytesPerSample*p));else{var z=this.getBits(k[p].bitsPerSample,y+v,B);w.push(z.bits);v=z.byteOffset-y;B=z.bitOffset;throw RangeError("Cannot handle sub-byte bits per sample");}f[m].push(w);if(n)p=s;else throw p=0,RangeError("Cannot handle sub-byte bits per pixel");break;case 32773:if(x){var x=!1,A=1,C=1,p=this.getInt8(y+v);0<=p&&127>=p?A=p+1:-127<=p&&-1>=p?C=-p+1:x=!0}else{for(var H=this.getUint8(y+v),p=0;p<C;p++){if(k[D].hasBytesPerSample)F=F<<8*E|H,E++,E===k[D].bytesPerSample&&(w.push(F),
F=E=0,D++);else throw RangeError("Cannot handle sub-byte bits per sample");D===h&&(f[m].push(w),w=[],D=0)}A--;0===A&&(x=!0)}p=1}}if(b.getContext){s=this.canvas.getContext("2d");s.fillStyle="rgba(255, 255, 255, 0)";m=c.RowsPerStrip?c.RowsPerStrip.values[0]:e;y=f.length;e%=m;e=0===e?m:e;v=m;g=0;w=c.PhotometricInterpretation.values[0];A=[];C=0;c.ExtraSamples&&(A=c.ExtraSamples.values,C=A.length);if(c.ColorMap)var z=c.ColorMap.values,G=Math.pow(2,k[0].bitsPerSample);for(m=0;m<y;m++){m+1===y&&(v=e);c=
f[m].length;g*=m;for(n=h=0;h<v,n<c;h++)for(t=0;t<d;t++,n++){q=f[m][n];x=B=u=0;r=1;if(0<C)for(u=0;u<C;u++)if(1===A[u]||2===A[u]){r=q[3+u]/256;break}switch(w){case 0:if(k[0].hasBytesPerSample)var I=Math.pow(16,2*k[0].bytesPerSample);q.forEach(function(a,b,c){c[b]=I-a});case 1:u=B=x=this.clampColorSample(q[0],k[0].bitsPerSample);break;case 2:u=this.clampColorSample(q[0],k[0].bitsPerSample);B=this.clampColorSample(q[1],k[1].bitsPerSample);x=this.clampColorSample(q[2],k[2].bitsPerSample);break;case 3:if(void 0===
z)throw Error("Palette image missing color map");q=q[0];u=this.clampColorSample(z[q],16);B=this.clampColorSample(z[G+q],16);x=this.clampColorSample(z[2*G+q],16);break;default:throw RangeError("Unknown Photometric Interpretation:",w);}s.fillStyle="rgba("+u+", "+B+", "+x+", "+r+")";s.fillRect(t,g+h,1,1)}g=v}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",
289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",
326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",
344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",
700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};cc.Particle=function(a,b,d,c,e,f,g,h,k,l,n,s){this.pos=a?a:cc.p(0,0);this.startPos=b?b:cc.p(0,0);this.color=d?d:{r:0,g:0,b:0,a:255};this.deltaColor=c?c:{r:0,g:0,b:0,a:255};this.size=e||0;this.deltaSize=f||0;this.rotation=g||0;this.deltaRotation=h||0;this.timeToLive=k||0;this.atlasIndex=l||0;this.modeA=n?n:new cc.Particle.ModeA;this.modeB=s?s:new cc.Particle.ModeB;this.isChangeColor=!1;this.drawPos=cc.p(0,0)};
cc.Particle.ModeA=function(a,b,d){this.dir=a?a:cc.p(0,0);this.radialAccel=b||0;this.tangentialAccel=d||0};cc.Particle.ModeB=function(a,b,d,c){this.angle=a||0;this.degreesPerSecond=b||0;this.radius=d||0;this.deltaRadius=c||0};cc.Particle.TemporaryPoints=[cc.p(),cc.p(),cc.p(),cc.p()];
cc.ParticleSystem=cc.Node.extend({_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_className:"ParticleSystem",_pointZeroForParticle:cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,drawMode:null,shapeType:null,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,
_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_quads:null,_indices:null,_buffersVBO:null,_pointRect:null,_textureLoaded:null,_quadsArrayBuffer:null,ctor:function(a){cc.Node.prototype.ctor.call(this);this.emitterMode=cc.ParticleSystem.MODE_GRAVITY;this.modeA=new cc.ParticleSystem.ModeA;this.modeB=new cc.ParticleSystem.ModeB;this._blendFunc=
{src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._particles=[];this._sourcePosition=cc.p(0,0);this._posVar=cc.p(0,0);this._startColor=cc.color(255,255,255,255);this._startColorVar=cc.color(255,255,255,255);this._endColor=cc.color(255,255,255,255);this._endColorVar=cc.color(255,255,255,255);this._plistFile="";this._elapsed=0;this._dontTint=!1;this._pointZeroForParticle=cc.p(0,0);this._particleIdx=this._emitCounter=0;this._batchNode=null;this.atlasIndex=0;this._transformSystemDirty=!1;this._allocatedParticles=
0;this.drawMode=cc.ParticleSystem.SHAPE_MODE;this.shapeType=cc.ParticleSystem.BALL_SHAPE;this._isActive=!1;this._totalParticles=this.emissionRate=this.endSpinVar=this.endSpin=this.startSpinVar=this.startSpin=this.endSizeVar=this.endSize=this.startSizeVar=this.startSize=this.angleVar=this.angle=this.lifeVar=this.life=this.duration=this.particleCount=0;this._texture=null;this._opacityModifyRGB=!1;this.positionType=cc.ParticleSystem.TYPE_FREE;this.autoRemoveOnFinish=!1;this._buffersVBO=[0,0];this._quads=
[];this._indices=[];this._pointRect=cc.rect(0,0,0,0);this._textureLoaded=!0;cc._renderType===cc._RENDER_TYPE_WEBGL&&(this._quadsArrayBuffer=null);!a||"number"===typeof a?(a=a||100,this.setDrawMode(cc.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(a)):a&&this.initWithFile(a)},initIndices:function(){for(var a=this._indices,b=0,d=this._totalParticles;b<d;++b){var c=6*b,e=4*b;a[c+0]=e+0;a[c+1]=e+1;a[c+2]=e+2;a[c+5]=e+1;a[c+4]=e+2;a[c+3]=e+3}},initTexCoordsWithRect:function(a){var b=cc.contentScaleFactor(),
d=cc.rect(a.x*b,a.y*b,a.width*b,a.height*b),c=a.width,e=a.height;this._texture&&(c=this._texture.pixelsWidth,e=this._texture.pixelsHeight);if(cc._renderType!==cc._RENDER_TYPE_CANVAS){cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(a=(2*d.x+1)/(2*c),b=(2*d.y+1)/(2*e),c=a+(2*d.width-2)/(2*c),d=b+(2*d.height-2)/(2*e)):(a=d.x/c,b=d.y/e,c=a+d.width/c,d=b+d.height/e);var e=d,d=b,b=e,f=0,g=0;this._batchNode?(e=this._batchNode.textureAtlas.quads,f=this.atlasIndex,g=this.atlasIndex+this._totalParticles):(e=this._quads,
f=0,g=this._totalParticles);for(;f<g;f++){e[f]||(e[f]=cc.V3F_C4B_T2F_QuadZero());var h=e[f];h.bl.texCoords.u=a;h.bl.texCoords.v=b;h.br.texCoords.u=c;h.br.texCoords.v=b;h.tl.texCoords.u=a;h.tl.texCoords.v=d;h.tr.texCoords.u=c;h.tr.texCoords.v=d}}},getBatchNode:function(){return this._batchNode},setBatchNode:function(a){if(this._batchNode!=a){var b=this._batchNode;if(this._batchNode=a)for(var d=this._particles,c=0;c<this._totalParticles;c++)d[c].atlasIndex=c;a?b||(this._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,
this.atlasIndex),cc._renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(),this.setTexture(b.getTexture()),this._setupVBO())}},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(a){this.atlasIndex=a},getDrawMode:function(){return this.drawMode},setDrawMode:function(a){this.drawMode=a},getShapeType:function(){return this.shapeType},setShapeType:function(a){this.shapeType=a},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},
setParticleCount:function(a){this.particleCount=a},getDuration:function(){return this.duration},setDuration:function(a){this.duration=a},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(a){this._sourcePosition=a},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(a){this._posVar=a},getLife:function(){return this.life},setLife:function(a){this.life=a},getLifeVar:function(){return this.lifeVar},setLifeVar:function(a){this.lifeVar=
a},getAngle:function(){return this.angle},setAngle:function(a){this.angle=a},getAngleVar:function(){return this.angleVar},setAngleVar:function(a){this.angleVar=a},getGravity:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getGravity() : Particle Mode should be Gravity");var a=this.modeA.gravity;return cc.p(a.x,a.y)},setGravity:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setGravity() : Particle Mode should be Gravity");
this.modeA.gravity=a},getSpeed:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeed() : Particle Mode should be Gravity");return this.modeA.speed},setSpeed:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeed() : Particle Mode should be Gravity");this.modeA.speed=a},getSpeedVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeedVar() : Particle Mode should be Gravity");
return this.modeA.speedVar},setSpeedVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeedVar() : Particle Mode should be Gravity");this.modeA.speedVar=a},getTangentialAccel:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccel() : Particle Mode should be Gravity");return this.modeA.tangentialAccel},setTangentialAccel:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccel() : Particle Mode should be Gravity");
this.modeA.tangentialAccel=a},getTangentialAccelVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccelVar() : Particle Mode should be Gravity");return this.modeA.tangentialAccelVar},setTangentialAccelVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccelVar() : Particle Mode should be Gravity");this.modeA.tangentialAccelVar=a},getRadialAccel:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&
cc.log("cc.ParticleBatchNode.getRadialAccel() : Particle Mode should be Gravity");return this.modeA.radialAccel},setRadialAccel:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccel() : Particle Mode should be Gravity");this.modeA.radialAccel=a},getRadialAccelVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccelVar() : Particle Mode should be Gravity");return this.modeA.radialAccelVar},setRadialAccelVar:function(a){this.emitterMode!==
cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccelVar() : Particle Mode should be Gravity");this.modeA.radialAccelVar=a},getRotationIsDir:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRotationIsDir() : Particle Mode should be Gravity");return this.modeA.rotationIsDir},setRotationIsDir:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRotationIsDir() : Particle Mode should be Gravity");
this.modeA.rotationIsDir=a},getStartRadius:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadius() : Particle Mode should be Radius");return this.modeB.startRadius},setStartRadius:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadius() : Particle Mode should be Radius");this.modeB.startRadius=a},getStartRadiusVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadiusVar() : Particle Mode should be Radius");
return this.modeB.startRadiusVar},setStartRadiusVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadiusVar() : Particle Mode should be Radius");this.modeB.startRadiusVar=a},getEndRadius:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadius() : Particle Mode should be Radius");return this.modeB.endRadius},setEndRadius:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadius() : Particle Mode should be Radius");
this.modeB.endRadius=a},getEndRadiusVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadiusVar() : Particle Mode should be Radius");return this.modeB.endRadiusVar},setEndRadiusVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadiusVar() : Particle Mode should be Radius");this.modeB.endRadiusVar=a},getRotatePerSecond:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecond() : Particle Mode should be Radius");
return this.modeB.rotatePerSecond},setRotatePerSecond:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecond() : Particle Mode should be Radius");this.modeB.rotatePerSecond=a},getRotatePerSecondVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecondVar() : Particle Mode should be Radius");return this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&
cc.log("cc.ParticleBatchNode.setRotatePerSecondVar() : Particle Mode should be Radius");this.modeB.rotatePerSecondVar=a},setScale:function(a,b){this._transformSystemDirty=!0;cc.Node.prototype.setScale.call(this,a,b)},setRotation:function(a){this._transformSystemDirty=!0;cc.Node.prototype.setRotation.call(this,a)},setScaleX:function(a){this._transformSystemDirty=!0;cc.Node.prototype.setScaleX.call(this,a)},setScaleY:function(a){this._transformSystemDirty=!0;cc.Node.prototype.setScaleY.call(this,a)},
getStartSize:function(){return this.startSize},setStartSize:function(a){this.startSize=a},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(a){this.startSizeVar=a},getEndSize:function(){return this.endSize},setEndSize:function(a){this.endSize=a},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(a){this.endSizeVar=a},getStartColor:function(){return cc.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(a){this._startColor=
cc.color(a)},getStartColorVar:function(){return cc.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(a){this._startColorVar=cc.color(a)},getEndColor:function(){return cc.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(a){this._endColor=cc.color(a)},getEndColorVar:function(){return cc.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(a){this._endColorVar=
cc.color(a)},getStartSpin:function(){return this.startSpin},setStartSpin:function(a){this.startSpin=a},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(a){this.startSpinVar=a},getEndSpin:function(){return this.endSpin},setEndSpin:function(a){this.endSpin=a},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(a){this.endSpinVar=a},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(a){this.emissionRate=a},getTotalParticles:function(){return this._totalParticles},
setTotalParticles:function(a){if(cc._renderType===cc._RENDER_TYPE_CANVAS)this._totalParticles=200>a?a:200;else{if(a>this._allocatedParticles){var b=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*a);var d=new ArrayBuffer(a*b),c=this._particles;c.length=0;for(var e=this._quads,f=e.length=0;f<a;f++)c[f]=new cc.Particle,e[f]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,d,f*b);this._totalParticles=this._allocatedParticles=a;if(this._batchNode)for(b=0;b<a;b++)c[b].atlasIndex=b;this._quadsArrayBuffer=
d;this.initIndices();this._setupVBO();this._texture&&this.initTexCoordsWithRect(cc.rect(0,0,this._texture.width,this._texture.height))}else this._totalParticles=a;this.resetSystem()}},getTexture:function(){return this._texture},setTexture:function(a){a.isLoaded()?this.setTextureWithRect(a,cc.rect(0,0,a.width,a.height)):(this._textureLoaded=!1,a.addLoadedEventListener(function(a){this._textureLoaded=!0;this.setTextureWithRect(a,cc.rect(0,0,a.width,a.height))},this))},getBlendFunc:function(){return this._blendFunc},
setBlendFunc:function(a,b){if(void 0===b)this._blendFunc!=a&&(this._blendFunc=a,this._updateBlendFunc());else if(this._blendFunc.src!=a||this._blendFunc.dst!=b)this._blendFunc={src:a,dst:b},this._updateBlendFunc()},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(a){this._opacityModifyRGB=a},isBlendAdditive:function(){return this._blendFunc.src==cc.SRC_ALPHA&&this._blendFunc.dst==cc.ONE||this._blendFunc.src==cc.ONE&&this._blendFunc.dst==cc.ONE},setBlendAdditive:function(a){var b=
this._blendFunc;a?(b.src=cc.SRC_ALPHA,b.dst=cc.ONE):cc._renderType===cc._RENDER_TYPE_WEBGL?this._texture&&!this._texture.hasPremultipliedAlpha()?(b.src=cc.SRC_ALPHA,b.dst=cc.ONE_MINUS_SRC_ALPHA):(b.src=cc.BLEND_SRC,b.dst=cc.BLEND_DST):(b.src=cc.BLEND_SRC,b.dst=cc.BLEND_DST)},getPositionType:function(){return this.positionType},setPositionType:function(a){this.positionType=a},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(a){this.autoRemoveOnFinish=a},
getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(a){this.emitterMode=a},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(a){this._plistFile=a;a=cc.loader.getRes(a);return!a?(cc.log("cc.ParticleSystem.initWithFile(): Particles: file not found"),!1):this.initWithDictionary(a,"")},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc._canvas.width,cc._canvas.height)},initWithDictionary:function(a,b){var d=!1,c=null,c=this._valueForKey,e=parseInt(c("maxParticles",
a));if(this.initWithTotalParticles(e)){this.angle=parseFloat(c("angle",a));this.angleVar=parseFloat(c("angleVariance",a));this.duration=parseFloat(c("duration",a));this._blendFunc.src=parseInt(c("blendFuncSource",a));this._blendFunc.dst=parseInt(c("blendFuncDestination",a));d=this._startColor;d.r=255*parseFloat(c("startColorRed",a));d.g=255*parseFloat(c("startColorGreen",a));d.b=255*parseFloat(c("startColorBlue",a));d.a=255*parseFloat(c("startColorAlpha",a));d=this._startColorVar;d.r=255*parseFloat(c("startColorVarianceRed",
a));d.g=255*parseFloat(c("startColorVarianceGreen",a));d.b=255*parseFloat(c("startColorVarianceBlue",a));d.a=255*parseFloat(c("startColorVarianceAlpha",a));d=this._endColor;d.r=255*parseFloat(c("finishColorRed",a));d.g=255*parseFloat(c("finishColorGreen",a));d.b=255*parseFloat(c("finishColorBlue",a));d.a=255*parseFloat(c("finishColorAlpha",a));d=this._endColorVar;d.r=255*parseFloat(c("finishColorVarianceRed",a));d.g=255*parseFloat(c("finishColorVarianceGreen",a));d.b=255*parseFloat(c("finishColorVarianceBlue",
a));d.a=255*parseFloat(c("finishColorVarianceAlpha",a));this.startSize=parseFloat(c("startParticleSize",a));this.startSizeVar=parseFloat(c("startParticleSizeVariance",a));this.endSize=parseFloat(c("finishParticleSize",a));this.endSizeVar=parseFloat(c("finishParticleSizeVariance",a));this.setPosition(parseFloat(c("sourcePositionx",a)),parseFloat(c("sourcePositiony",a)));this._posVar.x=parseFloat(c("sourcePositionVariancex",a));this._posVar.y=parseFloat(c("sourcePositionVariancey",a));this.startSpin=
parseFloat(c("rotationStart",a));this.startSpinVar=parseFloat(c("rotationStartVariance",a));this.endSpin=parseFloat(c("rotationEnd",a));this.endSpinVar=parseFloat(c("rotationEndVariance",a));this.emitterMode=parseInt(c("emitterType",a));if(this.emitterMode==cc.ParticleSystem.MODE_GRAVITY)d=this.modeA,d.gravity.x=parseFloat(c("gravityx",a)),d.gravity.y=parseFloat(c("gravityy",a)),d.speed=parseFloat(c("speed",a)),d.speedVar=parseFloat(c("speedVariance",a)),e=c("radialAcceleration",a),d.radialAccel=
e?parseFloat(e):0,e=c("radialAccelVariance",a),d.radialAccelVar=e?parseFloat(e):0,e=c("tangentialAcceleration",a),d.tangentialAccel=e?parseFloat(e):0,e=c("tangentialAccelVariance",a),d.tangentialAccelVar=e?parseFloat(e):0,e=c("rotationIsDir",a).toLowerCase(),d.rotationIsDir=null!=e&&("true"===e||"1"===e);else if(this.emitterMode==cc.ParticleSystem.MODE_RADIUS)d=this.modeB,d.startRadius=parseFloat(c("maxRadius",a)),d.startRadiusVar=parseFloat(c("maxRadiusVariance",a)),d.endRadius=parseFloat(c("minRadius",
a)),d.endRadiusVar=0,d.rotatePerSecond=parseFloat(c("rotatePerSecond",a)),d.rotatePerSecondVar=parseFloat(c("rotatePerSecondVariance",a));else return cc.log("cc.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),!1;this.life=parseFloat(c("particleLifespan",a));this.lifeVar=parseFloat(c("particleLifespanVariance",a));this.emissionRate=this._totalParticles/this.life;if(!this._batchNode)if(this._opacityModifyRGB=!1,d=c("textureFileName",a),d=cc.path.changeBasename(this._plistFile,
d),e=cc.textureCache.textureForKey(d))this.setTexture(e);else if(c=c("textureImageData",a),!c||0===c.length){e=cc.textureCache.addImage(d);if(!e)return!1;this.setTexture(e)}else{c=cc.unzipBase64AsArray(c,1);if(!c)return cc.log("cc.ParticleSystem: error decoding or ungzipping textureImageData"),!1;e=cc.getImageFormatByData(c);if(e!==cc.FMT_TIFF&&e!==cc.FMT_PNG)return cc.log("cc.ParticleSystem: unknown image format with Data"),!1;var f=cc.newElement("canvas");e===cc.FMT_PNG?(new cc.PNGReader(c)).render(f):
cc.tiffReader.parseTIFF(c,f);cc.textureCache.cacheImage(d,f);(c=cc.textureCache.textureForKey(d))||cc.log("cc.ParticleSystem.initWithDictionary() : error loading the texture");this.setTexture(c)}d=!0}return d},initWithTotalParticles:function(a){this._totalParticles=a;var b,d=this._particles;for(b=d.length=0;b<a;b++)d[b]=new cc.Particle;if(!d)return cc.log("Particle system: not enough memory"),!1;this._allocatedParticles=a;if(this._batchNode)for(b=0;b<this._totalParticles;b++)d[b].atlasIndex=b;this._isActive=
!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.positionType=cc.ParticleSystem.TYPE_FREE;this.emitterMode=cc.ParticleSystem.MODE_GRAVITY;this._transformSystemDirty=this.autoRemoveOnFinish=!1;this.scheduleUpdateWithPriority(1);if(cc._renderType===cc._RENDER_TYPE_WEBGL){if(!this._allocMemory())return!1;this.initIndices();this._setupVBO();this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)}return!0},destroyParticleSystem:function(){this.unscheduleUpdate()},
addParticle:function(){if(this.isFull())return!1;var a,b=this._particles;cc._renderType===cc._RENDER_TYPE_CANVAS?this.particleCount<b.length?a=b[this.particleCount]:(a=new cc.Particle,b.push(a)):a=b[this.particleCount];this.initParticle(a);++this.particleCount;return!0},initParticle:function(a){var b=cc.randomMinus1To1;a.timeToLive=this.life+this.lifeVar*b();a.timeToLive=Math.max(0,a.timeToLive);a.pos.x=this._sourcePosition.x+this._posVar.x*b();a.pos.y=this._sourcePosition.y+this._posVar.y*b();var d,
c;d=this._startColor;var e=this._startColorVar,f=this._endColor;c=this._endColorVar;cc._renderType===cc._RENDER_TYPE_CANVAS?(d=cc.color(cc.clampf(d.r+e.r*b(),0,255),cc.clampf(d.g+e.g*b(),0,255),cc.clampf(d.b+e.b*b(),0,255),cc.clampf(d.a+e.a*b(),0,255)),c=cc.color(cc.clampf(f.r+c.r*b(),0,255),cc.clampf(f.g+c.g*b(),0,255),cc.clampf(f.b+c.b*b(),0,255),cc.clampf(f.a+c.a*b(),0,255))):(d={r:cc.clampf(d.r+e.r*b(),0,255),g:cc.clampf(d.g+e.g*b(),0,255),b:cc.clampf(d.b+e.b*b(),0,255),a:cc.clampf(d.a+e.a*b(),
0,255)},c={r:cc.clampf(f.r+c.r*b(),0,255),g:cc.clampf(f.g+c.g*b(),0,255),b:cc.clampf(f.b+c.b*b(),0,255),a:cc.clampf(f.a+c.a*b(),0,255)});a.color=d;e=a.deltaColor;f=a.timeToLive;e.r=(c.r-d.r)/f;e.g=(c.g-d.g)/f;e.b=(c.b-d.b)/f;e.a=(c.a-d.a)/f;d=this.startSize+this.startSizeVar*b();d=Math.max(0,d);a.size=d;this.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE?a.deltaSize=0:(c=this.endSize+this.endSizeVar*b(),c=Math.max(0,c),a.deltaSize=(c-d)/f);d=this.startSpin+this.startSpinVar*b();c=this.endSpin+
this.endSpinVar*b();a.rotation=d;a.deltaRotation=(c-d)/f;this.positionType==cc.ParticleSystem.TYPE_FREE?a.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType==cc.ParticleSystem.TYPE_RELATIVE&&(a.startPos.x=this._position.x,a.startPos.y=this._position.y);d=cc.degreesToRadians(this.angle+this.angleVar*b());if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY)f=this.modeA,c=a.modeA,e=f.speed+f.speedVar*b(),c.dir.x=Math.cos(d),c.dir.y=Math.sin(d),cc.pMultIn(c.dir,e),c.radialAccel=
f.radialAccel+f.radialAccelVar*b(),c.tangentialAccel=f.tangentialAccel+f.tangentialAccelVar*b(),f.rotationIsDir&&(a.rotation=-cc.radiansToDegrees(cc.pToAngle(c.dir)));else{c=this.modeB;a=a.modeB;var e=c.startRadius+c.startRadiusVar*b(),g=c.endRadius+c.endRadiusVar*b();a.radius=e;a.deltaRadius=c.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(g-e)/f;a.angle=d;a.degreesPerSecond=cc.degreesToRadians(c.rotatePerSecond+c.rotatePerSecondVar*b())}},stopSystem:function(){this._isActive=
!1;this._elapsed=this.duration;this._emitCounter=0},resetSystem:function(){this._isActive=!0;this._elapsed=0;var a=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)a[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(a,b){var d=null;this._batchNode?(d=this._batchNode.textureAtlas.quads[this.atlasIndex+a.atlasIndex],this._batchNode.textureAtlas.dirty=!0):d=this._quads[this._particleIdx];
var c,e,f,g;this._opacityModifyRGB?(c=0|a.color.r*a.color.a/255,e=0|a.color.g*a.color.a/255,f=0|a.color.b*a.color.a/255):(c=0|a.color.r,e=0|a.color.g,f=0|a.color.b);g=0|a.color.a;var h=d.bl.colors;h.r=c;h.g=e;h.b=f;h.a=g;h=d.br.colors;h.r=c;h.g=e;h.b=f;h.a=g;h=d.tl.colors;h.r=c;h.g=e;h.b=f;h.a=g;h=d.tr.colors;h.r=c;h.g=e;h.b=f;h.a=g;c=a.size/2;if(a.rotation){e=-c;f=-c;g=b.x;var h=b.y,k=-cc.degreesToRadians(a.rotation),l=Math.cos(k),k=Math.sin(k);d.bl.vertices.x=e*l-f*k+g;d.bl.vertices.y=e*k+f*l+h;
d.br.vertices.x=c*l-f*k+g;d.br.vertices.y=c*k+f*l+h;d.tl.vertices.x=e*l-c*k+g;d.tl.vertices.y=e*k+c*l+h;d.tr.vertices.x=c*l-c*k+g;d.tr.vertices.y=c*k+c*l+h}else d.bl.vertices.x=b.x-c,d.bl.vertices.y=b.y-c,d.br.vertices.x=b.x+c,d.br.vertices.y=b.y-c,d.tl.vertices.x=b.x-c,d.tl.vertices.y=b.y+c,d.tr.vertices.x=b.x+c,d.tr.vertices.y=b.y+c},postStep:function(){if(cc._renderType===cc._RENDER_TYPE_WEBGL){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._buffersVBO[0]);a.bufferData(a.ARRAY_BUFFER,
this._quadsArrayBuffer,a.DYNAMIC_DRAW)}},update:function(a){if(this._isActive&&this.emissionRate){var b=1/this.emissionRate;this.particleCount<this._totalParticles&&(this._emitCounter+=a);for(;this.particleCount<this._totalParticles&&this._emitCounter>b;)this.addParticle(),this._emitCounter-=b;this._elapsed+=a;-1!=this.duration&&this.duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;b=cc.Particle.TemporaryPoints[0];this.positionType==cc.ParticleSystem.TYPE_FREE?cc.pIn(b,this.convertToWorldSpace(this._pointZeroForParticle)):
this.positionType==cc.ParticleSystem.TYPE_RELATIVE&&(b.x=this._position.x,b.y=this._position.y);if(this._visible){for(var d=cc.Particle.TemporaryPoints[1],c=cc.Particle.TemporaryPoints[2],e=cc.Particle.TemporaryPoints[3],f=this._particles;this._particleIdx<this.particleCount;){cc.pZeroIn(d);cc.pZeroIn(c);cc.pZeroIn(e);var g=f[this._particleIdx];g.timeToLive-=a;if(0<g.timeToLive){if(this.emitterMode==cc.ParticleSystem.MODE_GRAVITY){var h=e,k=d,l=c;g.pos.x||g.pos.y?(cc.pIn(k,g.pos),cc.pNormalizeIn(k)):
cc.pZeroIn(k);cc.pIn(l,k);cc.pMultIn(k,g.modeA.radialAccel);var n=l.x;l.x=-l.y;l.y=n;cc.pMultIn(l,g.modeA.tangentialAccel);cc.pIn(h,k);cc.pAddIn(h,l);cc.pAddIn(h,this.modeA.gravity);cc.pMultIn(h,a);cc.pAddIn(g.modeA.dir,h);cc.pIn(h,g.modeA.dir);cc.pMultIn(h,a);cc.pAddIn(g.pos,h)}else h=g.modeB,h.angle+=h.degreesPerSecond*a,h.radius+=h.deltaRadius*a,g.pos.x=-Math.cos(h.angle)*h.radius,g.pos.y=-Math.sin(h.angle)*h.radius;if(!this._dontTint||cc._renderType===cc._RENDER_TYPE_WEBGL)g.color.r+=0|g.deltaColor.r*
a,g.color.g+=0|g.deltaColor.g*a,g.color.b+=0|g.deltaColor.b*a,g.color.a+=0|g.deltaColor.a*a,g.isChangeColor=!0;g.size+=g.deltaSize*a;g.size=Math.max(0,g.size);g.rotation+=g.deltaRotation*a;h=d;this.positionType==cc.ParticleSystem.TYPE_FREE||this.positionType==cc.ParticleSystem.TYPE_RELATIVE?(k=c,cc.pIn(k,b),cc.pSubIn(k,g.startPos),cc.pIn(h,g.pos),cc.pSubIn(h,k)):cc.pIn(h,g.pos);this._batchNode&&(h.x+=this._position.x,h.y+=this._position.y);cc._renderType==cc._RENDER_TYPE_WEBGL?this.updateQuadWithParticle(g,
h):cc.pIn(g.drawPos,h);++this._particleIdx}else if(g=g.atlasIndex,this._particleIdx!==this.particleCount-1&&(h=f[this._particleIdx],f[this._particleIdx]=f[this.particleCount-1],f[this.particleCount-1]=h),this._batchNode&&(this._batchNode.disableParticle(this.atlasIndex+g),f[this.particleCount-1].atlasIndex=g),--this.particleCount,0==this.particleCount&&this.autoRemoveOnFinish){this.unscheduleUpdate();this._parent.removeChild(this,!0);return}}this._transformSystemDirty=!1}this._batchNode||this.postStep()},
updateWithNoTime:function(){this.update(0)},_valueForKey:function(a,b){if(b){var d=b[a];return null!=d?d:""}return""},_updateBlendFunc:function(){if(this._batchNode)cc.log("Can't change blending functions when the particle is being batched");else{var a=this._texture;if(a&&a instanceof cc.Texture2D){this._opacityModifyRGB=!1;var b=this._blendFunc;b.src==cc.BLEND_SRC&&b.dst==cc.BLEND_DST&&(a.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(b.src=cc.SRC_ALPHA,b.dst=cc.ONE_MINUS_SRC_ALPHA))}}},clone:function(){var a=
new cc.ParticleSystem;if(a.initWithTotalParticles(this.getTotalParticles())){a.setAngle(this.getAngle());a.setAngleVar(this.getAngleVar());a.setDuration(this.getDuration());var b=this.getBlendFunc();a.setBlendFunc(b.src,b.dst);a.setStartColor(this.getStartColor());a.setStartColorVar(this.getStartColorVar());a.setEndColor(this.getEndColor());a.setEndColorVar(this.getEndColorVar());a.setStartSize(this.getStartSize());a.setStartSizeVar(this.getStartSizeVar());a.setEndSize(this.getEndSize());a.setEndSizeVar(this.getEndSizeVar());
a.setPosition(cc.p(this.x,this.y));a.setPosVar(cc.p(this.getPosVar().x,this.getPosVar().y));a.setStartSpin(this.getStartSpin()||0);a.setStartSpinVar(this.getStartSpinVar()||0);a.setEndSpin(this.getEndSpin()||0);a.setEndSpinVar(this.getEndSpinVar()||0);a.setEmitterMode(this.getEmitterMode());this.getEmitterMode()==cc.ParticleSystem.MODE_GRAVITY?(b=this.getGravity(),a.setGravity(cc.p(b.x,b.y)),a.setSpeed(this.getSpeed()),a.setSpeedVar(this.getSpeedVar()),a.setRadialAccel(this.getRadialAccel()),a.setRadialAccelVar(this.getRadialAccelVar()),
a.setTangentialAccel(this.getTangentialAccel()),a.setTangentialAccelVar(this.getTangentialAccelVar())):this.getEmitterMode()==cc.ParticleSystem.MODE_RADIUS&&(a.setStartRadius(this.getStartRadius()),a.setStartRadiusVar(this.getStartRadiusVar()),a.setEndRadius(this.getEndRadius()),a.setEndRadiusVar(this.getEndRadiusVar()),a.setRotatePerSecond(this.getRotatePerSecond()),a.setRotatePerSecondVar(this.getRotatePerSecondVar()));a.setLife(this.getLife());a.setLifeVar(this.getLifeVar());a.setEmissionRate(this.getEmissionRate());
if(!this.getBatchNode()&&(a.setOpacityModifyRGB(this.isOpacityModifyRGB()),b=this.getTexture())){var d=b.getContentSize();a.setTextureWithRect(b,cc.rect(0,0,d.width,d.height))}}return a},setDisplayFrame:function(a){var b=a.getOffsetInPixels();(0!=b.x||0!=b.y)&&cc.log("cc.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets");cc._renderType===cc._RENDER_TYPE_WEBGL&&(!this._texture||a.getTexture()._webTextureObj!=this._texture._webTextureObj)&&this.setTexture(a.getTexture())},
setTextureWithRect:function(a,b){var d=this._texture;if(cc._renderType===cc._RENDER_TYPE_WEBGL){if((!d||a._webTextureObj!=d._webTextureObj)&&d!=a)this._texture=a,this._updateBlendFunc()}else if((!d||a!=d)&&d!=a)this._texture=a,this._updateBlendFunc();this._pointRect=b;this.initTexCoordsWithRect(b)},draw:function(a){this._textureLoaded&&!this._batchNode&&(cc._renderType===cc._RENDER_TYPE_CANVAS?this._drawForCanvas(a):this._drawForWebGL(a),cc.g_NumberOfDraws++)},_drawForCanvas:function(a){a=a||cc._renderContext;
a.save();this.isBlendAdditive()?a.globalCompositeOperation="lighter":a.globalCompositeOperation="source-over";for(var b=this._texture.getHtmlElementObj(),d=0;d<this.particleCount;d++){var c=this._particles[d],e=0|0.5*c.size;if(this.drawMode==cc.ParticleSystem.TEXTURE_MODE){if(b.width&&b.height){a.save();a.globalAlpha=c.color.a/255;a.translate(0|c.drawPos.x,-(0|c.drawPos.y));var e=4*Math.floor(c.size/4),f=this._pointRect.width,g=this._pointRect.height;a.scale(Math.max(1/f*e,1E-6),Math.max(1/g*e,1E-6));
c.rotation&&a.rotate(cc.degreesToRadians(c.rotation));a.translate(-(0|f/2),-(0|g/2));(c=c.isChangeColor?this._changeTextureColor(b,c.color,this._pointRect):b)&&a.drawImage(c,0,0);a.restore()}}else a.save(),a.globalAlpha=c.color.a/255,a.translate(0|c.drawPos.x,-(0|c.drawPos.y)),this.shapeType==cc.ParticleSystem.STAR_SHAPE?(c.rotation&&a.rotate(cc.degreesToRadians(c.rotation)),cc._drawingUtil.drawStar(a,e,c.color)):cc._drawingUtil.drawColorBall(a,e,c.color),a.restore()}a.restore()},_changeTextureColor:function(a,
b,d){b.r|=0;b.g|=0;b.b|=0;a.tintCache||(a.tintCache=document.createElement("canvas"),a.tintCache.width=a.width,a.tintCache.height=a.height);return cc.generateTintImageWithMultiply(a,b,d,a.tintCache)},_drawForWebGL:function(a){this._texture&&(a=a||cc._renderContext,this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBindTexture2D(this._texture),cc.glBlendFuncForParticle(this._blendFunc.src,this._blendFunc.dst),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),
a.bindBuffer(a.ARRAY_BUFFER,this._buffersVBO[0]),a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,a.FLOAT,!1,24,0),a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,24,12),a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,24,16),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),a.drawElements(a.TRIANGLES,6*this._particleIdx,a.UNSIGNED_SHORT,0))},listenBackToForeground:function(a){cc.TEXTURE_ATLAS_USE_VAO?this._setupVBOandVAO():this._setupVBO()},_setupVBOandVAO:function(){},
_setupVBO:function(){if(cc._renderType!=cc._RENDER_TYPE_CANVAS){var a=cc._renderContext;this._buffersVBO[0]=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._buffersVBO[0]);a.bufferData(a.ARRAY_BUFFER,this._quadsArrayBuffer,a.DYNAMIC_DRAW);this._buffersVBO[1]=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,a.STATIC_DRAW)}},_allocMemory:function(){if(cc._renderType===cc._RENDER_TYPE_CANVAS)return!0;if(this._batchNode)return cc.log("cc.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),
!1;var a=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,b=this._totalParticles,d=this._quads;d.length=0;this._indices=new Uint16Array(6*b);for(var c=new ArrayBuffer(a*b),e=0;e<b;e++)d[e]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,c,e*a);if(!d||!this._indices)return cc.log("cocos2d: Particle system: not enough memory"),!1;this._quadsArrayBuffer=c;return!0}});var _p=cc.ParticleSystem.prototype;
cc._renderType===cc._RENDER_TYPE_CANVAS&&!cc.sys._supportCanvasNewBlendModes&&(_p._changeTextureColor=function(a,b,d){var c=cc.textureCache.getTextureColors(a);return c?(c.tintCache||(c.tintCache=document.createElement("canvas"),c.tintCache.width=a.width,c.tintCache.height=a.height),cc.generateTintImage(a,c,b,d,c.tintCache),c.tintCache):null});cc.defineGetterSetter(_p,"opacityModifyRGB",_p.isOpacityModifyRGB,_p.setOpacityModifyRGB);cc.defineGetterSetter(_p,"batchNode",_p.getBatchNode,_p.setBatchNode);
cc.defineGetterSetter(_p,"active",_p.isActive);cc.defineGetterSetter(_p,"sourcePos",_p.getSourcePosition,_p.setSourcePosition);cc.defineGetterSetter(_p,"posVar",_p.getPosVar,_p.setPosVar);cc.defineGetterSetter(_p,"gravity",_p.getGravity,_p.setGravity);cc.defineGetterSetter(_p,"speed",_p.getSpeed,_p.setSpeed);cc.defineGetterSetter(_p,"speedVar",_p.getSpeedVar,_p.setSpeedVar);cc.defineGetterSetter(_p,"tangentialAccel",_p.getTangentialAccel,_p.setTangentialAccel);
cc.defineGetterSetter(_p,"tangentialAccelVar",_p.getTangentialAccelVar,_p.setTangentialAccelVar);cc.defineGetterSetter(_p,"radialAccel",_p.getRadialAccel,_p.setRadialAccel);cc.defineGetterSetter(_p,"radialAccelVar",_p.getRadialAccelVar,_p.setRadialAccelVar);cc.defineGetterSetter(_p,"rotationIsDir",_p.getRotationIsDir,_p.setRotationIsDir);cc.defineGetterSetter(_p,"startRadius",_p.getStartRadius,_p.setStartRadius);cc.defineGetterSetter(_p,"startRadiusVar",_p.getStartRadiusVar,_p.setStartRadiusVar);
cc.defineGetterSetter(_p,"endRadius",_p.getEndRadius,_p.setEndRadius);cc.defineGetterSetter(_p,"endRadiusVar",_p.getEndRadiusVar,_p.setEndRadiusVar);cc.defineGetterSetter(_p,"rotatePerS",_p.getRotatePerSecond,_p.setRotatePerSecond);cc.defineGetterSetter(_p,"rotatePerSVar",_p.getRotatePerSecondVar,_p.setRotatePerSecondVar);cc.defineGetterSetter(_p,"startColor",_p.getStartColor,_p.setStartColor);cc.defineGetterSetter(_p,"startColorVar",_p.getStartColorVar,_p.setStartColorVar);
cc.defineGetterSetter(_p,"endColor",_p.getEndColor,_p.setEndColor);cc.defineGetterSetter(_p,"endColorVar",_p.getEndColorVar,_p.setEndColorVar);cc.defineGetterSetter(_p,"totalParticles",_p.getTotalParticles,_p.setTotalParticles);cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.ParticleSystem.create=function(a){return new cc.ParticleSystem(a)};cc.ParticleSystem.createWithTotalParticles=cc.ParticleSystem.create;
cc.ParticleSystem.ModeA=function(a,b,d,c,e,f,g,h){this.gravity=a?a:cc.p(0,0);this.speed=b||0;this.speedVar=d||0;this.tangentialAccel=c||0;this.tangentialAccelVar=e||0;this.radialAccel=f||0;this.radialAccelVar=g||0;this.rotationIsDir=h||!1};cc.ParticleSystem.ModeB=function(a,b,d,c,e,f){this.startRadius=a||0;this.startRadiusVar=b||0;this.endRadius=d||0;this.endRadiusVar=c||0;this.rotatePerSecond=e||0;this.rotatePerSecondVar=f||0};cc.ParticleSystem.SHAPE_MODE=0;cc.ParticleSystem.TEXTURE_MODE=1;
cc.ParticleSystem.STAR_SHAPE=0;cc.ParticleSystem.BALL_SHAPE=1;cc.ParticleSystem.DURATION_INFINITY=-1;cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1;cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1;cc.ParticleSystem.MODE_GRAVITY=0;cc.ParticleSystem.MODE_RADIUS=1;cc.ParticleSystem.TYPE_FREE=0;cc.ParticleSystem.TYPE_RELATIVE=1;cc.ParticleSystem.TYPE_GROUPED=2;cc.ParticleFire=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?300:150)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(60),this.setSpeedVar(20),this.setAngle(90),this.setAngleVar(10),
a=cc.director.getWinSize(),this.setPosition(a.width/2,60),this.setPosVar(cc.p(40,20)),this.setLife(3),this.setLifeVar(0.25),this.setStartSize(54),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(194,64,31,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0):!1}});
cc.ParticleFire.create=function(){return new cc.ParticleFire};
cc.ParticleFireworks=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?1500:150)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,-90)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(180),this.setSpeedVar(50),a=cc.director.getWinSize(),
this.setPosition(a.width/2,a.height/2),this.setAngle(90),this.setAngleVar(20),this.setLife(3.5),this.setLifeVar(1),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,255)),this.setEndColor(cc.color(26,26,26,51)),this.setEndColorVar(cc.color(26,26,26,51)),this.setStartSize(8),this.setStartSizeVar(2),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setBlendAdditive(!1),!0):!1}});
cc.ParticleFireworks.create=function(){return new cc.ParticleFireworks};
cc.ParticleSun=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?350:150)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setBlendAdditive(!0),this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(20),this.setSpeedVar(5),
this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(1),this.setLifeVar(0.5),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(194,64,31,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),
!0):!1}});cc.ParticleSun.create=function(){return new cc.ParticleSun};
cc.ParticleGalaxy=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(60),this.setSpeedVar(10),this.setRadialAccel(-80),this.setRadialAccelVar(0),this.setTangentialAccel(80),
this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(37),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(31,64,194,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,
0,0,0)),this.setBlendAdditive(!0),!0):!1}});cc.ParticleGalaxy.create=function(){return new cc.ParticleGalaxy};
cc.ParticleFlower=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?250:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(80),this.setSpeedVar(10),this.setRadialAccel(-60),this.setRadialAccelVar(0),this.setTangentialAccel(15),
this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,128)),this.setEndColor(cc.color(0,0,0,255)),
this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0):!1}});cc.ParticleFlower.create=function(){return new cc.ParticleFlower};
cc.ParticleMeteor=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?150:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(-200,200)),this.setSpeed(15),this.setSpeedVar(5),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),
this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(2),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(51,102,179)),this.setStartColorVar(cc.color(0,0,51,26)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,
0,0,0)),this.setBlendAdditive(!0),!0):!1}});cc.ParticleMeteor.create=function(){return new cc.ParticleMeteor};
cc.ParticleSpiral=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?500:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(150),this.setSpeedVar(0),this.setRadialAccel(-380),this.setRadialAccelVar(0),this.setTangentialAccel(45),
this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(0),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(12),this.setLifeVar(0),this.setStartSize(20),this.setStartSizeVar(0),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,0)),this.setEndColor(cc.color(128,128,128,255)),
this.setEndColorVar(cc.color(128,128,128,0)),this.setBlendAdditive(!1),!0):!1}});cc.ParticleSpiral.create=function(){return new cc.ParticleSpiral};
cc.ParticleExplosion=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?700:300)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(0.1),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(70),this.setSpeedVar(40),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),
this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(5),this.setLifeVar(2),this.setStartSize(15),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getDuration()),this.setStartColor(cc.color(179,26,51,255)),this.setStartColorVar(cc.color(128,128,128,0)),this.setEndColor(cc.color(128,128,128,0)),this.setEndColorVar(cc.color(128,
128,128,0)),this.setBlendAdditive(!1),!0):!1}});cc.ParticleExplosion.create=function(){return new cc.ParticleExplosion};
cc.ParticleSmoke=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(25),this.setSpeedVar(10),this.setAngle(90),this.setAngleVar(5),
a=cc.director.getWinSize(),this.setPosition(a.width/2,0),this.setPosVar(cc.p(20,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(204,204,204,255)),this.setStartColorVar(cc.color(5,5,5,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0):!1}});
cc.ParticleSmoke.create=function(){return new cc.ParticleSmoke};
cc.ParticleSnow=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?700:250)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,-1)),this.setSpeed(5),this.setSpeedVar(1),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),
this.setTangentialAccelVar(1),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height+10),this.setPosVar(cc.p(a.width/2,0)),this.setAngle(-90),this.setAngleVar(5),this.setLife(45),this.setLifeVar(15),this.setStartSize(10),this.setStartSizeVar(5),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(10),this.setStartColor(cc.color(255,255,255,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(255,255,255,0)),this.setEndColorVar(cc.color(0,
0,0,0)),this.setBlendAdditive(!1),!0):!1}});cc.ParticleSnow.create=function(){return new cc.ParticleSnow};
cc.ParticleRain=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc._RENDER_TYPE_WEBGL?1E3:300)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(10,-10)),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),this.setSpeed(130),
this.setSpeedVar(30),this.setAngle(-90),this.setAngleVar(5),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height),this.setPosVar(cc.p(a.width/2,0)),this.setLife(4.5),this.setLifeVar(0),this.setStartSize(4),this.setStartSizeVar(2),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(20),this.setStartColor(cc.color(179,204,255,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(179,204,255,128)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),
!0):!1}});cc.ParticleRain.create=function(){return new cc.ParticleRain};cc.PARTICLE_DEFAULT_CAPACITY=500;
cc.ParticleBatchNode=cc.Node.extend({textureAtlas:null,TextureProtocol:!0,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(a,b){cc.Node.prototype.ctor.call(this);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};"string"==typeof a?this.init(a,b):a instanceof cc.Texture2D&&this.initWithTexture(a,b)},initWithTexture:function(a,b){this.textureAtlas=new cc.TextureAtlas;this.textureAtlas.initWithTexture(a,b);this._children.length=0;cc._renderType===cc._RENDER_TYPE_WEBGL&&(this.shaderProgram=
cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR));return!0},initWithFile:function(a,b){var d=cc.textureCache.addImage(a);return this.initWithTexture(d,b)},init:function(a,b){var d=cc.TextureCache.getInstance().addImage(a);return this.initWithTexture(d,b)},addChild:function(a,b,d){if(!a)throw"cc.ParticleBatchNode.addChild() : child should be non-null";if(!(a instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.addChild() : only supports cc.ParticleSystem as children";b=null==b?a.zIndex:
b;d=null==d?a.tag:d;if(a.getTexture()!=this.textureAtlas.texture)throw"cc.ParticleSystem.addChild() : the child is not using the same texture id";var c=a.getBlendFunc();if(0===this._children.length)this.setBlendFunc(c);else if(c.src!=this._blendFunc.src||c.dst!=this._blendFunc.dst){cc.log("cc.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");return}b=this._addChildHelper(a,b,d);d=0;0!=b?(b=this._children[b-1],d=b.getAtlasIndex()+b.getTotalParticles()):
d=0;this.insertChild(a,d);a.setBatchNode(this)},insertChild:function(a,b){var d=a.getTotalParticles(),c=this.textureAtlas,e=c.totalQuads;a.setAtlasIndex(b);e+d>c.getCapacity()&&(this._increaseAtlasCapacityTo(e+d),c.fillWithEmptyQuadsFromIndex(c.getCapacity()-d,d));a.getAtlasIndex()+d!=e&&c.moveQuadsFromIndex(b,b+d);c.increaseTotalQuadsWith(d);this._updateAllAtlasIndexes()},removeChild:function(a,b){if(null!=a){if(!(a instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.removeChild(): only supports cc.ParticleSystem as children";
if(-1==this._children.indexOf(a))cc.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");else{cc.Node.prototype.removeChild.call(this,a,b);var d=this.textureAtlas;d.removeQuadsAtIndex(a.getAtlasIndex(),a.getTotalParticles());d.fillWithEmptyQuadsFromIndex(d.totalQuads,a.getTotalParticles());a.setBatchNode(null);this._updateAllAtlasIndexes()}}},reorderChild:function(a,b){if(!a)throw"cc.ParticleBatchNode.reorderChild(): child should be non-null";if(!(a instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children";
if(-1===this._children.indexOf(a))cc.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");else if(b!=a.zIndex){if(1<this._children.length){var d=this._getCurrentIndex(a,b);if(d.oldIndex!=d.newIndex){this._children.splice(d.oldIndex,1);this._children.splice(d.newIndex,0,a);d=a.getAtlasIndex();this._updateAllAtlasIndexes();for(var c=0,e=this._children,f=0;f<e.length;f++)if(e[f]==a){c=a.getAtlasIndex();break}this.textureAtlas.moveQuadsFromIndex(d,a.getTotalParticles(),c);a.updateWithNoTime()}}a._setLocalZOrder(b)}},
removeChildAtIndex:function(a,b){this.removeChild(this._children[i],b)},removeAllChildren:function(a){for(var b=this._children,d=0;d<b.length;d++)b[d].setBatchNode(null);cc.Node.prototype.removeAllChildren.call(this,a);this.textureAtlas.removeAllQuads()},disableParticle:function(a){a=this.textureAtlas.quads[a];a.br.vertices.x=a.br.vertices.y=a.tr.vertices.x=a.tr.vertices.y=a.tl.vertices.x=a.tl.vertices.y=a.bl.vertices.x=a.bl.vertices.y=0;this.textureAtlas._setDirty(!0)},draw:function(a){cc._renderType!==
cc._RENDER_TYPE_CANVAS&&0!=this.textureAtlas.totalQuads&&(cc.nodeDrawSetup(this),cc.glBlendFuncForParticle(this._blendFunc.src,this._blendFunc.dst),this.textureAtlas.drawQuads())},getTexture:function(){return this.textureAtlas.texture},setTexture:function(a){this.textureAtlas.texture=a;var b=this._blendFunc;a&&(!a.hasPremultipliedAlpha()&&b.src==cc.BLEND_SRC&&b.dst==cc.BLEND_DST)&&(b.src=cc.SRC_ALPHA,b.dst=cc.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(a,b){void 0===b?(this._blendFunc.src=a.src,this._blendFunc.dst=
a.dst):(this._blendFunc.src=a,this._blendFunc.src=b)},getBlendFunc:function(){return{src:this._blendFunc.src,dst:this._blendFunc.dst}},visit:function(a){cc._renderType!==cc._RENDER_TYPE_CANVAS&&this._visible&&(cc.kmGLPushMatrix(),this.grid&&this.grid.isActive()&&(this.grid.beforeDraw(),this.transformAncestors()),this.transform(a),this.draw(a),this.grid&&this.grid.isActive()&&this.grid.afterDraw(this),cc.kmGLPopMatrix())},_updateAllAtlasIndexes:function(){for(var a=0,b=this._children,d=0;d<b.length;d++){var c=
b[d];c.setAtlasIndex(a);a+=c.getTotalParticles()}},_increaseAtlasCapacityTo:function(a){cc.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+"] to ["+a+"].");this.textureAtlas.resizeCapacity(a)||cc.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(a){for(var b=this._children,d=b.length,c=0;c<d;c++)if(b[c].zIndex>a)return c;return d},_getCurrentIndex:function(a,
b){for(var d=!1,c=!1,e=0,f=0,g=0,h=this._children,k=h.length,l=0;l<k;l++){var n=h[l];if(n.zIndex>b&&!c&&(e=l,c=!0,d&&c))break;if(a==n&&(f=l,d=!0,c||(g=-1),d&&c))break}c||(e=k);return{newIndex:e+g,oldIndex:f}},_addChildHelper:function(a,b,d){if(!a)throw"cc.ParticleBatchNode._addChildHelper(): child should be non-null";if(a.parent)return cc.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;this._children||(this._children=[]);var c=this._searchNewPositionInChildrenForZ(b);
this._children.splice(c,0,a);a.tag=d;a._setLocalZOrder(b);a.parent=this;this._running&&(a.onEnter(),a.onEnterTransitionDidFinish());return c},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(a){this.textureAtlas=a}});_p=cc.ParticleBatchNode.prototype;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);
cc.ParticleBatchNode.create=function(a,b){return new cc.ParticleBatchNode(a,b)};