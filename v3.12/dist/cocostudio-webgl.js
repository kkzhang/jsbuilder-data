!function(){ccs.Armature.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._parentCmd=null,this._realAnchorPointInPoints=new cc.Point(0,0)};var a=ccs.Armature.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,a),a.constructor=ccs.Armature.WebGLRenderCmd,a.uploadData=function(a,b,c){for(var d,e=this._node,f=this._parentCmd||this,g=e._children,h=cc.BlendFunc.ALPHA_PREMULTIPLIED,i=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,j=0,k=g.length;k>j;j++){var l=g[j];if(l&&l.getDisplayRenderNode){var m=l.getDisplayRenderNode();if(null===m)continue;switch(d=m._renderCmd,l.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(m instanceof ccs.Skin){m.setShaderProgram(this._shaderProgram),this._updateColorAndOpacity(d,l),d.transform(f);var n=l.getBlendFunc();n.src!==h.src||n.dst!==h.dst?m.setBlendFunc(l.getBlendFunc()):e._blendFunc.src!==h.src||e._blendFunc.dst!==h.dst||m.getTexture().hasPremultipliedAlpha()?m.setBlendFunc(e._blendFunc):m.setBlendFunc(i),cc.renderer._uploadBufferData(d)}break;case ccs.DISPLAY_TYPE_ARMATURE:m.setShaderProgram(this._shaderProgram),d._parentCmd=this;default:d.uploadData?cc.renderer._uploadBufferData(d):(cc.renderer._batchRendering(),d.transform(this),d.rendering(cc._renderContext))}}else l instanceof cc.Node&&(l.setShaderProgram(this._shaderProgram),d=l._renderCmd,d.transform(this),d.uploadData?cc.renderer._uploadBufferData(d):d.rendering&&(cc.renderer._batchRendering(),d.rendering(cc._renderContext)))}return this._parentCmd=null,0},a.initShaderCache=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},a.setShaderProgram=function(a){this._shaderProgram=a},a._updateColorAndOpacity=function(a,b){var c=b._renderCmd._displayedColor,d=b._renderCmd._displayedOpacity,e=cc.Node._dirtyFlags,f=a._dirtyFlag,g=f&e.colorDirty,h=f&e.opacityDirty;g&&a._updateDisplayColor(c),h&&a._updateDisplayOpacity(d),(g||h)&&a._updateColor()},a.visit=function(a){var b=this._node;if(b._visible){a=a||this.getParentRenderCmd(),a&&(this._curLevel=a._curLevel+1),this.updateStatus(a),b.sortAllChildren();var c,d,e=cc.renderer,f=b._children,g=f.length;for(d=0;g>d&&(c=f[d],c._localZOrder<0);d++)isNaN(c._customZ)&&(c._vertexZ=e.assignedZ,e.assignedZ+=e.assignedZStep);for(isNaN(b._customZ)&&(b._vertexZ=e.assignedZ,e.assignedZ+=e.assignedZStep),e.pushRenderCommand(this);g>d;d++)c=f[d],isNaN(c._customZ)&&(c._vertexZ=e.assignedZ,e.assignedZ+=e.assignedZStep);this._dirtyFlag=0}}}();