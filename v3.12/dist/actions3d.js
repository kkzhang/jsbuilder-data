cc.GridAction=cc.ActionInterval.extend({_gridSize:null,_gridNodeTarget:null,ctor:function(a,b){cc.sys._checkWebGLRenderMode(),cc.ActionInterval.prototype.ctor.call(this),this._gridSize=cc.size(0,0),b&&this.initWithDuration(a,b)},_cacheTargetAsGridNode:function(a){this._gridNodeTarget=a},clone:function(){var a=new cc.GridAction,b=this._gridSize;return a.initWithDuration(this._duration,cc.size(b.width,b.height)),a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a),cc.renderer.childrenOrderDirty=!0,this._cacheTargetAsGridNode(a);var b=this.getGrid(),c=this._gridNodeTarget.getGrid();if(c&&c.getReuseGrid()>0){var d=c.getGridSize();c.isActive()&&d.width===this._gridSize.width&&d.height===this._gridSize.height&&c.reuse()}else c&&c.isActive()&&c.setActive(!1),this._gridNodeTarget.setGrid(b),this._gridNodeTarget.getGrid().setActive(!0)},reverse:function(){return new cc.ReverseTime(this)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._gridSize.width=b.width,this._gridSize.height=b.height,!0):!1},getGrid:function(){cc.log("cc.GridAction.getGrid(): it should be overridden in subclass.")}}),cc.gridAction=function(a,b){return new cc.GridAction(a,b)},cc.GridAction.create=cc.gridAction,cc.Grid3DAction=cc.GridAction.extend({getGrid:function(){return new cc.Grid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect())},getGridRect:function(){return this._gridNodeTarget.getGridRect()},vertex:function(a){return this.getVertex(a)},getVertex:function(a){return this.target.grid.getVertex(a)},originalVertex:function(a){return this.getOriginalVertex(a)},getOriginalVertex:function(a){return this.target.grid.originalVertex(a)},setVertex:function(a,b){this.target.grid.setVertex(a,b)}}),cc.grid3DAction=function(a,b){return new cc.Grid3DAction(a,b)},cc.Grid3DAction.create=cc.grid3DAction,cc.TiledGrid3DAction=cc.GridAction.extend({tile:function(a){return this.getTile(a)},getTile:function(a){return this.target.grid.tile(a)},originalTile:function(a){return this.getOriginalTile(a)},getOriginalTile:function(a){return this.target.grid.originalTile(a)},setTile:function(a,b){this.target.grid.setTile(a,b)},getGrid:function(){return new cc.TiledGrid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect())}}),cc.tiledGrid3DAction=function(a,b){return new cc.TiledGrid3DAction(a,b)},cc.TiledGrid3DAction.create=cc.tiledGrid3DAction,cc.StopGrid=cc.ActionInstant.extend({startWithTarget:function(a){cc.ActionInstant.prototype.startWithTarget.call(this,a),cc.renderer.childrenOrderDirty=!0;var b=this.target.grid;b&&b.isActive()&&b.setActive(!1)}}),cc.stopGrid=function(){return new cc.StopGrid},cc.StopGrid.create=cc.stopGrid,cc.ReuseGrid=cc.ActionInstant.extend({_times:null,ctor:function(a){cc.ActionInstant.prototype.ctor.call(this),void 0!==a&&this.initWithTimes(a)},initWithTimes:function(a){return this._times=a,!0},startWithTarget:function(a){cc.ActionInstant.prototype.startWithTarget.call(this,a),cc.renderer.childrenOrderDirty=!0,this.target.grid&&this.target.grid.isActive()&&this.target.grid.setReuseGrid(this.target.grid.getReuseGrid()+this._times)}}),cc.reuseGrid=function(a){return new cc.ReuseGrid(a)},cc.ReuseGrid.create=cc.reuseGrid,cc.Waves3D=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this),void 0!==d&&this.initWithDuration(a,b,c,d)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this._waves=c,this._amplitude=d,this._amplitudeRate=1,!0):!1},update:function(a){for(var b=this._gridSize,c=this._amplitude,d=cc.p(0,0),e=this._amplitudeRate,f=this._waves,g=0;g<b.width+1;++g)for(var h=0;h<b.height+1;++h){d.x=g,d.y=h;var i=this.originalVertex(d);i.z+=Math.sin(Math.PI*a*f*2+.01*(i.y+i.x))*c*e,this.setVertex(d,i)}}}),cc.waves3D=function(a,b,c,d){return new cc.Waves3D(a,b,c,d)},cc.Waves3D.create=cc.waves3D,cc.FlipX3D=cc.Grid3DAction.extend({ctor:function(a){void 0!==a?cc.GridAction.prototype.ctor.call(this,a,cc.size(1,1)):cc.GridAction.prototype.ctor.call(this)},initWithDuration:function(a){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,cc.size(1,1))},initWithSize:function(a,b){return 1!==a.width||1!==a.height?(cc.log("Grid size must be (1,1)"),!1):cc.Grid3DAction.prototype.initWithDuration.call(this,b,a)},update:function(a){var b=Math.PI*a,c=Math.sin(b);b/=2;var d=Math.cos(b),e=new cc.Vertex3F,f=cc.p(0,0);f.x=f.y=1;var g=this.originalVertex(f);f.x=f.y=0;var h,i,j,k,l,m=this.originalVertex(f),n=g.x,o=m.x;n>o?(i=cc.p(0,0),j=cc.p(0,1),k=cc.p(1,0),l=cc.p(1,1),h=n):(k=cc.p(0,0),l=cc.p(0,1),i=cc.p(1,0),j=cc.p(1,1),h=o),e.x=h-h*d,e.z=Math.abs(parseFloat(h*c/4));var p=this.originalVertex(i);p.x=e.x,p.z+=e.z,this.setVertex(i,p),p=this.originalVertex(j),p.x=e.x,p.z+=e.z,this.setVertex(j,p),p=this.originalVertex(k),p.x-=e.x,p.z-=e.z,this.setVertex(k,p),p=this.originalVertex(l),p.x-=e.x,p.z-=e.z,this.setVertex(l,p)}}),cc.flipX3D=function(a){return new cc.FlipX3D(a)},cc.FlipX3D.create=cc.flipX3D,cc.FlipY3D=cc.FlipX3D.extend({ctor:function(a){void 0!==a?cc.GridAction.prototype.ctor.call(this,a,cc.size(1,1)):cc.GridAction.prototype.ctor.call(this)},update:function(a){var b=Math.PI*a,c=Math.sin(b);b/=2;var d=Math.cos(b),e=new cc.Vertex3F,f=cc.p(0,0);f.x=f.y=1;var g=this.originalVertex(f);f.x=f.y=0;var h,i,j,k,l,m=this.originalVertex(f),n=g.y,o=m.y;n>o?(i=cc.p(0,0),j=cc.p(0,1),k=cc.p(1,0),l=cc.p(1,1),h=n):(j=cc.p(0,0),i=cc.p(0,1),l=cc.p(1,0),k=cc.p(1,1),h=o),e.y=h-h*d,e.z=Math.abs(parseFloat(h*c)/4);var p=this.originalVertex(i);p.y=e.y,p.z+=e.z,this.setVertex(i,p),p=this.originalVertex(j),p.y-=e.y,p.z-=e.z,this.setVertex(j,p),p=this.originalVertex(k),p.y=e.y,p.z+=e.z,this.setVertex(k,p),p=this.originalVertex(l),p.y-=e.y,p.z-=e.z,this.setVertex(l,p)}}),cc.flipY3D=function(a){return new cc.FlipY3D(a)},cc.FlipY3D.create=cc.flipY3D,cc.Lens3D=cc.Grid3DAction.extend({_position:null,_radius:0,_lensEffect:0,_concave:!1,_dirty:!1,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this),this._position=cc.p(0,0),void 0!==d&&this.initWithDuration(a,b,c,d)},getLensEffect:function(){return this._lensEffect},setLensEffect:function(a){this._lensEffect=a},setConcave:function(a){this._concave=a},getPosition:function(){return this._position},setPosition:function(a){cc.pointEqualToPoint(a,this._position)||(this._position.x=a.x,this._position.y=a.y,this._dirty=!0)},initWithDuration:function(a,b,c,d){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this.setPosition(c),this._radius=d,this._lensEffect=.7,this._dirty=!0,!0):!1},update:function(a){if(this._dirty){for(var b,c,d,e,f,g=this._gridSize.width,h=this._gridSize.height,i=this._radius,j=this._lensEffect,k=cc.p(0,0),l=cc.p(0,0),m=0;g+1>m;++m)for(var n=0;h+1>n;++n)k.x=m,k.y=n,b=this.originalVertex(k),l.x=this._position.x-b.x,l.y=this._position.y-b.y,c=cc.pLength(l),i>c&&(c=i-c,f=c/i,0===f&&(f=.001),d=Math.log(f)*j,e=Math.exp(d)*i,c=cc.pLength(l),c>0&&(l.x=l.x/c,l.y=l.y/c,l.x=l.x*e,l.y=l.y*e,b.z+=cc.pLength(l)*j)),this.setVertex(k,b);this._dirty=!1}}}),cc.lens3D=function(a,b,c,d){return new cc.Lens3D(a,b,c,d)},cc.Lens3D.create=cc.lens3D,cc.Ripple3D=cc.Grid3DAction.extend({_position:null,_radius:0,_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d,e,f){cc.GridAction.prototype.ctor.call(this),this._position=cc.p(0,0),void 0!==f&&this.initWithDuration(a,b,c,d,e,f)},getPosition:function(){return this._position},setPosition:function(a){this._position.x=a.x,this._position.y=a.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d,e,f){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this.setPosition(c),this._radius=d,this._waves=e,this._amplitude=f,this._amplitudeRate=1,!0):!1},update:function(a){for(var b,c,d=this._gridSize.width,e=this._gridSize.height,f=cc.p(0,0),g=this._radius,h=this._waves,i=this._amplitude,j=this._amplitudeRate,k=cc.p(0,0),l=0;d+1>l;++l)for(var m=0;e+1>m;++m){if(f.x=l,f.y=m,b=this.originalVertex(f),k.x=this._position.x-b.x,k.y=this._position.y-b.y,c=cc.pLength(k),g>c){c=g-c;var n=Math.pow(c/g,2);b.z+=Math.sin(a*Math.PI*h*2+.1*c)*i*j*n}this.setVertex(f,b)}}}),cc.ripple3D=function(a,b,c,d,e,f){return new cc.Ripple3D(a,b,c,d,e,f)},cc.Ripple3D.create=cc.ripple3D,cc.Shaky3D=cc.Grid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this),void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this._randRange=c,this._shakeZ=d,!0):!1},update:function(a){for(var b,c=this._gridSize.width,d=this._gridSize.height,e=this._randRange,f=this._shakeZ,g=cc.p(0,0),h=0;c+1>h;++h)for(var i=0;d+1>i;++i)g.x=h,g.y=i,b=this.originalVertex(g),b.x+=cc.rand()%(2*e)-e,b.y+=cc.rand()%(2*e)-e,f&&(b.z+=cc.rand()%(2*e)-e),this.setVertex(g,b)}}),cc.shaky3D=function(a,b,c,d){return new cc.Shaky3D(a,b,c,d)},cc.Shaky3D.create=cc.shaky3D,cc.Liquid=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this),void 0!==d&&this.initWithDuration(a,b,c,d)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this._waves=c,this._amplitude=d,this._amplitudeRate=1,!0):!1},update:function(a){for(var b,c=this._gridSize.width,d=this._gridSize.height,e=cc.p(0,0),f=this._waves,g=this._amplitude,h=this._amplitudeRate,i=1;c>i;++i)for(var j=1;d>j;++j)e.x=i,e.y=j,b=this.originalVertex(e),b.x=b.x+Math.sin(a*Math.PI*f*2+.01*b.x)*g*h,b.y=b.y+Math.sin(a*Math.PI*f*2+.01*b.y)*g*h,this.setVertex(e,b)}}),cc.liquid=function(a,b,c,d){return new cc.Liquid(a,b,c,d)},cc.Liquid.create=cc.liquid,cc.Waves=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,_vertical:!1,_horizontal:!1,ctor:function(a,b,c,d,e,f){cc.GridAction.prototype.ctor.call(this),void 0!==f&&this.initWithDuration(a,b,c,d,e,f)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d,e,f){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this._waves=c,this._amplitude=d,this._amplitudeRate=1,this._horizontal=e,this._vertical=f,!0):!1},update:function(a){for(var b,c=this._gridSize.width,d=this._gridSize.height,e=cc.p(0,0),f=this._vertical,g=this._horizontal,h=this._waves,i=this._amplitude,j=this._amplitudeRate,k=0;c+1>k;++k)for(var l=0;d+1>l;++l)e.x=k,e.y=l,b=this.originalVertex(e),f&&(b.x=b.x+Math.sin(a*Math.PI*h*2+.01*b.y)*i*j),g&&(b.y=b.y+Math.sin(a*Math.PI*h*2+.01*b.x)*i*j),this.setVertex(e,b)}}),cc.waves=function(a,b,c,d,e,f){return new cc.Waves(a,b,c,d,e,f)},cc.Waves.create=cc.waves,cc.Twirl=cc.Grid3DAction.extend({_position:null,_twirls:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d,e){cc.GridAction.prototype.ctor.call(this),this._position=cc.p(0,0),void 0!==e&&this.initWithDuration(a,b,c,d,e)},getPosition:function(){return this._position},setPosition:function(a){this._position.x=a.x,this._position.y=a.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d,e){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this.setPosition(c),this._twirls=d,this._amplitude=e,this._amplitudeRate=1,!0):!1},update:function(a){for(var b,c,d,e,f=this._position,g=this._gridSize.width,h=this._gridSize.height,i=cc.p(0,0),j=.1*this._amplitude*this._amplitudeRate,k=this._twirls,l=cc.p(0,0),m=0;g+1>m;++m)for(var n=0;h+1>n;++n)i.x=m,i.y=n,b=this.originalVertex(i),l.x=m-g/2,l.y=n-h/2,c=cc.pLength(l)*Math.cos(Math.PI/2+a*Math.PI*k*2)*j,d=Math.sin(c)*(b.y-f.y)+Math.cos(c)*(b.x-f.x),e=Math.cos(c)*(b.y-f.y)-Math.sin(c)*(b.x-f.x),b.x=f.x+d,b.y=f.y+e,this.setVertex(i,b)}}),cc.twirl=function(a,b,c,d,e){return new cc.Twirl(a,b,c,d,e)},cc.Twirl.create=cc.twirl,cc.ShakyTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this),void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._randRange=c,this._shakeZ=d,!0):!1},update:function(a){for(var b=this._gridSize,c=this._randRange,d=cc.p(0,0),e=0;e<b.width;++e)for(var f=0;f<b.height;++f){d.x=e,d.y=f;var g=this.originalTile(d);g.bl.x+=cc.rand()%(2*c)-c,g.br.x+=cc.rand()%(2*c)-c,g.tl.x+=cc.rand()%(2*c)-c,g.tr.x+=cc.rand()%(2*c)-c,g.bl.y+=cc.rand()%(2*c)-c,g.br.y+=cc.rand()%(2*c)-c,g.tl.y+=cc.rand()%(2*c)-c,g.tr.y+=cc.rand()%(2*c)-c,this._shakeZ&&(g.bl.z+=cc.rand()%(2*c)-c,g.br.z+=cc.rand()%(2*c)-c,g.tl.z+=cc.rand()%(2*c)-c,g.tr.z+=cc.rand()%(2*c)-c),this.setTile(d,g)}}}),cc.shakyTiles3D=function(a,b,c,d){return new cc.ShakyTiles3D(a,b,c,d)},cc.ShakyTiles3D.create=cc.shakyTiles3D,cc.ShatteredTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_once:!1,_shatterZ:!1,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this),void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._once=!1,this._randRange=c,this._shatterZ=d,!0):!1},update:function(a){if(this._once===!1){for(var b,c=this._gridSize,d=this._randRange,e=cc.p(0,0),f=0;f<c.width;++f)for(var g=0;g<c.height;++g)e.x=f,e.y=g,b=this.originalTile(e),b.bl.x+=cc.rand()%(2*d)-d,b.br.x+=cc.rand()%(2*d)-d,b.tl.x+=cc.rand()%(2*d)-d,b.tr.x+=cc.rand()%(2*d)-d,b.bl.y+=cc.rand()%(2*d)-d,b.br.y+=cc.rand()%(2*d)-d,b.tl.y+=cc.rand()%(2*d)-d,b.tr.y+=cc.rand()%(2*d)-d,this._shatterZ&&(b.bl.z+=cc.rand()%(2*d)-d,b.br.z+=cc.rand()%(2*d)-d,b.tl.z+=cc.rand()%(2*d)-d,b.tr.z+=cc.rand()%(2*d)-d),this.setTile(e,b);this._once=!0}}}),cc.shatteredTiles3D=function(a,b,c,d){return new cc.ShatteredTiles3D(a,b,c,d)},cc.ShatteredTiles3D.create=cc.shatteredTiles3D,cc.Tile=function(a,b,c){this.position=a||cc.p(0,0),this.startPosition=b||cc.p(0,0),this.delta=c||cc.p(0,0)},cc.ShuffleTiles=cc.TiledGrid3DAction.extend({_seed:0,_tilesCount:0,_tilesOrder:null,_tiles:null,ctor:function(a,b,c){cc.GridAction.prototype.ctor.call(this),this._tilesOrder=[],this._tiles=[],void 0!==c&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._seed=c,this._tilesOrder.length=0,this._tiles.length=0,!0):!1},shuffle:function(a,b){for(var c=b-1;c>=0;c--){var d=0|cc.rand()%(c+1),e=a[c];a[c]=a[d],a[d]=e}},getDelta:function(a){var b=this._gridSize,c=a.width*b.height+a.height;return cc.size(this._tilesOrder[c]/b.height-a.width,this._tilesOrder[c]%b.height-a.height)},placeTile:function(a,b){var c=this.originalTile(a),d=this.target.grid.getStep(),e=b.position;c.bl.x+=e.x*d.x,c.bl.y+=e.y*d.y,c.br.x+=e.x*d.x,c.br.y+=e.y*d.y,c.tl.x+=e.x*d.x,c.tl.y+=e.y*d.y,c.tr.x+=e.x*d.x,c.tr.y+=e.y*d.y,this.setTile(a,c)},startWithTarget:function(a){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,a);var b=this._gridSize;this._tilesCount=b.width*b.height;var c=this._tilesOrder;c.length=0;for(var d=0;d<this._tilesCount;++d)c[d]=d;this.shuffle(c,this._tilesCount);var e=this._tiles;e.length=0;for(var f=0,g=cc.size(0,0),h=0;h<b.width;++h)for(var i=0;i<b.height;++i)e[f]=new cc.Tile,e[f].position=cc.p(h,i),e[f].startPosition=cc.p(h,i),g.width=h,g.height=i,e[f].delta=this.getDelta(g),++f},update:function(a){for(var b,c=0,d=this._gridSize,e=this._tiles,f=cc.p(0,0),g=0;g<d.width;++g)for(var h=0;h<d.height;++h)f.x=g,f.y=h,b=e[c],b.position.x=b.delta.width*a,b.position.y=b.delta.height*a,this.placeTile(f,b),++c}}),cc.shuffleTiles=function(a,b,c){return new cc.ShuffleTiles(a,b,c)},cc.ShuffleTiles.create=cc.shuffleTiles,cc.FadeOutTRTiles=cc.TiledGrid3DAction.extend({testFunc:function(a,b){var c=this._gridSize.width*b,d=this._gridSize.height*b;return c===this._gridSize.width&&d===this._gridSize.height?0:c+d===0?1:Math.pow((a.x+a.y)/(c+d),6)},turnOnTile:function(a){this.setTile(a,this.originalTile(a))},turnOffTile:function(a){this.setTile(a,new cc.Quad3)},transformTile:function(a,b){var c=this.originalTile(a),d=this.target.grid.getStep();c.bl.x+=d.x/2*(1-b),c.bl.y+=d.y/2*(1-b),c.br.x-=d.x/2*(1-b),c.br.y+=d.y/2*(1-b),c.tl.x+=d.x/2*(1-b),c.tl.y-=d.y/2*(1-b),c.tr.x-=d.x/2*(1-b),c.tr.y-=d.y/2*(1-b),this.setTile(a,c)},update:function(a){for(var b,c=this._gridSize,d=cc.p(0,0),e=0;e<c.width;++e)for(var f=0;f<c.height;++f)d.x=e,d.y=f,b=this.testFunc(d,a),0===b?this.turnOffTile(d):1>b?this.transformTile(d,b):this.turnOnTile(d)}}),cc.fadeOutTRTiles=function(a,b){return new cc.FadeOutTRTiles(a,b)},cc.FadeOutTRTiles.create=cc.fadeOutTRTiles,cc.FadeOutBLTiles=cc.FadeOutTRTiles.extend({testFunc:function(a,b){var c=this._gridSize.width*(1-b),d=this._gridSize.height*(1-b);return c+d===0?0:a.x+a.y===0?1:Math.pow((c+d)/(a.x+a.y),6)}}),cc.fadeOutBLTiles=function(a,b){return new cc.FadeOutBLTiles(a,b)},cc.FadeOutBLTiles.create=cc.fadeOutBLTiles,cc.FadeOutUpTiles=cc.FadeOutTRTiles.extend({testFunc:function(a,b){var c=this._gridSize.height*b;return c===this._gridSize.height?0:0===c?1:Math.pow(a.y/c,6)},transformTile:function(a,b){var c=this.originalTile(a),d=this.target.grid.getStep();c.bl.y+=d.y/2*(1-b),c.br.y+=d.y/2*(1-b),c.tl.y-=d.y/2*(1-b),c.tr.y-=d.y/2*(1-b),this.setTile(a,c)}}),cc.fadeOutUpTiles=function(a,b){return new cc.FadeOutUpTiles(a,b)},cc.FadeOutUpTiles.create=cc.fadeOutUpTiles,cc.FadeOutDownTiles=cc.FadeOutUpTiles.extend({testFunc:function(a,b){var c=this._gridSize.height*(1-b);return 0===c?0:0===a.y?1:Math.pow(c/a.y,6)}}),cc.fadeOutDownTiles=function(a,b){return new cc.FadeOutDownTiles(a,b)},cc.FadeOutDownTiles.create=cc.fadeOutDownTiles,cc.TurnOffTiles=cc.TiledGrid3DAction.extend({_seed:null,_tilesCount:0,_tilesOrder:null,ctor:function(a,b,c){cc.GridAction.prototype.ctor.call(this),this._tilesOrder=[],void 0!==b&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._seed=c||0,this._tilesOrder.length=0,!0):!1},shuffle:function(a,b){for(var c=b-1;c>=0;c--){var d=0|cc.rand()%(c+1),e=a[c];a[c]=a[d],a[d]=e}},turnOnTile:function(a){this.setTile(a,this.originalTile(a))},turnOffTile:function(a){this.setTile(a,new cc.Quad3)},startWithTarget:function(a){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,a),this._tilesCount=this._gridSize.width*this._gridSize.height;var b=this._tilesOrder;b.length=0;for(var c=0;c<this._tilesCount;++c)b[c]=c;this.shuffle(b,this._tilesCount)},update:function(a){for(var b,c=0|a*this._tilesCount,d=this._gridSize,e=cc.p(0,0),f=this._tilesOrder,g=0;g<this._tilesCount;g++)b=f[g],e.x=0|b/d.height,e.y=b%(0|d.height),c>g?this.turnOffTile(e):this.turnOnTile(e)}}),cc.turnOffTiles=function(a,b,c){return new cc.TurnOffTiles(a,b,c)},cc.TurnOffTiles.create=cc.turnOffTiles,cc.WavesTiles3D=cc.TiledGrid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this),void 0!==d&&this.initWithDuration(a,b,c,d)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._waves=c,this._amplitude=d,this._amplitudeRate=1,!0):!1},update:function(a){for(var b,c=this._gridSize,d=this._waves,e=this._amplitude,f=this._amplitudeRate,g=cc.p(0,0),h=0;h<c.width;h++)for(var i=0;i<c.height;i++)g.x=h,g.y=i,b=this.originalTile(g),b.bl.z=Math.sin(a*Math.PI*d*2+.01*(b.bl.y+b.bl.x))*e*f,b.br.z=b.bl.z,b.tl.z=b.bl.z,b.tr.z=b.bl.z,this.setTile(g,b)}}),cc.wavesTiles3D=function(a,b,c,d){return new cc.WavesTiles3D(a,b,c,d)},cc.WavesTiles3D.create=cc.wavesTiles3D,cc.JumpTiles3D=cc.TiledGrid3DAction.extend({_jumps:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this),void 0!==d&&this.initWithDuration(a,b,c,d)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._jumps=c,this._amplitude=d,this._amplitudeRate=1,!0):!1},update:function(a){for(var b,c=Math.sin(Math.PI*a*this._jumps*2)*this._amplitude*this._amplitudeRate,d=Math.sin(Math.PI*(a*this._jumps*2+1))*this._amplitude*this._amplitudeRate,e=this._gridSize,f=this.target.grid,g=cc.p(0,0),h=0;h<e.width;h++)for(var i=0;i<e.height;i++)g.x=h,g.y=i,b=f.originalTile(g),(h+i)%2===0?(b.bl.z+=c,b.br.z+=c,b.tl.z+=c,b.tr.z+=c):(b.bl.z+=d,b.br.z+=d,b.tl.z+=d,b.tr.z+=d),f.setTile(g,b)}}),cc.jumpTiles3D=function(a,b,c,d){return new cc.JumpTiles3D(a,b,c,d)},cc.JumpTiles3D.create=cc.jumpTiles3D,cc.SplitRows=cc.TiledGrid3DAction.extend({_rows:0,_winSize:null,ctor:function(a,b){cc.GridAction.prototype.ctor.call(this),void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return this._rows=b,cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,cc.size(1,b))},update:function(a){for(var b,c,d=this._gridSize,e=this._winSize.width,f=cc.p(0,0),g=0;g<d.height;++g)f.y=g,b=this.originalTile(f),c=1,g%2===0&&(c=-1),b.bl.x+=c*e*a,b.br.x+=c*e*a,b.tl.x+=c*e*a,b.tr.x+=c*e*a,this.setTile(f,b)},startWithTarget:function(a){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,a),this._winSize=cc.director.getWinSizeInPixels()}}),cc.splitRows=function(a,b){return new cc.SplitRows(a,b)},cc.SplitRows.create=cc.splitRows,cc.SplitCols=cc.TiledGrid3DAction.extend({_cols:0,_winSize:null,ctor:function(a,b){cc.GridAction.prototype.ctor.call(this),void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return this._cols=b,cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,cc.size(b,1))},update:function(a){for(var b,c,d=this._gridSize.width,e=this._winSize.height,f=cc.p(0,0),g=0;d>g;++g)f.x=g,b=this.originalTile(f),c=1,g%2===0&&(c=-1),b.bl.y+=c*e*a,b.br.y+=c*e*a,b.tl.y+=c*e*a,b.tr.y+=c*e*a,this.setTile(f,b);cc.renderer.childrenOrderDirty=!0},startWithTarget:function(a){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,a),this._winSize=cc.director.getWinSizeInPixels()}}),cc.splitCols=function(a,b){return new cc.SplitCols(a,b)},cc.SplitCols.create=cc.splitCols,cc.PageTurn3D=cc.Grid3DAction.extend({getGrid:function(){var a=new cc.Grid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect());return a.setNeedDepthTestForBlit(!0),a},clone:function(){var a=new cc.PageTurn3D;return a.initWithDuration(this._duration,this._gridSize),a},update:function(a){for(var b=Math.max(0,a-.25),c=b*b*500,d=-100-c,e=Math.sqrt(a),f=e>.5?Math.PI/2*e:Math.PI/2*(1-e),g=(2-a)*Math.PI,h=Math.sin(f),i=Math.cos(f),j=this._gridSize,k=cc.p(0,0),l=0;l<=j.width;++l)for(var m=0;m<=j.height;++m){k.x=l,k.y=m;var n=this.getOriginalVertex(k);n.x-=this.getGridRect().x;var o=Math.sqrt(n.x*n.x+(n.y-d)*(n.y-d)),p=o*h,q=Math.asin(n.x/o),r=q/h,s=Math.cos(r);r<=Math.PI?n.x=p*Math.sin(r):n.x=0,n.y=o+d-p*(1-s)*h,n.z=p*(1-s)*i,n.x=n.z*Math.sin(g)+n.x*Math.cos(g),n.z=n.z*Math.cos(g)-n.x*Math.cos(g),n.z/=7,n.z<.5&&(n.z=.5),n.x+=this.getGridRect().x,this.setVertex(k,n)}}}),cc.pageTurn3D=function(a,b){return new cc.PageTurn3D(a,b)},cc.PageTurn3D.create=cc.pageTurn3D;