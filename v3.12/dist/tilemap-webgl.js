!function(){cc.TMXLayer.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._vertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this._color=new Uint32Array(1),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST);var b=90*Math.PI/180;this._sin90=Math.sin(b),this._cos90=Math.cos(b),b=3*b,this._sin270=Math.sin(b),this._cos270=Math.cos(b)};var a=cc.TMXLayer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.TMXLayer.WebGLRenderCmd,a.uploadData=function(a,b,c){var d=this._node,e=d._rotationX||d._rotationY,f=d.layerOrientation,g=d.tiles;if(!g)return 0;var h=(cc.view._scaleX,cc.view._scaleY,d._mapTileSize.width),i=d._mapTileSize.height,j=d.tileset._tileSize.width/cc.director._contentScaleFactor,k=d.tileset._tileSize.height/cc.director._contentScaleFactor,l=j-h,m=k-i,n=cc.winSize.width,o=cc.winSize.height,p=d._layerSize.height,q=d._layerSize.width,r=d._texGrids,s=d._spriteTiles,t=this._worldTransform,u=t.a,v=t.b,w=t.c,x=t.d,y=t.tx,z=t.ty,A=-d._contentSize.width*d._anchorPoint.x,B=-d._contentSize.height*d._anchorPoint.y,C=A*u+B*w+y,D=A*v+B*x+z,E=this._displayedOpacity,F=this._displayedColor.r,G=this._displayedColor.g,H=this._displayedColor.b;if(d._opacityModifyRGB){var I=E/255;F*=I,G*=I,H*=I}this._color[0]=E<<24|H<<16|G<<8|F;var J=0,K=0,L=q,M=p;e||f!==cc.TMX_ORIENTATION_ORTHO||(J=Math.floor(-(C-l*u)/(h*u)),K=Math.floor((D-m*x+i*p*x-o)/(i*x)),L=Math.ceil((n-C+l*u)/(h*u)),M=p-Math.floor(-(D+m*x)/(i*x)),0>J&&(J=0),0>K&&(K=0),L>q&&(L=q),M>p&&(M=p));var N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_=c,aa=K*q,ba=cc.TMX_TILE_FLIPPED_MASK,ca=j*u,da=k*x,ea=u,fa=v,ga=w,ha=x,ia=y,ja=z,ka=!1,la=!1,ma=!1,na=this._vertices;for(N=K;M>N;++N){for(O=J;L>O;++O)if(_+24>a.length&&(cc.renderer._increaseBatchingSize((_-c)/6),cc.renderer._batchRendering(),c=0,_=0),P=aa+O,!s[P]&&(Q=d.tiles[P],R=r[(Q&ba)>>>0])){switch(f){case cc.TMX_ORIENTATION_ORTHO:U=O*h,V=(p-N-1)*i,P=d._vertexZ+cc.renderer.assignedZStep*P/g.length;break;case cc.TMX_ORIENTATION_ISO:U=h/2*(q+O-N-1),V=i/2*(2*p-O-N-2),P=d._vertexZ+cc.renderer.assignedZStep*(d.height-V)/d.height;break;case cc.TMX_ORIENTATION_HEX:U=O*h*3/4,V=(p-N-1)*i+(O%2===1?-i/2:0),P=d._vertexZ+cc.renderer.assignedZStep*(d.height-V)/d.height}if(W=U+j,T=V+k,!e&&f===cc.TMX_ORIENTATION_ISO){if(Z=D+V*x,Z>o+da){O+=Math.floor(2*(Z-o)/da)-1;continue}if($=C+W*u,-ca>$){O+=Math.floor(2*-$/ca)-1;continue}if(Y=C+U*u,X=D+T*x,Y>n||0>X){O=L;continue}}for(Q>cc.TMX_TILE_DIAGONAL_FLAG&&(ka=!0,la=(Q&cc.TMX_TILE_HORIZONTAL_FLAG)>>>0,ma=(Q&cc.TMX_TILE_VERTICAL_FLAG)>>>0),na[0].x=U*ea+T*ga+ia,na[0].y=U*fa+T*ha+ja,na[1].x=U*ea+V*ga+ia,na[1].y=U*fa+V*ha+ja,na[2].x=W*ea+T*ga+ia,na[2].y=W*fa+T*ha+ja,na[3].x=W*ea+V*ga+ia,na[3].y=W*fa+V*ha+ja,S=0;4>S;++S){switch(a[_]=na[S].x,a[_+1]=na[S].y,a[_+2]=P,b[_+3]=this._color[0],S){case 0:a[_+4]=la?R.r:R.l,a[_+5]=ma?R.b:R.t;break;case 1:a[_+4]=la?R.r:R.l,a[_+5]=ma?R.t:R.b;break;case 2:a[_+4]=la?R.l:R.r,a[_+5]=ma?R.b:R.t;break;case 3:a[_+4]=la?R.l:R.r,a[_+5]=ma?R.t:R.b}_+=6}ka&&(ea=u,fa=v,ga=w,ha=x,ia=y,ja=z,la=!1,ma=!1,ka=!1)}aa+=q}return(_-c)/6}}();