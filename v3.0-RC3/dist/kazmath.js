cc.kmScalar=Number,cc.kmBool=Number,cc.kmEnum=Number,cc.KM_FALSE=0,cc.KM_TRUE=1,cc.kmPI=3.141592,cc.kmPIOver180=.017453,cc.kmPIUnder180=57.295779,cc.kmEpsilon=1/64,cc.kmSQR=function(a){return a*a},cc.kmDegreesToRadians=function(a){return a*cc.kmPIOver180},cc.kmRadiansToDegrees=function(a){return a*cc.kmPIUnder180},cc.kmMin=function(a,b){return b>a?a:b},cc.kmMax=function(a,b){return a>b?a:b},cc.kmAlmostEqual=function(a,b){return a+cc.kmEpsilon>b&&a-cc.kmEpsilon<b},cc.kmVec2=function(a,b){this.x=a||0,this.y=b||0},cc.kmVec2Fill=function(a,b,c){return a.x=b,a.y=c,a},cc.kmVec2Length=function(a){return Math.sqrt(cc.kmSQR(a.x)+cc.kmSQR(a.y))},cc.kmVec2LengthSq=function(a){return cc.kmSQR(a.x)+cc.kmSQR(a.y)},cc.kmVec2Normalize=function(a,b){var c=1/cc.kmVec2Length(b),d=new cc.kmVec2;return d.x=b.x*c,d.y=b.y*c,a.x=d.x,a.y=d.y,a},cc.kmVec2Add=function(a,b,c){return a.x=b.x+c.x,a.y=b.y+c.y,a},cc.kmVec2Dot=function(a,b){return a.x*b.x+a.y*b.y},cc.kmVec2Subtract=function(a,b,c){return a.x=b.x-c.x,a.y=b.y-c.y,a},cc.kmVec2Transform=function(a,b,c){var d=new cc.kmVec2;return d.x=b.x*c.mat[0]+b.y*c.mat[3]+c.mat[6],d.y=b.x*c.mat[1]+b.y*c.mat[4]+c.mat[7],a.x=d.x,a.y=d.y,a},cc.kmVec2TransformCoord=function(){return null},cc.kmVec2Scale=function(a,b,c){return a.x=b.x*c,a.y=b.y*c,a},cc.kmVec2AreEqual=function(a,b){return a.x<b.x+cc.kmEpsilon&&a.x>b.x-cc.kmEpsilon&&a.y<b.y+cc.kmEpsilon&&a.y>b.y-cc.kmEpsilon},cc.kmVec3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},cc.kmVec3Fill=function(a,b,c,d){return a?(a.x=b,a.y=c,a.z=d,a):new cc.kmVec3(b,c,d)},cc.kmVec3Length=function(a){return Math.sqrt(cc.kmSQR(a.x)+cc.kmSQR(a.y)+cc.kmSQR(a.z))},cc.kmVec3LengthSq=function(a){return cc.kmSQR(a.x)+cc.kmSQR(a.y)+cc.kmSQR(a.z)},cc.kmVec3Normalize=function(a,b){var c=1/cc.kmVec3Length(b);return a.x=b.x*c,a.y=b.y*c,a.z=b.z*c,a},cc.kmVec3Cross=function(a,b,c){return a.x=b.y*c.z-b.z*c.y,a.y=b.z*c.x-b.x*c.z,a.z=b.x*c.y-b.y*c.x,a},cc.kmVec3Dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},cc.kmVec3Add=function(a,b,c){return a.x=b.x+c.x,a.y=b.y+c.y,a.z=b.z+c.z,a},cc.kmVec3Subtract=function(a,b,c){return a.x=b.x-c.x,a.y=b.y-c.y,a.z=b.z-c.z,a},cc.kmVec3Transform=function(a,b,c){return a.x=b.x*c.mat[0]+b.y*c.mat[4]+b.z*c.mat[8]+c.mat[12],a.y=b.x*c.mat[1]+b.y*c.mat[5]+b.z*c.mat[9]+c.mat[13],a.z=b.x*c.mat[2]+b.y*c.mat[6]+b.z*c.mat[10]+c.mat[14],a},cc.kmVec3TransformNormal=function(a,b,c){return a.x=b.x*c.mat[0]+b.y*c.mat[4]+b.z*c.mat[8],a.y=b.x*c.mat[1]+b.y*c.mat[5]+b.z*c.mat[9],a.z=b.x*c.mat[2]+b.y*c.mat[6]+b.z*c.mat[10],a},cc.kmVec3TransformCoord=function(a,b,c){var d=new cc.kmVec4,e=new cc.kmVec4;return cc.kmVec4Fill(e,b.x,b.y,b.z,1),cc.kmVec4Transform(d,e,c),a.x=d.x/d.w,a.y=d.y/d.w,a.z=d.z/d.w,a},cc.kmVec3Scale=function(a,b,c){return a.x=b.x*c,a.y=b.y*c,a.z=b.z*c,a},cc.kmVec3AreEqual=function(a,b){return a.x<b.x+cc.kmEpsilon&&a.x>b.x-cc.kmEpsilon&&a.y<b.y+cc.kmEpsilon&&a.y>b.y-cc.kmEpsilon&&a.z<b.z+cc.kmEpsilon&&a.z>b.z-cc.kmEpsilon?1:0},cc.kmVec3InverseTransform=function(a,b,c){var d=new cc.kmVec3(b.x-c.mat[12],b.y-c.mat[13],b.z-c.mat[14]);return a.x=d.x*c.mat[0]+d.y*c.mat[1]+d.z*c.mat[2],a.y=d.x*c.mat[4]+d.y*c.mat[5]+d.z*c.mat[6],a.z=d.x*c.mat[8]+d.y*c.mat[9]+d.z*c.mat[10],a},cc.kmVec3InverseTransformNormal=function(a,b,c){return a.x=b.x*c.mat[0]+b.y*c.mat[1]+b.z*c.mat[2],a.y=b.x*c.mat[4]+b.y*c.mat[5]+b.z*c.mat[6],a.z=b.x*c.mat[8]+b.y*c.mat[9]+b.z*c.mat[10],a},cc.kmVec3Assign=function(a,b){return a==b?a:(a.x=b.x,a.y=b.y,a.z=b.z,a)},cc.kmVec3Zero=function(a){return a.x=0,a.y=0,a.z=0,a},cc.kmVec3ToTypeArray=function(a){if(!a)return null;var b=new Float32Array(3);return b[0]=a.x,b[1]=a.y,b[2]=a.z,b},cc.kmVec4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d||0},cc.kmVec4Fill=function(a,b,c,d,e){return a.x=b,a.y=c,a.z=d,a.w=e,a},cc.kmVec4Add=function(a,b,c){return a.x=b.x+c.x,a.y=b.y+c.y,a.z=b.z+c.z,a.w=b.w+c.w,a},cc.kmVec4Dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w},cc.kmVec4Length=function(a){return Math.sqrt(cc.kmSQR(a.x)+cc.kmSQR(a.y)+cc.kmSQR(a.z)+cc.kmSQR(a.w))},cc.kmVec4LengthSq=function(a){return cc.kmSQR(a.x)+cc.kmSQR(a.y)+cc.kmSQR(a.z)+cc.kmSQR(a.w)},cc.kmVec4Lerp=function(a){return a},cc.kmVec4Normalize=function(a,b){var c=1/cc.kmVec4Length(b);return a.x*=c,a.y*=c,a.z*=c,a.w*=c,a},cc.kmVec4Scale=function(a,b,c){return cc.kmVec4Normalize(a,b),a.x*=c,a.y*=c,a.z*=c,a.w*=c,a},cc.kmVec4Subtract=function(a,b,c){return a.x=b.x-c.x,a.y=b.y-c.y,a.z=b.z-c.z,a.w=b.w-c.w,a},cc.kmVec4Transform=function(a,b,c){return a.x=b.x*c.mat[0]+b.y*c.mat[4]+b.z*c.mat[8]+b.w*c.mat[12],a.y=b.x*c.mat[1]+b.y*c.mat[5]+b.z*c.mat[9]+b.w*c.mat[13],a.z=b.x*c.mat[2]+b.y*c.mat[6]+b.z*c.mat[10]+b.w*c.mat[14],a.w=b.x*c.mat[3]+b.y*c.mat[7]+b.z*c.mat[11]+b.w*c.mat[15],a},cc.kmVec4TransformArray=function(a,b,c,d,e,f){for(var g=0;f>g;){var h=c+g*d,i=a+g*b;cc.kmVec4Transform(i,h,e),++g}return a},cc.kmVec4AreEqual=function(a,b){return a.x<b.x+cc.kmEpsilon&&a.x>b.x-cc.kmEpsilon&&a.y<b.y+cc.kmEpsilon&&a.y>b.y-cc.kmEpsilon&&a.z<b.z+cc.kmEpsilon&&a.z>b.z-cc.kmEpsilon&&a.w<b.w+cc.kmEpsilon&&a.w>b.w-cc.kmEpsilon},cc.kmVec4Assign=function(a,b){return a==b?(cc.log("destVec and srcVec are same object"),a):(a.x=b.x,a.y=b.y,a.z=b.z,a.w=b.w,a)},cc.kmVec4ToTypeArray=function(a){if(!a)return null;var b=new Float32Array(4);return b[0]=a.x,b[1]=a.y,b[2]=a.z,b[3]=a.w,b},cc.kmRay2=function(a){this.start=a||new cc.kmVec2,this.start=a||new cc.kmVec2},cc.kmRay2Fill=function(a,b,c,d,e){a.start.x=b,a.start.y=c,a.dir.x=d,a.dir.y=e},cc.kmRay2IntersectLineSegment=function(a,b,c,d){var e,f,g,h=a.start.x,i=a.start.y,j=a.start.x+a.dir.x,k=a.start.y+a.dir.y,l=b.x,m=b.y,n=c.x,o=c.y,p=(o-m)*(j-h)-(n-l)*(k-i);return p>-cc.kmEpsilon&&p<cc.kmEpsilon?cc.KM_FALSE:(e=((n-l)*(i-m)-(o-m)*(h-l))/p,f=h+e*(j-h),g=i+e*(k-i),f<cc.kmMin(b.x,c.x)-cc.kmEpsilon||f>cc.kmMax(b.x,c.x)+cc.kmEpsilon||g<cc.kmMin(b.y,c.y)-cc.kmEpsilon||g>cc.kmMax(b.y,c.y)+cc.kmEpsilon?cc.KM_FALSE:f<cc.kmMin(h,j)-cc.kmEpsilon||f>cc.kmMax(h,j)+cc.kmEpsilon||g<cc.kmMin(i,k)-cc.kmEpsilon||g>cc.kmMax(i,k)+cc.kmEpsilon?cc.KM_FALSE:(d.x=f,d.y=g,cc.KM_TRUE))},cc.calculate_line_normal=function(a,b,c){var d=new cc.kmVec2;cc.kmVec2Subtract(d,b,a),c.x=-d.y,c.y=d.x,cc.kmVec2Normalize(c,c)},cc.kmRay2IntersectTriangle=function(a,b,c,d,e,f){var g,h,i=new cc.kmVec2,j=new cc.kmVec2,k=new cc.kmVec2,l=1e4,m=cc.KM_FALSE;return cc.kmRay2IntersectLineSegment(a,b,c,i)&&(g=new cc.kmVec2,m=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(g,i,a.start)),l>h&&(j.x=i.x,j.y=i.y,l=h,cc.calculate_line_normal(b,c,k))),cc.kmRay2IntersectLineSegment(a,c,d,i)&&(g=new cc.kmVec2,m=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(g,i,a.start)),l>h&&(j.x=i.x,j.y=i.y,l=h,cc.calculate_line_normal(c,d,k))),cc.kmRay2IntersectLineSegment(a,d,b,i)&&(g=new cc.kmVec2,m=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(g,i,a.start)),l>h&&(j.x=i.x,j.y=i.y,l=h,cc.calculate_line_normal(d,b,k))),m&&(e.x=j.x,e.y=j.y,f&&(f.x=k.x,f.y=k.y)),m},cc.kmRay2IntersectCircle=function(){cc.log("cc.kmRay2IntersectCircle() has not been implemented.")};var Float32Array=Float32Array||Array;cc.kmMat3=function(){this.mat=new Float32Array([0,0,0,0,0,0,0,0,0])},cc.kmMat3Fill=function(a,b){for(var c=0;9>c;c++)a.mat[c]=b;return a},cc.kmMat3Adjugate=function(a,b){return a.mat[0]=b.mat[4]*b.mat[8]-b.mat[5]*b.mat[7],a.mat[1]=b.mat[2]*b.mat[7]-b.mat[1]*b.mat[8],a.mat[2]=b.mat[1]*b.mat[5]-b.mat[2]*b.mat[4],a.mat[3]=b.mat[5]*b.mat[6]-b.mat[3]*b.mat[8],a.mat[4]=b.mat[0]*b.mat[8]-b.mat[2]*b.mat[6],a.mat[5]=b.mat[2]*b.mat[3]-b.mat[0]*b.mat[5],a.mat[6]=b.mat[3]*b.mat[7]-b.mat[4]*b.mat[6],a.mat[8]=b.mat[0]*b.mat[4]-b.mat[1]*b.mat[3],a},cc.kmMat3Identity=function(a){return a.mat[1]=a.mat[2]=a.mat[3]=a.mat[5]=a.mat[6]=a.mat[7]=0,a.mat[0]=a.mat[4]=a.mat[8]=1,a},cc.kmMat3Inverse=function(a,b,c){var d,e=new cc.kmMat3;return 0===b?null:(d=1/b,cc.kmMat3Adjugate(e,c),cc.kmMat3ScalarMultiply(a,e,d),a)},cc.kmMat3._identity=new Float32Array([1,0,0,0,1,0,0,0,1]),cc.kmMat3IsIdentity=function(a){for(var b=0;9>b;b++)if(cc.kmMat3._identity[b]!==a.mat[b])return!1;return!0},cc.kmMat3Transpose=function(a,b){var c,d;for(c=0;3>c;++c)for(d=0;3>d;++d)a.mat[3*c+d]=b.mat[3*d+c];return a},cc.kmMat3Determinant=function(a){var b;return b=a.mat[0]*a.mat[4]*a.mat[8]+a.mat[1]*a.mat[5]*a.mat[6]+a.mat[2]*a.mat[3]*a.mat[7],b-=a.mat[2]*a.mat[4]*a.mat[6]+a.mat[0]*a.mat[5]*a.mat[7]+a.mat[1]*a.mat[3]*a.mat[8]},cc.kmMat3Multiply=function(a,b,c){var d=b.mat,e=c.mat;return a.mat[0]=d[0]*e[0]+d[3]*e[1]+d[6]*e[2],a.mat[1]=d[1]*e[0]+d[4]*e[1]+d[7]*e[2],a.mat[2]=d[2]*e[0]+d[5]*e[1]+d[8]*e[2],a.mat[3]=d[0]*e[3]+d[3]*e[4]+d[6]*e[5],a.mat[4]=d[1]*e[3]+d[4]*e[4]+d[7]*e[5],a.mat[5]=d[2]*e[3]+d[5]*e[4]+d[8]*e[5],a.mat[6]=d[0]*e[6]+d[3]*e[7]+d[6]*e[8],a.mat[7]=d[1]*e[6]+d[4]*e[7]+d[7]*e[8],a.mat[8]=d[2]*e[6]+d[5]*e[7]+d[8]*e[8],a},cc.kmMat3ScalarMultiply=function(a,b,c){for(var d=0;9>d;d++)a.mat[d]=b.mat[d]*c;return a},cc.kmMat3RotationAxisAngle=function(a,b,c){var d=Math.cos(c),e=Math.sin(c);return a.mat[0]=d+b.x*b.x*(1-d),a.mat[1]=b.z*e+b.y*b.x*(1-d),a.mat[2]=-b.y*e+b.z*b.x*(1-d),a.mat[3]=-b.z*e+b.x*b.y*(1-d),a.mat[4]=d+b.y*b.y*(1-d),a.mat[5]=b.x*e+b.z*b.y*(1-d),a.mat[6]=b.y*e+b.x*b.z*(1-d),a.mat[7]=-b.x*e+b.y*b.z*(1-d),a.mat[8]=d+b.z*b.z*(1-d),a},cc.kmMat3Assign=function(a,b){if(a==b)return cc.log("cc.kmMat3Assign(): pOut equals pIn"),a;for(var c=0;9>c;c++)a.mat[c]=b.mat[c];return a},cc.kmMat3AreEqual=function(a,b){if(a==b)return!0;for(var c=0;9>c;++c)if(!(a.mat[c]+cc.kmEpsilon>b.mat[c]&&a.mat[c]-cc.kmEpsilon<b.mat[c]))return!1;return!0},cc.kmMat3RotationX=function(a,b){return a.mat[0]=1,a.mat[1]=0,a.mat[2]=0,a.mat[3]=0,a.mat[4]=Math.cos(b),a.mat[5]=Math.sin(b),a.mat[6]=0,a.mat[7]=-Math.sin(b),a.mat[8]=Math.cos(b),a},cc.kmMat3RotationY=function(a,b){return a.mat[0]=Math.cos(b),a.mat[1]=0,a.mat[2]=-Math.sin(b),a.mat[3]=0,a.mat[4]=1,a.mat[5]=0,a.mat[6]=Math.sin(b),a.mat[7]=0,a.mat[8]=Math.cos(b),a},cc.kmMat3RotationZ=function(a,b){return a.mat[0]=Math.cos(b),a.mat[1]=-Math.sin(b),a.mat[2]=0,a.mat[3]=Math.sin(b),a.mat[4]=Math.cos(b),a.mat[5]=0,a.mat[6]=0,a.mat[7]=0,a.mat[8]=1,a},cc.kmMat3Rotation=function(a,b){return a.mat[0]=Math.cos(b),a.mat[1]=Math.sin(b),a.mat[2]=0,a.mat[3]=-Math.sin(b),a.mat[4]=Math.cos(b),a.mat[5]=0,a.mat[6]=0,a.mat[7]=0,a.mat[8]=1,a},cc.kmMat3Scaling=function(a,b,c){return cc.kmMat3Identity(a),a.mat[0]=b,a.mat[4]=c,a},cc.kmMat3Translation=function(a,b,c){return cc.kmMat3Identity(a),a.mat[6]=b,a.mat[7]=c,a},cc.kmMat3RotationQuaternion=function(a,b){return b&&a?(a.mat[0]=1-2*(b.y*b.y+b.z*b.z),a.mat[1]=2*(b.x*b.y-b.w*b.z),a.mat[2]=2*(b.x*b.z+b.w*b.y),a.mat[3]=2*(b.x*b.y+b.w*b.z),a.mat[4]=1-2*(b.x*b.x+b.z*b.z),a.mat[5]=2*(b.y*b.z-b.w*b.x),a.mat[6]=2*(b.x*b.z-b.w*b.y),a.mat[7]=2*(b.y*b.z+b.w*b.x),a.mat[8]=1-2*(b.x*b.x+b.y*b.y),a):null},cc.kmMat3RotationToAxisAngle=function(a,b,c){var d;return cc.kmQuaternionRotationMatrix(d,c),cc.kmQuaternionToAxisAngle(d,a,b),a},cc.kmMat4=function(){this.mat=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},cc.kmMat4Fill=function(a,b){a.mat[0]=a.mat[1]=a.mat[2]=a.mat[3]=a.mat[4]=a.mat[5]=a.mat[6]=a.mat[7]=a.mat[8]=a.mat[9]=a.mat[10]=a.mat[11]=a.mat[12]=a.mat[13]=a.mat[14]=a.mat[15]=b},cc.kmMat4Identity=function(a){return a.mat[1]=a.mat[2]=a.mat[3]=a.mat[4]=a.mat[6]=a.mat[7]=a.mat[8]=a.mat[9]=a.mat[11]=a.mat[12]=a.mat[13]=a.mat[14]=0,a.mat[0]=a.mat[5]=a.mat[10]=a.mat[15]=1,a},cc.kmMat4._get=function(a,b,c){return a.mat[b+4*c]},cc.kmMat4._set=function(a,b,c,d){a.mat[b+4*c]=d},cc.kmMat4._swap=function(a,b,c,d,e){var f=cc.kmMat4._get(a,b,c);cc.kmMat4._set(a,b,c,cc.kmMat4._get(a,d,e)),cc.kmMat4._set(a,d,e,f)},cc.kmMat4._gaussj=function(a,b){var c,d,e,f,g,h,i,j,k=0,l=0,m=4,n=4,o=[0,0,0,0],p=[0,0,0,0],q=[0,0,0,0];for(c=0;m>c;c++){for(h=0,d=0;m>d;d++)if(1!=q[d])for(e=0;m>e;e++)0==q[e]&&Math.abs(cc.kmMat4._get(a,d,e))>=h&&(h=Math.abs(cc.kmMat4._get(a,d,e)),l=d,k=e);if(++q[k],l!=k){for(f=0;m>f;f++)cc.kmMat4._swap(a,l,f,k,f);for(f=0;n>f;f++)cc.kmMat4._swap(b,l,f,k,f)}if(p[c]=l,o[c]=k,0==cc.kmMat4._get(a,k,k))return cc.KM_FALSE;for(j=1/cc.kmMat4._get(a,k,k),cc.kmMat4._set(a,k,k,1),f=0;m>f;f++)cc.kmMat4._set(a,k,f,cc.kmMat4._get(a,k,f)*j);for(f=0;n>f;f++)cc.kmMat4._set(b,k,f,cc.kmMat4._get(b,k,f)*j);for(g=0;m>g;g++)if(g!=k){for(i=cc.kmMat4._get(a,g,k),cc.kmMat4._set(a,g,k,0),f=0;m>f;f++)cc.kmMat4._set(a,g,f,cc.kmMat4._get(a,g,f)-cc.kmMat4._get(a,k,f)*i);for(f=0;n>f;f++)cc.kmMat4._set(b,g,f,cc.kmMat4._get(a,g,f)-cc.kmMat4._get(b,k,f)*i)}}for(f=m-1;f>=0;f--)if(p[f]!=o[f])for(e=0;m>e;e++)cc.kmMat4._swap(a,e,p[f],e,o[f]);return cc.KM_TRUE},cc.kmMat4._identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),cc.kmMat4Inverse=function(a,b){var c=new cc.kmMat4,d=new cc.kmMat4;return cc.kmMat4Assign(c,b),cc.kmMat4Identity(d),cc.kmMat4._gaussj(c,d)==cc.KM_FALSE?null:(cc.kmMat4Assign(a,c),a)},cc.kmMat4IsIdentity=function(a){for(var b=0;16>b;b++)if(cc.kmMat4._identity[b]!=a.mat[b])return!1;return!0},cc.kmMat4Transpose=function(a,b){var c,d,e=a.mat,f=b.mat;for(d=0;4>d;++d)for(c=0;4>c;++c)e[4*d+c]=f[4*c+d];return a},cc.kmMat4Multiply=function(a,b,c){var d=a.mat,e=b.mat[0],f=b.mat[1],g=b.mat[2],h=b.mat[3],i=b.mat[4],j=b.mat[5],k=b.mat[6],l=b.mat[7],m=b.mat[8],n=b.mat[9],o=b.mat[10],p=b.mat[11],q=b.mat[12],r=b.mat[13],s=b.mat[14],t=b.mat[15],u=c.mat[0],v=c.mat[1],w=c.mat[2],x=c.mat[3],y=c.mat[4],z=c.mat[5],A=c.mat[6],B=c.mat[7],C=c.mat[8],D=c.mat[9],E=c.mat[10],F=c.mat[11],G=c.mat[12],H=c.mat[13],I=c.mat[14],J=c.mat[15];return d[0]=u*e+v*i+w*m+x*q,d[1]=u*f+v*j+w*n+x*r,d[2]=u*g+v*k+w*o+x*s,d[3]=u*h+v*l+w*p+x*t,d[4]=y*e+z*i+A*m+B*q,d[5]=y*f+z*j+A*n+B*r,d[6]=y*g+z*k+A*o+B*s,d[7]=y*h+z*l+A*p+B*t,d[8]=C*e+D*i+E*m+F*q,d[9]=C*f+D*j+E*n+F*r,d[10]=C*g+D*k+E*o+F*s,d[11]=C*h+D*l+E*p+F*t,d[12]=G*e+H*i+I*m+J*q,d[13]=G*f+H*j+I*n+J*r,d[14]=G*g+H*k+I*o+J*s,d[15]=G*h+H*l+I*p+J*t,a},cc.getMat4MultiplyValue=function(a,b){var c=a.mat,d=b.mat,e=new Float32Array(16);return e[0]=c[0]*d[0]+c[4]*d[1]+c[8]*d[2]+c[12]*d[3],e[1]=c[1]*d[0]+c[5]*d[1]+c[9]*d[2]+c[13]*d[3],e[2]=c[2]*d[0]+c[6]*d[1]+c[10]*d[2]+c[14]*d[3],e[3]=c[3]*d[0]+c[7]*d[1]+c[11]*d[2]+c[15]*d[3],e[4]=c[0]*d[4]+c[4]*d[5]+c[8]*d[6]+c[12]*d[7],e[5]=c[1]*d[4]+c[5]*d[5]+c[9]*d[6]+c[13]*d[7],e[6]=c[2]*d[4]+c[6]*d[5]+c[10]*d[6]+c[14]*d[7],e[7]=c[3]*d[4]+c[7]*d[5]+c[11]*d[6]+c[15]*d[7],e[8]=c[0]*d[8]+c[4]*d[9]+c[8]*d[10]+c[12]*d[11],e[9]=c[1]*d[8]+c[5]*d[9]+c[9]*d[10]+c[13]*d[11],e[10]=c[2]*d[8]+c[6]*d[9]+c[10]*d[10]+c[14]*d[11],e[11]=c[3]*d[8]+c[7]*d[9]+c[11]*d[10]+c[15]*d[11],e[12]=c[0]*d[12]+c[4]*d[13]+c[8]*d[14]+c[12]*d[15],e[13]=c[1]*d[12]+c[5]*d[13]+c[9]*d[14]+c[13]*d[15],e[14]=c[2]*d[12]+c[6]*d[13]+c[10]*d[14]+c[14]*d[15],e[15]=c[3]*d[12]+c[7]*d[13]+c[11]*d[14]+c[15]*d[15],e},cc.getMat4MultiplyWithMat4=function(a,b,c){var d=a.mat,e=b.mat,f=c.mat;return f[0]=d[0]*e[0]+d[4]*e[1]+d[8]*e[2]+d[12]*e[3],f[1]=d[1]*e[0]+d[5]*e[1]+d[9]*e[2]+d[13]*e[3],f[2]=d[2]*e[0]+d[6]*e[1]+d[10]*e[2]+d[14]*e[3],f[3]=d[3]*e[0]+d[7]*e[1]+d[11]*e[2]+d[15]*e[3],f[4]=d[0]*e[4]+d[4]*e[5]+d[8]*e[6]+d[12]*e[7],f[5]=d[1]*e[4]+d[5]*e[5]+d[9]*e[6]+d[13]*e[7],f[6]=d[2]*e[4]+d[6]*e[5]+d[10]*e[6]+d[14]*e[7],f[7]=d[3]*e[4]+d[7]*e[5]+d[11]*e[6]+d[15]*e[7],f[8]=d[0]*e[8]+d[4]*e[9]+d[8]*e[10]+d[12]*e[11],f[9]=d[1]*e[8]+d[5]*e[9]+d[9]*e[10]+d[13]*e[11],f[10]=d[2]*e[8]+d[6]*e[9]+d[10]*e[10]+d[14]*e[11],f[11]=d[3]*e[8]+d[7]*e[9]+d[11]*e[10]+d[15]*e[11],f[12]=d[0]*e[12]+d[4]*e[13]+d[8]*e[14]+d[12]*e[15],f[13]=d[1]*e[12]+d[5]*e[13]+d[9]*e[14]+d[13]*e[15],f[14]=d[2]*e[12]+d[6]*e[13]+d[10]*e[14]+d[14]*e[15],f[15]=d[3]*e[12]+d[7]*e[13]+d[11]*e[14]+d[15]*e[15],c.mat},cc.kmMat4Assign=function(a,b){if(a==b)return cc.log("cc.kmMat4Assign(): pOut equals pIn"),a;var c=a.mat,d=b.mat;return c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],a},cc.kmMat4AreEqual=function(a,b){if(a==b)return cc.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0;for(var c=0;16>c;c++)if(!(a.mat[c]+cc.kmEpsilon>b.mat[c]&&a.mat[c]-cc.kmEpsilon<b.mat[c]))return!1;return!0},cc.kmMat4RotationX=function(a,b){return a.mat[0]=1,a.mat[1]=0,a.mat[2]=0,a.mat[3]=0,a.mat[4]=0,a.mat[5]=Math.cos(b),a.mat[6]=Math.sin(b),a.mat[7]=0,a.mat[8]=0,a.mat[9]=-Math.sin(b),a.mat[10]=Math.cos(b),a.mat[11]=0,a.mat[12]=0,a.mat[13]=0,a.mat[14]=0,a.mat[15]=1,a},cc.kmMat4RotationY=function(a,b){return a.mat[0]=Math.cos(b),a.mat[1]=0,a.mat[2]=-Math.sin(b),a.mat[3]=0,a.mat[4]=0,a.mat[5]=1,a.mat[6]=0,a.mat[7]=0,a.mat[8]=Math.sin(b),a.mat[9]=0,a.mat[10]=Math.cos(b),a.mat[11]=0,a.mat[12]=0,a.mat[13]=0,a.mat[14]=0,a.mat[15]=1,a},cc.kmMat4RotationZ=function(a,b){return a.mat[0]=Math.cos(b),a.mat[1]=Math.sin(b),a.mat[2]=0,a.mat[3]=0,a.mat[4]=-Math.sin(b),a.mat[5]=Math.cos(b),a.mat[6]=0,a.mat[7]=0,a.mat[8]=0,a.mat[9]=0,a.mat[10]=1,a.mat[11]=0,a.mat[12]=0,a.mat[13]=0,a.mat[14]=0,a.mat[15]=1,a},cc.kmMat4RotationPitchYawRoll=function(a,b,c,d){var e=Math.cos(b),f=Math.sin(b),g=Math.cos(c),h=Math.sin(c),i=Math.cos(d),j=Math.sin(d),k=f*h,l=e*h;return a.mat[0]=g*i,a.mat[4]=g*j,a.mat[8]=-h,a.mat[1]=k*i-e*j,a.mat[5]=k*j+e*i,a.mat[9]=f*g,a.mat[2]=l*i+f*j,a.mat[6]=l*j-f*i,a.mat[10]=e*g,a.mat[3]=a.mat[7]=a.mat[11]=0,a.mat[15]=1,a},cc.kmMat4RotationQuaternion=function(a,b){return a.mat[0]=1-2*(b.y*b.y+b.z*b.z),a.mat[1]=2*(b.x*b.y+b.z*b.w),a.mat[2]=2*(b.x*b.z-b.y*b.w),a.mat[3]=0,a.mat[4]=2*(b.x*b.y-b.z*b.w),a.mat[5]=1-2*(b.x*b.x+b.z*b.z),a.mat[6]=2*(b.z*b.y+b.x*b.w),a.mat[7]=0,a.mat[8]=2*(b.x*b.z+b.y*b.w),a.mat[9]=2*(b.y*b.z-b.x*b.w),a.mat[10]=1-2*(b.x*b.x+b.y*b.y),a.mat[11]=0,a.mat[12]=0,a.mat[13]=0,a.mat[14]=0,a.mat[15]=1,a},cc.kmMat4RotationTranslation=function(a,b,c){return a.mat[0]=b.mat[0],a.mat[1]=b.mat[1],a.mat[2]=b.mat[2],a.mat[3]=0,a.mat[4]=b.mat[3],a.mat[5]=b.mat[4],a.mat[6]=b.mat[5],a.mat[7]=0,a.mat[8]=b.mat[6],a.mat[9]=b.mat[7],a.mat[10]=b.mat[8],a.mat[11]=0,a.mat[12]=c.x,a.mat[13]=c.y,a.mat[14]=c.z,a.mat[15]=1,a},cc.kmMat4Scaling=function(a,b,c,d){return a.mat[0]=b,a.mat[5]=c,a.mat[10]=d,a.mat[15]=1,a.mat[1]=a.mat[2]=a.mat[3]=a.mat[4]=a.mat[6]=a.mat[7]=a.mat[8]=a.mat[9]=a.mat[11]=a.mat[12]=a.mat[13]=a.mat[14]=0,a},cc.kmMat4Translation=function(a,b,c,d){return a.mat[0]=a.mat[5]=a.mat[10]=a.mat[15]=1,a.mat[1]=a.mat[2]=a.mat[3]=a.mat[4]=a.mat[6]=a.mat[7]=a.mat[8]=a.mat[9]=a.mat[11]=0,a.mat[12]=b,a.mat[13]=c,a.mat[14]=d,a},cc.kmMat4GetUpVec3=function(a,b){return a.x=b.mat[4],a.y=b.mat[5],a.z=b.mat[6],cc.kmVec3Normalize(a,a),a},cc.kmMat4GetRightVec3=function(a,b){return a.x=b.mat[0],a.y=b.mat[1],a.z=b.mat[2],cc.kmVec3Normalize(a,a),a},cc.kmMat4GetForwardVec3=function(a,b){return a.x=b.mat[8],a.y=b.mat[9],a.z=b.mat[10],cc.kmVec3Normalize(a,a),a},cc.kmMat4PerspectiveProjection=function(a,b,c,d,e){var f=cc.kmDegreesToRadians(b/2),g=e-d,h=Math.sin(f);if(0==g||0==h||0==c)return null;var i=Math.cos(f)/h;return cc.kmMat4Identity(a),a.mat[0]=i/c,a.mat[5]=i,a.mat[10]=-(e+d)/g,a.mat[11]=-1,a.mat[14]=-2*d*e/g,a.mat[15]=0,a},cc.kmMat4OrthographicProjection=function(a,b,c,d,e,f,g){return cc.kmMat4Identity(a),a.mat[0]=2/(c-b),a.mat[5]=2/(e-d),a.mat[10]=-2/(g-f),a.mat[12]=-((c+b)/(c-b)),a.mat[13]=-((e+d)/(e-d)),a.mat[14]=-((g+f)/(g-f)),a},cc.kmMat4LookAt=function(a,b,c,d){var e=new cc.kmVec3,f=new cc.kmVec3,g=new cc.kmVec3,h=new cc.kmVec3,i=new cc.kmMat4;return cc.kmVec3Subtract(e,c,b),cc.kmVec3Normalize(e,e),cc.kmVec3Assign(f,d),cc.kmVec3Normalize(f,f),cc.kmVec3Cross(g,e,f),cc.kmVec3Normalize(g,g),cc.kmVec3Cross(h,g,e),cc.kmVec3Normalize(g,g),cc.kmMat4Identity(a),a.mat[0]=g.x,a.mat[4]=g.y,a.mat[8]=g.z,a.mat[1]=h.x,a.mat[5]=h.y,a.mat[9]=h.z,a.mat[2]=-e.x,a.mat[6]=-e.y,a.mat[10]=-e.z,cc.kmMat4Translation(i,-b.x,-b.y,-b.z),cc.kmMat4Multiply(a,a,i),a},cc.kmMat4RotationAxisAngle=function(a,b,c){var d=Math.cos(c),e=Math.sin(c),f=new cc.kmVec3;return cc.kmVec3Normalize(f,b),a.mat[0]=d+f.x*f.x*(1-d),a.mat[1]=f.z*e+f.y*f.x*(1-d),a.mat[2]=-f.y*e+f.z*f.x*(1-d),a.mat[3]=0,a.mat[4]=-f.z*e+f.x*f.y*(1-d),a.mat[5]=d+f.y*f.y*(1-d),a.mat[6]=f.x*e+f.z*f.y*(1-d),a.mat[7]=0,a.mat[8]=f.y*e+f.x*f.z*(1-d),a.mat[9]=-f.x*e+f.y*f.z*(1-d),a.mat[10]=d+f.z*f.z*(1-d),a.mat[11]=0,a.mat[12]=0,a.mat[13]=0,a.mat[14]=0,a.mat[15]=1,a},cc.kmMat4ExtractRotation=function(a,b){return a.mat[0]=b.mat[0],a.mat[1]=b.mat[1],a.mat[2]=b.mat[2],a.mat[3]=b.mat[4],a.mat[4]=b.mat[5],a.mat[5]=b.mat[6],a.mat[6]=b.mat[8],a.mat[7]=b.mat[9],a.mat[8]=b.mat[10],a},cc.kmMat4ExtractPlane=function(a,b,c){switch(c){case cc.KM_PLANE_RIGHT:a.a=b.mat[3]-b.mat[0],a.b=b.mat[7]-b.mat[4],a.c=b.mat[11]-b.mat[8],a.d=b.mat[15]-b.mat[12];break;case cc.KM_PLANE_LEFT:a.a=b.mat[3]+b.mat[0],a.b=b.mat[7]+b.mat[4],a.c=b.mat[11]+b.mat[8],a.d=b.mat[15]+b.mat[12];break;case cc.KM_PLANE_BOTTOM:a.a=b.mat[3]+b.mat[1],a.b=b.mat[7]+b.mat[5],a.c=b.mat[11]+b.mat[9],a.d=b.mat[15]+b.mat[13];break;case cc.KM_PLANE_TOP:a.a=b.mat[3]-b.mat[1],a.b=b.mat[7]-b.mat[5],a.c=b.mat[11]-b.mat[9],a.d=b.mat[15]-b.mat[13];break;case cc.KM_PLANE_FAR:a.a=b.mat[3]-b.mat[2],a.b=b.mat[7]-b.mat[6],a.c=b.mat[11]-b.mat[10],a.d=b.mat[15]-b.mat[14];break;case cc.KM_PLANE_NEAR:a.a=b.mat[3]+b.mat[2],a.b=b.mat[7]+b.mat[6],a.c=b.mat[11]+b.mat[10],a.d=b.mat[15]+b.mat[14];break;default:cc.log("cc.kmMat4ExtractPlane(): Invalid plane index")}var d=Math.sqrt(a.a*a.a+a.b*a.b+a.c*a.c);return a.a/=d,a.b/=d,a.c/=d,a.d/=d,a},cc.kmMat4RotationToAxisAngle=function(a,b,c){var d=new cc.kmQuaternion,e=new cc.kmMat3;return cc.kmMat4ExtractRotation(e,c),cc.kmQuaternionRotationMatrix(d,e),cc.kmQuaternionToAxisAngle(d,a,b),a},cc.KM_PLANE_LEFT=0,cc.KM_PLANE_RIGHT=1,cc.KM_PLANE_BOTTOM=2,cc.KM_PLANE_TOP=3,cc.KM_PLANE_NEAR=4,cc.KM_PLANE_FAR=5,cc.kmPlane=function(a,b,c,d){this.a=a||0,this.b=b||0,this.c=c||0,this.d=d||0},cc.POINT_INFRONT_OF_PLANE=0,cc.POINT_BEHIND_PLANE=1,cc.POINT_ON_PLANE=2,cc.kmPlaneDot=function(a,b){return a.a*b.x+a.b*b.y+a.c*b.z+a.d*b.w},cc.kmPlaneDotCoord=function(a,b){return a.a*b.x+a.b*b.y+a.c*b.z+a.d},cc.kmPlaneDotNormal=function(a,b){return a.a*b.x+a.b*b.y+a.c*b.z},cc.kmPlaneFromPointNormal=function(a,b,c){return a.a=c.x,a.b=c.y,a.c=c.z,a.d=-cc.kmVec3Dot(c,b),a},cc.kmPlaneFromPoints=function(a,b,c,d){var e=new cc.kmVec3,f=new cc.kmVec3,g=new cc.kmVec3;return cc.kmVec3Subtract(f,c,b),cc.kmVec3Subtract(g,d,b),cc.kmVec3Cross(e,f,g),cc.kmVec3Normalize(e,e),a.a=e.x,a.b=e.y,a.c=e.z,a.d=cc.kmVec3Dot(cc.kmVec3Scale(e,e,-1),b),a},cc.kmPlaneIntersectLine=function(){throw"cc.kmPlaneIntersectLine() hasn't been implemented."},cc.kmPlaneNormalize=function(a,b){var c=new cc.kmVec3;c.x=b.a,c.y=b.b,c.z=b.c;var d=1/cc.kmVec3Length(c);return cc.kmVec3Normalize(c,c),a.a=c.x,a.b=c.y,a.c=c.z,a.d=b.d*d,a},cc.kmPlaneScale=function(){cc.log("cc.kmPlaneScale() has not been implemented.")},cc.kmPlaneClassifyPoint=function(a,b){var c=a.a*b.x+a.b*b.y+a.c*b.z+a.d;return c>.001?cc.POINT_INFRONT_OF_PLANE:-.001>c?cc.POINT_BEHIND_PLANE:cc.POINT_ON_PLANE},cc.kmQuaternion=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d||0},cc.kmQuaternionConjugate=function(a,b){return a.x=-b.x,a.y=-b.y,a.z=-b.z,a.w=b.w,a},cc.kmQuaternionDot=function(a,b){return a.w*b.w+a.x*b.x+a.y*b.y+a.z*b.z},cc.kmQuaternionExp=function(a){return a},cc.kmQuaternionIdentity=function(a){return a.x=0,a.y=0,a.z=0,a.w=1,a},cc.kmQuaternionInverse=function(a,b){var c=cc.kmQuaternionLength(b),d=new cc.kmQuaternion;return Math.abs(c)>cc.kmEpsilon?(a.x=0,a.y=0,a.z=0,a.w=0,a):(cc.kmQuaternionScale(a,cc.kmQuaternionConjugate(d,b),1/c),a)},cc.kmQuaternionIsIdentity=function(a){return 0==a.x&&0==a.y&&0==a.z&&1==a.w},cc.kmQuaternionLength=function(a){return Math.sqrt(cc.kmQuaternionLengthSq(a))},cc.kmQuaternionLengthSq=function(a){return a.x*a.x+a.y*a.y+a.z*a.z+a.w*a.w},cc.kmQuaternionLn=function(a){return a},cc.kmQuaternionMultiply=function(a,b,c){return a.w=b.w*c.w-b.x*c.x-b.y*c.y-b.z*c.z,a.x=b.w*c.x+b.x*c.w+b.y*c.z-b.z*c.y,a.y=b.w*c.y+b.y*c.w+b.z*c.x-b.x*c.z,a.z=b.w*c.z+b.z*c.w+b.x*c.y-b.y*c.x,a},cc.kmQuaternionNormalize=function(a,b){var c=cc.kmQuaternionLength(b);if(Math.abs(c)<=cc.kmEpsilon)throw"cc.kmQuaternionNormalize(): pIn is an invalid value";return cc.kmQuaternionScale(a,b,1/c),a},cc.kmQuaternionRotationAxis=function(a,b,c){var d=.5*c,e=Math.sin(d);return a.w=Math.cos(d),a.x=b.x*e,a.y=b.y*e,a.z=b.z*e,a},cc.kmQuaternionRotationMatrix=function(a,b){var c,d,e,f,g=[],h=0,i=0;if(!b)return null;g[0]=b.mat[0],g[1]=b.mat[3],g[2]=b.mat[6],g[4]=b.mat[1],g[5]=b.mat[4],g[6]=b.mat[7],g[8]=b.mat[2],g[9]=b.mat[5],g[10]=b.mat[8],g[15]=1;var j=g[0];return i=j[0]+j[5]+j[10]+1,i>cc.kmEpsilon?(h=2*Math.sqrt(i),c=(j[9]-j[6])/h,d=(j[2]-j[8])/h,e=(j[4]-j[1])/h,f=.25*h):j[0]>j[5]&&j[0]>j[10]?(h=2*Math.sqrt(1+j[0]-j[5]-j[10]),c=.25*h,d=(j[4]+j[1])/h,e=(j[2]+j[8])/h,f=(j[9]-j[6])/h):j[5]>j[10]?(h=2*Math.sqrt(1+j[5]-j[0]-j[10]),c=(j[4]+j[1])/h,d=.25*h,e=(j[9]+j[6])/h,f=(j[2]-j[8])/h):(h=2*Math.sqrt(1+j[10]-j[0]-j[5]),c=(j[2]+j[8])/h,d=(j[9]+j[6])/h,e=.25*h,f=(j[4]-j[1])/h),a.x=c,a.y=d,a.z=e,a.w=f,a},cc.kmQuaternionRotationYawPitchRoll=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o;return e=cc.kmDegreesToRadians(c)/2,f=cc.kmDegreesToRadians(b)/2,g=cc.kmDegreesToRadians(d)/2,h=Math.cos(e),i=Math.cos(f),j=Math.cos(g),k=Math.sin(e),l=Math.sin(f),m=Math.sin(g),n=i*j,o=l*m,a.w=h*n+k*o,a.x=k*n-h*o,a.y=h*l*j+k*i*m,a.z=h*i*m-k*l*j,cc.kmQuaternionNormalize(a,a),a},cc.kmQuaternionSlerp=function(a,b,c,d){if(b.x==c.x&&b.y==c.y&&b.z==c.z&&b.w==c.w)return a.x=b.x,a.y=b.y,a.z=b.z,a.w=b.w,a;var e=cc.kmQuaternionDot(b,c),f=Math.acos(e),g=Math.sqrt(1-cc.kmSQR(e)),h=Math.sin(d*f)/g,i=Math.sin((1-d)*f)/g,j=new cc.kmQuaternion,k=new cc.kmQuaternion;return cc.kmQuaternionScale(j,b,i),cc.kmQuaternionScale(k,c,h),cc.kmQuaternionAdd(a,j,k),a},cc.kmQuaternionToAxisAngle=function(a,b,c){var d,e;d=Math.acos(a.w),e=Math.sqrt(cc.kmSQR(a.x)+cc.kmSQR(a.y)+cc.kmSQR(a.z)),e>-cc.kmEpsilon&&e<cc.kmEpsilon||e<2*cc.kmPI+cc.kmEpsilon&&e>2*cc.kmPI-cc.kmEpsilon?(c=0,b.x=0,b.y=0,b.z=1):(c=2*d,b.x=a.x/e,b.y=a.y/e,b.z=a.z/e,cc.kmVec3Normalize(b,b))},cc.kmQuaternionScale=function(a,b,c){return a.x=b.x*c,a.y=b.y*c,a.z=b.z*c,a.w=b.w*c,a},cc.kmQuaternionAssign=function(a,b){return a.x=b.x,a.y=b.y,a.z=b.z,a.w=b.w,a},cc.kmQuaternionAdd=function(a,b,c){return a.x=b.x+c.x,a.y=b.y+c.y,a.z=b.z+c.z,a.w=b.w+c.w,a},cc.kmQuaternionRotationBetweenVec3=function(a,b,c,d){var e,f=new cc.kmVec3,g=new cc.kmVec3;if(cc.kmVec3Assign(f,b),cc.kmVec3Assign(g,c),cc.kmVec3Normalize(f,f),cc.kmVec3Normalize(g,g),e=cc.kmVec3Dot(f,g),e>=1)return cc.kmQuaternionIdentity(a),a;if(1e-6-1>e)if(Math.abs(cc.kmVec3LengthSq(d))<cc.kmEpsilon)cc.kmQuaternionRotationAxis(a,d,cc.kmPI);else{var h=new cc.kmVec3,i=new cc.kmVec3;if(i.x=1,i.y=0,i.z=0,cc.kmVec3Cross(h,i,b),Math.abs(cc.kmVec3LengthSq(h))<cc.kmEpsilon){var j=new cc.kmVec3;j.x=0,j.y=1,j.z=0,cc.kmVec3Cross(h,j,b)}cc.kmVec3Normalize(h,h),cc.kmQuaternionRotationAxis(a,h,cc.kmPI)}else{var k=Math.sqrt(2*(1+e)),l=1/k,m=new cc.kmVec3;cc.kmVec3Cross(m,f,g),a.x=m.x*l,a.y=m.y*l,a.z=m.z*l,a.w=.5*k,cc.kmQuaternionNormalize(a,a)}return a},cc.kmQuaternionMultiplyVec3=function(a,b,c){var d=new cc.kmVec3,e=new cc.kmVec3,f=new cc.kmVec3;return f.x=b.x,f.y=b.y,f.z=b.z,cc.kmVec3Cross(d,f,c),cc.kmVec3Cross(e,f,d),cc.kmVec3Scale(d,d,2*b.w),cc.kmVec3Scale(e,e,2),cc.kmVec3Add(a,c,d),cc.kmVec3Add(a,a,e),a},cc.kmAABB=function(a,b){this.min=a||new cc.kmVec3,this.max=b||new cc.kmVec3},cc.kmAABBContainsPoint=function(a,b){return a.x>=b.min.x&&a.x<=b.max.x&&a.y>=b.min.y&&a.y<=b.max.y&&a.z>=b.min.z&&a.z<=b.max.z?cc.KM_TRUE:cc.KM_FALSE},cc.kmAABBAssign=function(a,b){return cc.kmVec3Assign(a.min,b.min),cc.kmVec3Assign(a.max,b.max),a},cc.kmAABBScale=function(){cc.log("cc.kmAABBScale hasn't been supported.")},cc.km_mat4_stack=function(a,b,c,d){this.top=c,this.stack=d},cc.km_mat4_stack.INITIAL_SIZE=30,cc.km_mat4_stack_initialize=function(a){a.stack=[],a.top=null},cc.km_mat4_stack_push=function(a,b){a.stack.push(a.top),a.top=new cc.kmMat4,cc.kmMat4Assign(a.top,b)},cc.km_mat4_stack_pop=function(a){a.top=a.stack.pop()},cc.km_mat4_stack_release=function(a){a.stack=null,a.top=null,a=null},cc.KM_GL_MODELVIEW=5888,cc.KM_GL_PROJECTION=5889,cc.KM_GL_TEXTURE=5890,cc.modelview_matrix_stack=new cc.km_mat4_stack,cc.projection_matrix_stack=new cc.km_mat4_stack,cc.texture_matrix_stack=new cc.km_mat4_stack,cc.current_stack=null,cc.initialized=!1,cc.lazyInitialize=function(){if(!cc.initialized){var a=new cc.kmMat4;cc.km_mat4_stack_initialize(cc.modelview_matrix_stack),cc.km_mat4_stack_initialize(cc.projection_matrix_stack),cc.km_mat4_stack_initialize(cc.texture_matrix_stack),cc.current_stack=cc.modelview_matrix_stack,cc.initialized=!0,cc.kmMat4Identity(a),cc.km_mat4_stack_push(cc.modelview_matrix_stack,a),cc.km_mat4_stack_push(cc.projection_matrix_stack,a),cc.km_mat4_stack_push(cc.texture_matrix_stack,a)}},cc.lazyInitialize(),cc.kmGLFreeAll=function(){cc.km_mat4_stack_release(cc.modelview_matrix_stack),cc.km_mat4_stack_release(cc.projection_matrix_stack),cc.km_mat4_stack_release(cc.texture_matrix_stack),cc.initialized=!1,cc.current_stack=null},cc.kmGLPushMatrix=function(){cc.km_mat4_stack_push(cc.current_stack,cc.current_stack.top)},cc.kmGLPushMatrixWitMat4=function(a){cc.current_stack.stack.push(cc.current_stack.top),cc.kmMat4Assign(a,cc.current_stack.top),cc.current_stack.top=a},cc.kmGLPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop()},cc.kmGLMatrixMode=function(a){switch(a){case cc.KM_GL_MODELVIEW:cc.current_stack=cc.modelview_matrix_stack;break;case cc.KM_GL_PROJECTION:cc.current_stack=cc.projection_matrix_stack;break;case cc.KM_GL_TEXTURE:cc.current_stack=cc.texture_matrix_stack;break;default:throw"Invalid matrix mode specified"}},cc.kmGLLoadIdentity=function(){cc.kmMat4Identity(cc.current_stack.top)},cc.kmGLLoadMatrix=function(a){cc.kmMat4Assign(cc.current_stack.top,a)},cc.kmGLMultMatrix=function(a){cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,a)},cc.kmGLTranslatef=function(a,b,c){var d=new cc.kmMat4;cc.kmMat4Translation(d,a,b,c),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,d)},cc.kmGLRotatef=function(a,b,c,d){var e=new cc.kmVec3(b,c,d),f=new cc.kmMat4;cc.kmMat4RotationAxisAngle(f,e,cc.kmDegreesToRadians(a)),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,f)},cc.kmGLScalef=function(a,b,c){var d=new cc.kmMat4;cc.kmMat4Scaling(d,a,b,c),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,d)},cc.kmGLGetMatrix=function(a,b){switch(a){case cc.KM_GL_MODELVIEW:cc.kmMat4Assign(b,cc.modelview_matrix_stack.top);break;case cc.KM_GL_PROJECTION:cc.kmMat4Assign(b,cc.projection_matrix_stack.top);break;case cc.KM_GL_TEXTURE:cc.kmMat4Assign(b,cc.texture_matrix_stack.top);break;default:throw"Invalid matrix mode specified"}};