cc.IMAGE_FORMAT_JPEG=0,cc.IMAGE_FORMAT_PNG=1,cc.IMAGE_FORMAT_RAWDATA=9,cc.NextPOT=function(a){return a-=1,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a+1},cc.RenderTexture=cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_cacheCanvas:null,_cacheContext:null,_fBO:0,_depthRenderBuffer:0,_oldFBO:0,_texture:null,_textureCopy:null,_uITextureImage:null,_pixelFormat:cc.Texture2D.PIXEL_FORMAT_RGBA8888,_clearColor:null,clearStencilVal:0,_clearColorStr:null,_className:"RenderTexture",_beginWithClearCommand:null,_clearDepthCommand:null,_clearCommand:null,_beginCommand:null,_endCommand:null,ctor:null,_ctorForCanvas:function(a,b,c,d){cc.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._clearColor=cc.color(255,255,255,255),this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=cc.newElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this.anchorX=0,this.anchorY=0,void 0!==a&&void 0!==b&&(c=c||cc.Texture2D.PIXEL_FORMAT_RGBA8888,d=d||0,this.initWithWidthAndHeight(a,b,c,d))},_initRendererCmd:function(){cc._renderType===cc._RENDER_TYPE_WEBGL&&(this._rendererCmd=new cc.RenderTextureRenderCmdWebGL(this))},_ctorForWebGL:function(a,b,c,d){cc.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._clearColor=cc.color(0,0,0,0),void 0!==a&&void 0!==b&&(c=c||cc.Texture2D.PIXEL_FORMAT_RGBA8888,d=d||0,this.initWithWidthAndHeight(a,b,c,d))},cleanup:null,_cleanupForCanvas:function(){cc.Node.prototype.onExit.call(this),this._cacheContext=null,this._cacheCanvas=null},_cleanupForWebGL:function(){cc.Node.prototype.onExit.call(this),this._textureCopy=null;var a=cc._renderContext;a.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&a.deleteRenderbuffer(this._depthRenderBuffer),this._uITextureImage=null},getSprite:function(){return this.sprite},setSprite:function(a){this.sprite=a},initWithWidthAndHeight:null,_initWithWidthAndHeightForCanvas:function(a,b){var c=this._cacheCanvas,d=cc.contentScaleFactor();c.width=0|a*d,c.height=0|b*d,this._cacheContext.translate(0,c.height);var e=new cc.Texture2D;e.initWithElement(c),e.handleLoadedTexture();var f=this.sprite=cc.Sprite.create(e);return f.setBlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA),this.autoDraw=!1,this.addChild(f),!0},_initWithWidthAndHeightForWebGL:function(a,b,c,d){c==cc.Texture2D.PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var e=cc._renderContext,f=cc.contentScaleFactor();a=0|a*f,b=0|b*f,this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING);var g,h;cc.configuration.supportsNPOT()?(g=a,h=b):(g=cc.NextPOT(a),h=cc.NextPOT(b));for(var i=g*h*4,j=new Uint8Array(i),k=0;g*h*4>k;k++)j[k]=0;if(this._pixelFormat=c,this._texture=new cc.Texture2D,!this._texture)return!1;var l=this._texture;l.initWithData(j,this._pixelFormat,g,h,cc.size(a,b));var m=e.getParameter(e.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(j,this._pixelFormat,g,h,cc.size(a,b))}this._fBO=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l._webTextureObj,0),0!=d&&(this._depthRenderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this._depthRenderBuffer),e.renderbufferStorage(e.RENDERBUFFER,d,g,h),d==e.DEPTH_STENCIL?e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this._depthRenderBuffer):d==e.STENCIL_INDEX||d==e.STENCIL_INDEX8?e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this._depthRenderBuffer):d==e.DEPTH_COMPONENT16&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this._depthRenderBuffer)),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),l.setAliasTexParameters(),this.sprite=cc.Sprite.create(l);var n=this.sprite;return n.scaleY=-1,n.setBlendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.bindRenderbuffer(e.RENDERBUFFER,m),e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),this.autoDraw=!1,this.addChild(n),!0},begin:null,_beginForCanvas:function(){cc.renderer._isCacheToCanvasOn=!0},_beginForWebGL:function(){cc.renderer._isCacheToBufferOn=!0,cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPushMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix();var a=cc.director;a.setProjection(a.getProjection());var b=this._texture.getContentSizeInPixels(),c=cc.director.getWinSizeInPixels(),d=c.width/b.width,e=c.height/b.height,f=cc._renderContext;f.viewport(0,0,b.width,b.height);var g=new cc.kmMat4;cc.kmMat4OrthographicProjection(g,-1/d,1/d,-1/e,1/e,-1,1),cc.kmGLMultMatrix(g),this._oldFBO=f.getParameter(f.FRAMEBUFFER_BINDING),f.bindFramebuffer(f.FRAMEBUFFER,this._fBO),cc.configuration.checkForGLExtension("GL_QCOM")&&(f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this._textureCopy._webTextureObj,0),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this._texture._webTextureObj,0))},beginWithClear:function(a,b,c,d,e,f){var g=cc._renderContext;e=e||g.COLOR_BUFFER_BIT,f=f||g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT,this._beginWithClear(a,b,c,d,e,f,g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT|g.STENCIL_BUFFER_BIT)},_beginWithClear:null,_beginWithClearForCanvas:function(a,b,c,d){this.begin(),a=a||0,b=b||0,c=c||0,d=isNaN(d)?1:d;var e=this._cacheContext,f=this._cacheCanvas;e.save(),e.fillStyle="rgba("+(0|a)+","+(0|b)+","+(0|c)+","+d/255+")",e.clearRect(0,0,f.width,-f.height),e.fillRect(0,0,f.width,-f.height),e.restore()},_beginWithClearForWebGL:function(a,b,c,d,e,f,g){a/=255,b/=255,c/=255,d/=255,this.begin();var h=cc._renderContext,i=[0,0,0,0],j=0,k=0;g&h.COLOR_BUFFER_BIT&&(i=h.getParameter(h.COLOR_CLEAR_VALUE),h.clearColor(a,b,c,d)),g&h.DEPTH_BUFFER_BIT&&(j=h.getParameter(h.DEPTH_CLEAR_VALUE),h.clearDepth(e)),g&h.STENCIL_BUFFER_BIT&&(k=h.getParameter(h.STENCIL_CLEAR_VALUE),h.clearStencil(f)),h.clear(g),g&h.COLOR_BUFFER_BIT&&h.clearColor(i[0],i[1],i[2],i[3]),g&h.DEPTH_BUFFER_BIT&&h.clearDepth(j),g&h.STENCIL_BUFFER_BIT&&h.clearStencil(k)},end:null,_endForCanvas:function(){cc.renderer._renderingToCacheCanvas(this._cacheContext)},_endForWebGL:function(){cc.renderer._renderingToBuffer();var a=cc._renderContext,b=cc.director;a.bindFramebuffer(a.FRAMEBUFFER,this._oldFBO),b.setViewport(),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPopMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPopMatrix()},clear:function(a,b,c,d){this.beginWithClear(a,b,c,d),this.end()},clearRect:null,_clearRectForCanvas:function(a,b,c,d){this._cacheContext.clearRect(a,b,c,-d)},_clearRectForWebGL:function(){},clearDepth:null,_clearDepthForCanvas:function(){cc.log("clearDepth isn't supported on Cocos2d-Html5")},_clearDepthForWebGL:function(a){this.begin();var b=cc._renderContext,c=b.getParameter(b.DEPTH_CLEAR_VALUE);b.clearDepth(a),b.clear(b.DEPTH_BUFFER_BIT),b.clearDepth(c),this.end()},clearStencil:null,_clearStencilForCanvas:function(){cc.log("clearDepth isn't supported on Cocos2d-Html5")},_clearStencilForWebGL:function(a){var b=cc._renderContext,c=b.getParameter(b.STENCIL_CLEAR_VALUE);b.clearStencil(a),b.clear(b.STENCIL_BUFFER_BIT),b.clearStencil(c)},visit:null,_visitForCanvas:function(a){this._visible&&(a=a||cc._renderContext,this.transform(a),this.sprite.visit(a))},_visitForWebGL:function(a){this._visible&&(cc.kmGLPushMatrix(),this.transform(a),this.sprite.visit(),this._rendererCmd&&cc.renderer.pushRenderCommand(this._rendererCmd),cc.kmGLPopMatrix())},draw:null,_drawForCanvas:function(a){if(a=a||cc._renderContext,this.autoDraw){if(this.begin(),this.clearFlags){var b=this._cacheCanvas;a.save(),a.fillStyle=this._clearColorStr,a.clearRect(0,0,b.width,-b.height),a.fillRect(0,0,b.width,-b.height),a.restore()}this.sortAllChildren();for(var c=this._children,d=c.length,e=this.sprite,f=0;d>f;f++){var g=c[f];g!=e&&g.visit()}this.end()}},_drawForWebGL:function(){var a=cc._renderContext;if(this.autoDraw){this.begin();var b=this.clearFlags;if(b){var c=[0,0,0,0],d=0,e=0;b&a.COLOR_BUFFER_BIT&&(c=a.getParameter(a.COLOR_CLEAR_VALUE),a.clearColor(this._clearColor.r/255,this._clearColor.g/255,this._clearColor.b/255,this._clearColor.a/255)),b&a.DEPTH_BUFFER_BIT&&(d=a.getParameter(a.DEPTH_CLEAR_VALUE),a.clearDepth(this.clearDepthVal)),b&a.STENCIL_BUFFER_BIT&&(e=a.getParameter(a.STENCIL_CLEAR_VALUE),a.clearStencil(this.clearStencilVal)),a.clear(b),b&a.COLOR_BUFFER_BIT&&a.clearColor(c[0],c[1],c[2],c[3]),b&a.DEPTH_BUFFER_BIT&&a.clearDepth(d),b&a.STENCIL_BUFFER_BIT&&a.clearStencil(e)}this.sortAllChildren();for(var f=this._children,g=0;g<f.length;g++){var h=f[g];h!=this.sprite&&h.visit()}this.end()}},newCCImage:function(){return cc.log("saveToFile isn't supported on cocos2d-html5"),null},_memcpy:function(a,b,c,d,e){for(var f=0;e>f;f++)a[b+f]=c[d+f]},saveToFile:function(){cc.log("saveToFile isn't supported on Cocos2d-Html5")},listenToBackground:function(){cc.log("listenToBackground isn't supported on Cocos2d-Html5")},listenToForeground:function(){cc.log("listenToForeground isn't supported on Cocos2d-Html5")},getClearFlags:function(){return this.clearFlags},setClearFlags:function(a){this.clearFlags=a},getClearColor:function(){return this._clearColor},setClearColor:null,_setClearColorForCanvas:function(a){var b=this._clearColor;b.r=a.r,b.g=a.g,b.b=a.b,b.a=a.a,this._clearColorStr="rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+","+a.a/255+")"},_setClearColorForWebGL:function(a){var b=this._clearColor;b.r=a.r,b.g=a.g,b.b=a.b,b.a=a.a},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(a){this.clearDepthVal=a},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(a){this.clearStencilVal=a},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(a){this.autoDraw=a}});var _p=cc.RenderTexture.prototype;cc._renderType==cc._RENDER_TYPE_WEBGL?(_p.ctor=_p._ctorForWebGL,_p.cleanup=_p._cleanupForWebGL,_p.initWithWidthAndHeight=_p._initWithWidthAndHeightForWebGL,_p.begin=_p._beginForWebGL,_p._beginWithClear=_p._beginWithClearForWebGL,_p.end=_p._endForWebGL,_p.clearRect=_p._clearRectForWebGL,_p.clearDepth=_p._clearDepthForWebGL,_p.clearStencil=_p._clearStencilForWebGL,_p.visit=_p._visitForWebGL,_p.draw=_p._drawForWebGL,_p.setClearColor=_p._setClearColorForWebGL):(_p.ctor=_p._ctorForCanvas,_p.cleanup=_p._cleanupForCanvas,_p.initWithWidthAndHeight=_p._initWithWidthAndHeightForCanvas,_p.begin=_p._beginForCanvas,_p._beginWithClear=_p._beginWithClearForCanvas,_p.end=_p._endForCanvas,_p.clearRect=_p._clearRectForCanvas,_p.clearDepth=_p._clearDepthForCanvas,_p.clearStencil=_p._clearStencilForCanvas,_p.visit=_p._visitForCanvas,_p.draw=_p._drawForCanvas,_p.setClearColor=_p._setClearColorForCanvas),_p.clearColorVal,cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor),cc.RenderTexture.create=function(a,b,c,d){return new cc.RenderTexture(a,b,c,d)};