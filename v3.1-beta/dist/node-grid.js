cc.NodeGrid=cc.Node.extend({grid:null,_target:null,_gridBeginCommand:null,_gridEndCommand:null,ctor:function(){cc.Node.prototype.ctor.call(this),cc._renderType===cc._RENDER_TYPE_WEBGL&&(this._gridBeginCommand=new cc.CustomRenderCmdWebGL(this,this.onGridBeginDraw),this._gridEndCommand=new cc.CustomRenderCmdWebGL(this,this.onGridEndDraw))},getGrid:function(){return this.grid},setGrid:function(a){this.grid=a},setTarget:function(a){this._target=a},onGridBeginDraw:function(){var a=cc._renderType==cc._RENDER_TYPE_WEBGL,b=this.grid;a&&b&&b._active&&b.beforeDraw()},onGridEndDraw:function(){var a=cc._renderType==cc._RENDER_TYPE_WEBGL,b=this.grid;a&&b&&b._active&&b.afterDraw(this._target)},visit:function(){var a=this;if(a._visible){var b=cc._renderType==cc._RENDER_TYPE_WEBGL,c=this.grid;if(b){var d=cc.current_stack;d.stack.push(d.top),cc.kmMat4Assign(this._stackMatrix,d.top),d.top=this._stackMatrix}if(a.transform(),b){var e=cc.director.PROJECTION_DEFAULT;c&&c._active&&(e=cc.director.getProjection()),this._gridBeginCommand&&cc.renderer.pushRenderCommand(this._gridBeginCommand),this._target&&this._target.visit()}var f=this._children;if(f&&f.length>0){var g=f.length;this.sortAllChildren();for(var h=0;g>h;h++){var i=f[h];i&&i.visit()}}b&&(c&&c._active,this._gridEndCommand&&cc.renderer.pushRenderCommand(this._gridEndCommand),d.top=d.stack.pop())}},_transformForWebGL:function(){var a=this._transform4x4,b=cc.current_stack.top,c=this.nodeToParentTransform(),d=a.mat;if(d[0]=c.a,d[4]=c.c,d[12]=c.tx,d[1]=c.b,d[5]=c.d,d[13]=c.ty,d[14]=this._vertexZ,cc.kmMat4Multiply(b,b,a),!(null==this._camera||this.grid&&this.grid.isActive())){var e=this._anchorPointInPoints.x,f=this._anchorPointInPoints.y,g=0!==e||0!==f;g?(cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(e=0|e,f=0|f),cc.kmGLTranslatef(e,f,0),this._camera.locate(),cc.kmGLTranslatef(-e,-f,0)):this._camera.locate()}}});var _p=cc.NodeGrid.prototype;cc._renderType===cc._RENDER_TYPE_WEBGL&&(_p.transform=_p._transformForWebGL),_p.grid,_p.target,cc.defineGetterSetter(_p,"target",null,_p.setTarget),cc.NodeGrid.create=function(){return new cc.NodeGrid};