!function(){ccs.Skin.WebGLRenderCmd=function(a){cc.Sprite.WebGLRenderCmd.call(this,a)};var a=ccs.Skin.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(ccs.Skin.RenderCmd,a),a.constructor=ccs.Skin.WebGLRenderCmd,a.vertexBytesPerUnit=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,a.bytesPerUnit=a.vertexBytesPerUnit,a.indicesPerUnit=6,a.verticesPerUnit=4,a._supportBatch=!0,a.batchShader=null,a.updateTransform=function(){var a=this._node,b=this._quad,c=this._vertices;if(this._buffer){var d,e,f,g=this.getNodeToParentTransform(),h=this._float32View,i=0,j=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT/16,k=this.getParentRenderCmd(),l=k?k._stackMatrix:cc.current_stack.top,m=this._transform4x4,n=this._stackMatrix,o=m.mat;for(o[0]=g.a,o[4]=g.c,o[12]=g.tx,o[1]=g.b,o[5]=g.d,o[13]=g.ty,cc.kmMat4Multiply(n,l,m),o[14]=a._vertexZ,o=n.mat,d=0;4>d;++d)e=c[d].x,f=c[d].y,z=c[d].z,h[i]=e*o[0]+f*o[4]+o[12],h[i+1]=e*o[1]+f*o[5]+o[13],h[i+2]=o[14],i+=j;a.textureAtlas&&a.textureAtlas.updateQuad(b,a.textureAtlas.getTotalQuads()),cc._renderContext.bindBuffer(gl.ARRAY_BUFFER,this._buffer.vertexBuffer),cc._renderContext.bufferSubData(gl.ARRAY_BUFFER,this._bufferOffset,this._float32View),cc._renderContext.bindBuffer(gl.ARRAY_BUFFER,null)}}}(),function(){ccs.Armature.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._realAnchorPointInPoints=new cc.Point(0,0)};var a=ccs.Armature.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,a),a.constructor=ccs.Armature.WebGLRenderCmd,a.rendering=function(a,b){var c=this._node;b||(cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix(),cc.kmGLLoadMatrix(this._stackMatrix));for(var d=c._children,e=cc.BlendFunc.ALPHA_PREMULTIPLIED,f=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,g=0,h=d.length;h>g;g++){var i=d[g];if(i&&i.getDisplayRenderNode){var j=i.getDisplayRenderNode();if(null===j)continue;switch(i.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(j instanceof ccs.Skin){j.setShaderProgram(this._shaderProgram),this._updateColorAndOpacity(j._renderCmd,i),j.updateTransform();var k=i.getBlendFunc();k.src!==e.src||k.dst!==e.dst?j.setBlendFunc(i.getBlendFunc()):c._blendFunc.src!==e.src||c._blendFunc.dst!==e.dst||j.getTexture().hasPremultipliedAlpha()?j.setBlendFunc(c._blendFunc):j.setBlendFunc(f),j._renderCmd.rendering(a)}break;case ccs.DISPLAY_TYPE_ARMATURE:j.setShaderProgram(this._shaderProgram),j._renderCmd.rendering(a,!0);break;default:j._renderCmd.transform(),j._renderCmd.rendering(a)}}else i instanceof cc.Node&&(i.setShaderProgram(this._shaderProgram),i._renderCmd.transform(),i._renderCmd.rendering&&i._renderCmd.rendering(a))}b||cc.kmGLPopMatrix()},a.initShaderCache=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},a.setShaderProgram=function(a){this._shaderProgram=a},a._updateColorAndOpacity=function(a,b){var c=b._renderCmd._displayedColor,d=b._renderCmd._displayedOpacity,e=cc.Node._dirtyFlags,f=a._dirtyFlag,g=f&e.colorDirty,h=f&e.opacityDirty;g&&a._updateDisplayColor(c),h&&a._updateDisplayOpacity(d),(g||h)&&a._updateColor()},a.updateChildPosition=function(a,b,c,d,e){var f=this._node;b.updateTransform();var g=c.getBlendFunc();g.src!==d.src||g.dst!==d.dst?b.setBlendFunc(c.getBlendFunc()):f._blendFunc.src!==d.src||node_blendFunc.dst!==d.dst||b.getTexture().hasPremultipliedAlpha()?b.setBlendFunc(f._blendFunc):b.setBlendFunc(e),b.rendering(a)},a.updateStatus=function(){var a=cc.Node._dirtyFlags,b=this._dirtyFlag,c=b&a.colorDirty,d=b&a.opacityDirty;c&&this._updateDisplayColor(),d&&this._updateDisplayOpacity(),(c||d)&&this._updateColor(),b&a.orderDirty&&(this._dirtyFlag=this._dirtyFlag&a.orderDirty^this._dirtyFlag),this.transform(this.getParentRenderCmd(),!0)},a.visit=function(a){var b=this._node;if(b._visible){var c=cc.current_stack;c.stack.push(c.top),this.updateStatus(a),c.top=this._stackMatrix,b.sortAllChildren();var d,e,f=cc.renderer,g=b._children,h=g.length;for(e=0;h>e&&(d=g[e],d._localZOrder<0);e++)isNaN(d._customZ)&&(d._vertexZ=f.assignedZ,f.assignedZ+=f.assignedZStep);for(isNaN(b._customZ)&&(b._vertexZ=f.assignedZ,f.assignedZ+=f.assignedZStep),f.pushRenderCommand(this);h>e;e++)d=g[e],isNaN(d._customZ)&&(d._vertexZ=f.assignedZ,f.assignedZ+=f.assignedZStep);this._dirtyFlag=0,c.top=c.stack.pop()}}}();