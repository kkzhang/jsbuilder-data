cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var a=cc.Director.prototype,b=function(a){if(a&&a._renderCmd){a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);var c,d=a._children;for(c=0;c<d.length;c++)b(d[c])}};cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var a=(cc.director,cc.director._scenesStack),c=0;c<a.length;c++)b(a[c])}),a.setProjection=function(a){var b=this,c=b._winSizeInPoints;b.setViewport();var d=b._openGLView,e=d._viewPortRect.x/d._scaleX,f=d._viewPortRect.y/d._scaleY;switch(a){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var g=cc.math.Matrix4.createOrthographicProjection(-e,c.width-e,-f,c.height-f,-1024,1024);cc.kmGLMultMatrix(g),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var h=b.getZEye(),i=new cc.math.Matrix4,j=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),i=cc.math.Matrix4.createPerspectiveProjection(60,c.width/c.height,.1,2*h),cc.kmGLMultMatrix(i),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();var k=new cc.math.Vec3(-e+c.width/2,-f+c.height/2,h),l=new cc.math.Vec3(-e+c.width/2,-f+c.height/2,0),m=new cc.math.Vec3(0,1,0);j.lookAt(k,l,m),cc.kmGLMultMatrix(j);break;case cc.Director.PROJECTION_CUSTOM:b._projectionDelegate&&b._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}b._projection=a,cc.eventManager.dispatchEvent(b._eventProjectionChanged),cc.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},a.setDepthTest=function(a){cc.renderer.setDepthTest(a)},a.setClearColor=function(a){cc.renderer._clearColor=a},a.setOpenGLView=function(a){var b=this;b._winSizeInPoints.width=cc._canvas.width,b._winSizeInPoints.height=cc._canvas.height,b._openGLView=a||cc.view;var c=cc.configuration;c.gatherGPUInfo(),c.dumpInfo(),b.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},a._clear=function(){var a=cc._renderContext;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},a._beforeVisitScene=function(){cc.kmGLPushMatrix()},a._afterVisitScene=function(){cc.kmGLPopMatrix()},a.convertToGL=function(a){var b=new cc.math.Matrix4;cc.GLToClipTransform(b);var c=b.inverse(),d=b.mat[14]/b.mat[15],e=this._openGLView.getDesignResolutionSize(),f=new cc.math.Vec3(2*a.x/e.width-1,1-2*a.y/e.height,d);return f.transformCoord(c),cc.p(f.x,f.y)},a.convertToUI=function(a){var b=new cc.math.Matrix4;cc.GLToClipTransform(b);var c=new cc.math.Vec3(a.x,a.y,0);c.transformCoord(b);var d=this._openGLView.getDesignResolutionSize();return cc.p(d.width*(.5*c.x+.5),d.height*(.5*-c.y+.5))},a.getVisibleSize=function(){return this._openGLView.getVisibleSize()},a.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},a.getZEye=function(){return this._winSizeInPoints.height/1.1566},a.setViewport=function(){var a=this._openGLView;if(a){var b=this._winSizeInPoints;a.setViewPortInPoints(-a._viewPortRect.x/a._scaleX,-a._viewPortRect.y/a._scaleY,b.width,b.height)}},a.getOpenGLView=function(){return this._openGLView},a.getProjection=function(){return this._projection},a.setAlphaBlending=function(a){a?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},a.setGLDefaultValues=function(){var a=this;a.setAlphaBlending(!0),a.setDepthTest(!1),a.setProjection(a._projection),cc._renderContext.clearColor(0,0,0,0)}}}),cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var a=this._valueDict;a["cocos2d.x.version"]=cc.ENGINE_VERSION,a["cocos2d.x.compiled_with_profiler"]=!1,a["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(a){return this._GlExtensions.indexOf(a)>-1},getValue:function(a,b){this._inited||this._init();var c=this._valueDict;return c[a]?c[a]:b},setValue:function(a,b){this._valueDict[a]=b},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var a=cc._renderContext,b=this._valueDict;b["gl.vendor"]=a.getParameter(a.VENDOR),b["gl.renderer"]=a.getParameter(a.RENDERER),b["gl.version"]=a.getParameter(a.VERSION),this._GlExtensions="";for(var c=a.getSupportedExtensions(),d=0;d<c.length;d++)this._GlExtensions+=c[d]+" ";this._maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),b["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),b["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),b["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,b["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),b["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),b["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),b["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(a){this._inited||this._init();var b=cc.loader.getRes(a);if(!b)throw new Error("Please load the resource first : "+a);cc.assert(b,cc._LogInfos.configuration_loadConfigFile_2,a);var c=b.data;if(!c)return void cc.log(cc._LogInfos.configuration_loadConfigFile,a);for(var d in c)this._valueDict[d]=c[d]}},cc.rendererWebGL=function(){function a(a){if(n.buffer){var b=cc._renderContext;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,n.buffer);for(var c=new Uint16Array(6*a),d=0,e=0,f=6*a;f>e;e+=6)c[e]=d+0,c[e+1]=d+1,c[e+2]=d+2,c[e+3]=d+1,c[e+4]=d+2,c[e+5]=d+3,d+=4;b.bufferData(b.ELEMENT_ARRAY_BUFFER,c,b.STATIC_DRAW),n.maxQuads=a}}function b(b){return null===n.buffer&&(n.buffer=cc._renderContext.createBuffer()),n.maxQuads<b&&a(b),n.buffer}function c(a,b,c,d,e){var f,g;e?(f=new Float32Array(e,b,c/4),g=new Uint32Array(e,b,c/4)):(f=new Float32Array(c/4),g=new Uint32Array(f.buffer));var h={buffer:a,float32View:f,uint32View:g,vertexOffset:b,totalBufferSize:c,count:d,valid:!0};return h}var d=!0,e=!0,f=[],g={texture:null,blendSrc:null,blendDst:null,shader:null},h={texture:null,blendSrc:null,blendDst:null,shader:null},i=null,j=new cc.SimplePool,k=!1,l=!1,m=[],n={buffer:null,maxQuads:0};return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),init:function(){this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),b(1e3)},requestBuffer:function(a){var b,c,d,e=f.length,g=cc._renderContext;for(b=0;e>b;++b)if(c=f[b],c.gl===g&&(d=c.requestBuffer(a)))return d;return d||(c=new GlobalVertexBuffer(g),f.push(c),d=c.requestBuffer(a)),d||cc.error("Request WebGL buffer failed"),d},getRenderCmd:function(a){return a._createRenderCmd()},_turnToCacheMode:function(a){this._isCacheToBufferOn=!0,a=a||0,this._cacheToBufferCmds[a]=[],this._cacheInstanceIds.push(a),this._currentID=a},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(a){a=a||this._currentID;var b=this._cacheToBufferCmds[a];b&&(b.length=0,delete this._cacheToBufferCmds[a]);var c=this._cacheInstanceIds;cc.arrayRemoveObject(c,a)},_renderingToBuffer:function(a){a=a||this._currentID;var b,c,d=this._cacheToBufferCmds[a],e=cc._renderContext;for(b=0,c=f.length;c>b;++b)f[b].update();for(gl.bindBuffer(gl.ARRAY_BUFFER,null),b=0,c=d.length;c>b;b++)d[b].rendering(e);this._removeCache(a);var g=this._cacheInstanceIds;0===g.length?this._isCacheToBufferOn=!1:this._currentID=g[g.length-1]},resetFlag:function(){this.childrenOrderDirty&&(k=!0,this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var a=this._transformNodePool;a.sort(this._sortNodeByLevelAsc);var b,c,d;for(b=0,c=a.length;c>b;b++)d=a[b],d.updateStatus();a.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(a,b){return a._curLevel-b._curLevel},pushDirtyNode:function(a){this._transformNodePool.push(a)},clearRenderCommands:function(){if(d){var a,b,c=this._renderCmds,e=c.length;for(a=0;e>a;++a)b=c[a],b._currId=-1,m[a]=b;m.length=e}this._renderCmds.length=0},clear:function(){var a=cc._renderContext;a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},setDepthTest:function(a){var b=cc._renderContext;a?(b.clearDepth(1),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL)):b.disable(b.DEPTH_TEST)},pushRenderCommand:function(a){if(a.needDraw())if(this._isCacheToBufferOn){var b=this._currentID,c=this._cacheToBufferCmds,d=c[b];-1===d.indexOf(a)&&d.push(a)}else-1===this._renderCmds.indexOf(a)&&(a._currId=this._renderCmds.length,this._renderCmds.push(a))},createBatchBuffer:function(a){var b=gl.createBuffer();return this.initBatchBuffers(b,a),{arrayBuffer:b,bufferSize:a}},initBatchBuffers:function(a,b){gl.bindBuffer(gl.ARRAY_BUFFER,a),gl.bufferData(gl.ARRAY_BUFFER,b,gl.DYNAMIC_DRAW)},getBatchBuffer:function(a){if(j.size()>0){var b=Number.MAX_VALUE,c=-1,d=j.find(function(d,e){return e.bufferSize>=a?!0:void(e.bufferSize<b&&(b=e.bufferSize,c=d))},function(){return c});if(d)return this.initBatchBuffers(d.arrayBuffer,a),d.bufferSize=a,d}return this.createBatchBuffer(a)},_refreshVirtualBuffers:function(){for(var a,b,d,e,f,i,j,k,n,o=this._renderCmds,p=m.length,q=o.length,r=0,s=0;p>r;++r)if(b=m[r],i=b._vBuffer,matched=!1,i&&i.valid){if(s=b._currId,0>s||s>=q){b._vBuffer=null;continue}for(b.getBatchInfo(g),j=r,k=0,d=o[s];b&&b===d&&b._vBuffer===i;)++k,++s,b=m[r+k],d=o[s];if(a=r+k,1>=k){b=m[r],b._vBuffer=null,d&&(d._vBuffer=null);continue}if(d&&d._supportBatch&&(d.getBatchInfo(h),h.texture===g.texture&&h.blendSrc===g.blendSrc&&h.blendDst===g.blendDst&&h.shader===g.shader)){for(;a>r;++r)m[r]._vBuffer=null;r--;continue}if(i.count===k)r=r+k-1;else if(k>1){for(b=m[r],n=k*b.bytesPerUnit,f=c(i.buffer,4*b._vertexOffset,n,k,i.float32View.buffer);a>r;++r)m[r]._vBuffer=f;r--}}for(p=o.length,r=0;p>r;++r)b=o[r],b._vBuffer||(e=o[r+1],b._supportBatch&&e&&e._supportBatch&&(k=this._forwardBatch(r),k>1)&&(r+=k-1));m.length=0,l=!1},_forwardCheck:function(a){var b=this._renderCmds,c=b[a],d=a,e=b.length,f=c._vBuffer;if(c.getBatchInfo(g),i=null,c._vertexOffset!==f.vertexOffset||!f.valid||!f.buffer)return l=!0,0;for(var h;e>d&&(c=b[d],f===c._vBuffer);++d)c._bufferDirty&&(h||(h=f,gl.bindBuffer(gl.ARRAY_BUFFER,h.buffer.arrayBuffer)),c.batchVertexBuffer(h.float32View,h.uint32View,c._vertexOffset),c._bufferDirty=!1);h&&gl.bufferSubData(gl.ARRAY_BUFFER,0,h.float32View);var j=d-a;if(f.count===j)return i=f,j;for(d=a;a+j>d;++d)c=b[d],c._vBuffer=null;return l=!0,0},_forwardBatch:function(a){var b=this._renderCmds,e=b[a],f=a+1;b.length;if(!e||!e._supportBatch)return 0;if(e.getBatchInfo(g),!g.texture)return 0;var k=e.bytesPerUnit;for(e=b[f];e&&e._supportBatch&&(e.getBatchInfo(h),h.texture===g.texture&&h.blendSrc===g.blendSrc&&h.blendDst===g.blendDst&&h.shader===g.shader);)k+=e.bytesPerUnit,++f,e=b[f];var l=f-a;if(1>=l)return l;var m=this.getBatchBuffer(k),n=c(m,0,k,l);i=n;var o=n.float32View,p=0;gl.bindBuffer(gl.ARRAY_BUFFER,n.buffer.arrayBuffer);var q;for(q=a;f>q;++q)e=b[q],e.batchVertexBuffer(o,n.uint32View,p),d&&(e._vBuffer=n,e._vertexOffset=p),e._savedDirtyFlag&&(e._savedDirtyFlag=!1),p+=e.vertexBytesPerUnit/4;return gl.bufferSubData(gl.ARRAY_BUFFER,0,o),d||j.put(m),l},_batchRendering:function(){var a=g.texture,c=g.shader,d=i.count;c.use(),c._updateProjectionUniform(),cc.glBlendFunc(g.blendSrc,g.blendDst),cc.glBindTexture2DN(0,a),gl.bindBuffer(gl.ARRAY_BUFFER,i.buffer.arrayBuffer),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);var e=i.vertexOffset;gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,gl.FLOAT,!1,24,e),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,gl.UNSIGNED_BYTE,!0,24,e+12),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,gl.FLOAT,!1,24,e+16);var f=b(d);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,f),gl.drawElements(gl.TRIANGLES,6*d,gl.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++},rendering:function(a){var b,c,d,g,h,i=this._renderCmds,j=a||cc._renderContext;for(b=0,c=f.length;c>b;++b)f[b].update();for(e&&(k||l)&&this._refreshVirtualBuffers(),j.bindBuffer(gl.ARRAY_BUFFER,null),b=0,c=i.length;c>b;++b)d=i[b],g=i[b+1],e&&d._vBuffer&&(h=this._forwardCheck(b),h>1)?(this._batchRendering(),b+=h-1):d.rendering(j);k&&(k=!1)}}}(),function(){cc.Node.WebGLRenderCmd=function(a){cc.Node.RenderCmd.call(this,a);var b=new cc.math.Matrix4,c=b.mat;c[2]=c[3]=c[6]=c[7]=c[8]=c[9]=c[11]=c[14]=0,c[10]=c[15]=1,this._transform4x4=b,this._stackMatrix=new cc.math.Matrix4,this._shaderProgram=null,this._camera=null,this._currId=-1};var a=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);a.constructor=cc.Node.WebGLRenderCmd,a._updateColor=function(){},a.visit=function(a){var b=this._node;if(b._visible){a=a||this.getParentRenderCmd(),b._parent&&b._parent._renderCmd&&(this._curLevel=b._parent._renderCmd._curLevel+1);var c=cc.current_stack;c.stack.push(c.top),this._syncStatus(a),c.top=this._stackMatrix,this.visitChildren(),c.top=c.stack.pop()}},a.transform=function(a,b){var c=this._transform4x4,d=this._stackMatrix,e=this._node;a=a||this.getParentRenderCmd();var f=a?a._stackMatrix:cc.current_stack.top,g=this.getNodeToParentTransform();this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag;var h=c.mat;if(h[0]=g.a,h[4]=g.c,h[12]=g.tx,h[1]=g.b,h[5]=g.d,h[13]=g.ty,cc.kmMat4Multiply(d,f,c),h[14]=e._vertexZ,null!==e._camera&&(null===e.grid||!e.grid.isActive())){var i=this._anchorPointInPoints.x,j=this._anchorPointInPoints.y,k=0!==i||0!==j;if(k){cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(i=0|i,j=0|j);var l=cc.math.Matrix4.createByTranslation(i,j,0,c);d.multiply(l),e._camera._locateForRenderer(d),l=cc.math.Matrix4.createByTranslation(-i,-j,0,l),d.multiply(l),c.identity()}else e._camera._locateForRenderer(d)}if(b&&e._children){var m,n,o=e._children;for(m=0,n=o.length;n>m;m++)o[m]._renderCmd.transform(this,b)}},a.setShaderProgram=function(a){this._shaderProgram=a},a.getShaderProgram=function(){return this._shaderProgram}}(),function(){cc.Layer.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a)};var a=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.Layer.WebGLRenderCmd,a.bake=function(){},a.unbake=function(){},a._bakeForAddChild=function(){}}(),function(){cc.LayerColor.WebGLRenderCmd=function(a){cc.Layer.WebGLRenderCmd.call(this,a),this._needDraw=!0;var b=this;b._squareVerticesAB=new ArrayBuffer(32),b._squareColorsAB=new ArrayBuffer(16);var c=b._squareVerticesAB,d=b._squareColorsAB,e=cc.Vertex2F.BYTES_PER_ELEMENT,f=cc.Color.BYTES_PER_ELEMENT;b._squareVertices=[new cc.Vertex2F(0,0,c,0),new cc.Vertex2F(0,0,c,e),new cc.Vertex2F(0,0,c,2*e),new cc.Vertex2F(0,0,c,3*e)],b._squareColors=[cc.color(0,0,0,255,d,0),cc.color(0,0,0,255,d,f),cc.color(0,0,0,255,d,2*f),cc.color(0,0,0,255,d,3*f)],b._verticesFloat32Buffer=cc._renderContext.createBuffer(),b._colorsUint8Buffer=cc._renderContext.createBuffer()};var a=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);a.constructor=cc.LayerColor.WebGLRenderCmd,a.rendering=function(a){var b=a||cc._renderContext,c=this._node;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst),b.bindBuffer(b.ARRAY_BUFFER,this._verticesFloat32Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._colorsUint8Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,0,0),b.drawArrays(b.TRIANGLE_STRIP,0,this._squareVertices.length)},a._updateSquareVertices=function(a,b){var c=this._squareVertices;void 0===b?(c[1].x=a.width,c[2].y=a.height,c[3].x=a.width,c[3].y=a.height):(c[1].x=a,c[2].y=b,c[3].x=a,c[3].y=b),this._bindLayerVerticesBufferData()},a._updateSquareVerticesWidth=function(a){var b=this._squareVertices;b[1].x=a,b[3].x=a,this._bindLayerVerticesBufferData()},a._updateSquareVerticesHeight=function(a){var b=this._squareVertices;b[2].y=a,b[3].y=a,this._bindLayerVerticesBufferData()},a._updateColor=function(){for(var a=this._displayedColor,b=this._displayedOpacity,c=this._squareColors,d=0;4>d;d++)c[d].r=a.r,c[d].g=a.g,c[d].b=a.b,c[d].a=b;this._bindLayerColorsBufferData()},a._bindLayerVerticesBufferData=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._verticesFloat32Buffer),a.bufferData(a.ARRAY_BUFFER,this._squareVerticesAB,a.STATIC_DRAW)},a._bindLayerColorsBufferData=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._colorsUint8Buffer),a.bufferData(a.ARRAY_BUFFER,this._squareColorsAB,a.STATIC_DRAW)},a.updateBlendFunc=function(a){}}(),function(){cc.LayerGradient.WebGLRenderCmd=function(a){cc.LayerColor.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._clipRect=new cc.Rect,this._clippingRectDirty=!1};var a=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);cc.inject(cc.LayerGradient.RenderCmd,a),a.constructor=cc.LayerGradient.WebGLRenderCmd,a._syncStatus=function(a){var b=cc.Node._dirtyFlags,c=this._dirtyFlag,d=a?a._node:null;d&&d._cascadeColorEnabled&&a._dirtyFlag&b.colorDirty&&(c|=b.colorDirty),d&&d._cascadeOpacityEnabled&&a._dirtyFlag&b.opacityDirty&&(c|=b.opacityDirty),a&&a._dirtyFlag&b.transformDirty&&(c|=b.transformDirty);var e=c&b.colorDirty,f=c&b.opacityDirty;this._dirtyFlag=c,e&&this._syncDisplayColor(),f&&this._syncDisplayOpacity(),this.transform(a),(e||f||c&b.gradientDirty)&&this._updateColor()},a._updateColor=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.gradientDirty^this._dirtyFlag;var a=this._node,b=a._colorStops;if(b&&!(b.length<2)){this._clippingRectDirty=!0;var c,d=b.length,e=2*d,f=a._contentSize;this._squareVerticesAB=new ArrayBuffer(8*e),this._squareColorsAB=new ArrayBuffer(4*e);var g=this._squareVertices,h=this._squareColors;g.length=0,h.length=0;var i=this._squareVerticesAB,j=this._squareColorsAB,k=cc.Vertex2F.BYTES_PER_ELEMENT,l=cc.Color.BYTES_PER_ELEMENT;for(c=0;e>c;c++)g.push(new cc.Vertex2F(0,0,i,k*c)),h.push(cc.color(0,0,0,255,j,l*c));var m=Math.PI+cc.pAngleSigned(cc.p(0,-1),a._alongVector),n=cc.p(f.width/2,f.height/2),o=Math.round(cc.radiansToDegrees(m)),p=cc.affineTransformMake(1,0,0,1,n.x,n.y);p=cc.affineTransformRotate(p,m);var q,r;90>o?(q=cc.p(-n.x,n.y),r=cc.p(n.x,n.y)):180>o?(q=cc.p(n.x,n.y),r=cc.p(n.x,-n.y)):270>o?(q=cc.p(n.x,-n.y),r=cc.p(-n.x,-n.y)):(q=cc.p(-n.x,-n.y),r=cc.p(-n.x,n.y));var s=Math.sin(m),t=Math.cos(m),u=Math.abs((q.x*t-q.y*s)/n.x),v=Math.abs((r.x*s+r.y*t)/n.y);for(p=cc.affineTransformScale(p,u,v),c=0;d>c;c++){var w=b[c],x=w.p*f.height,y=cc.pointApplyAffineTransform(-n.x,x-n.y,p);g[2*c].x=y.x,g[2*c].y=y.y;var z=cc.pointApplyAffineTransform(f.width-n.x,x-n.y,p);g[2*c+1].x=z.x,g[2*c+1].y=z.y}var A=this._displayedOpacity/255;for(c=0;d>c;c++){var B=b[c].color,C=h[2*c],D=h[2*c+1];C.r=B.r,C.g=B.g,C.b=B.b,C.a=B.a*A,D.r=B.r,D.g=B.g,D.b=B.b,D.a=B.a*A}this._bindLayerVerticesBufferData(),this._bindLayerColorsBufferData()}},a.rendering=function(a){var b=a||cc._renderContext,c=this._node,d=this._getClippingRect();b.enable(b.SCISSOR_TEST),cc.view.setScissorInPoints(d.x,d.y,d.width,d.height),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst),b.bindBuffer(b.ARRAY_BUFFER,this._verticesFloat32Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._colorsUint8Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,0,0),b.drawArrays(b.TRIANGLE_STRIP,0,this._squareVertices.length),b.disable(b.SCISSOR_TEST)},a._getClippingRect=function(){if(this._clippingRectDirty){var a=this._node,b=cc.rect(0,0,a._contentSize.width,a._contentSize.height),c=a.getNodeToWorldTransform();this._clipRect=cc._rectApplyAffineTransformIn(b,c)}return this._clipRect}}(),function(){var a=!0;cc.Sprite.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._vertices=[{x:0,y:0,z:0},{x:0,y:0,z:0},{x:0,y:0,z:0},{x:0,y:0,z:0}];var c=this.vertexBytesPerUnit,d=cc.renderer.requestBuffer(c);this._buffer=d.buffer,this._bufferOffset=d.offset,this._quad=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._buffer.data,this._bufferOffset),this._float32View=new Float32Array(this._buffer.data,this._bufferOffset,c/4),this._uint32View=new Uint32Array(this._buffer.data,this._bufferOffset,c/4),this._dirty=!1,this._bufferDirty=!1,this._recursiveDirty=!1,this._vBuffer=null,this._vertexOffset=0,b.batchShader||(b.batchShader=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST))};var b=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);b.constructor=cc.Sprite.WebGLRenderCmd,b.vertexBytesPerUnit=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,b.bytesPerUnit=b.vertexBytesPerUnit,b.indicesPerUnit=6,b.verticesPerUnit=4,b._supportBatch=!0,b.batchShader=null,b.getBatchInfo=function(a){a.texture=this._node._texture,a.blendSrc=this._node._blendFunc.src,a.blendDst=this._node._blendFunc.dst,a.shader=this.batchShader},b._invalidBatch=function(){this._vBuffer&&(this._vBuffer.valid=!1)},b.updateBuffer=function(){if(!this._buffer){var a=this.vertexBytesPerUnit,b=cc.renderer.requestBuffer(a);this._buffer=b.buffer,this._bufferOffset=b.offset,this._quad=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._buffer.data,this._bufferOffset),this._float32View=new Float32Array(this._quad.arrayBuffer,this._bufferOffset,a/4),this._uint32View=new Uint32Array(this._quad.arrayBuffer,this._bufferOffset,a/4),this._setTextureCoords(this._node._rect),this._updateColor(),this._updateVertexBuffer()}},b.freeBuffer=function(){this._buffer&&(this._buffer.freeBuffer(this._bufferOffset,this.vertexBytesPerUnit),this._buffer=null,this._bufferOffset=0,this._quad=null,this._float32View=null)},b.updateBlendFunc=function(a){},b.setDirtyFlag=function(a){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,a),this._dirty=!0},b.setDirtyRecursively=function(a){this._recursiveDirty=a,this._dirty=a;for(var b,c=this._node._children,d=c?c.length:0,e=0;d>e;e++)b=c[e],b instanceof cc.Sprite&&b._renderCmd.setDirtyRecursively(a)},b._setBatchNodeForAddChild=function(a){var b=this._node;if(b._batchNode){if(!(a instanceof cc.Sprite))return cc.log(cc._LogInfos.Sprite_addChild),!1;a.texture._webTextureObj!==b.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2),b._batchNode.appendChild(a),b._reorderChildDirty||b._setReorderChildDirtyRecursively()}return!0},b._handleTextureForRotatedTexture=function(a){return a},b.isFrameDisplayed=function(a){var b=this._node;return cc.rectEqualToRect(a.getRect(),b._rect)&&a.getTexture().getName()===b._texture.getName()&&cc.pointEqualToPoint(a.getOffset(),b._unflippedOffsetPositionFromCenter)},b._init=function(){this.updateBuffer();var a={r:255,g:255,b:255,a:255},b=this._quad;b.bl.colors=a,b.br.colors=a,b.tl.colors=a,b.tr.colors=a,this._bufferDirty=!0,this._buffer.setDirty()},b._resetForBatchNode=function(){var a=this._node,b=a._offsetPosition.x,c=a._offsetPosition.y,d=b+a._rect.width,e=c+a._rect.height,f=this._vertices;f[0].x=b,f[0].y=e,f[1].x=b,f[1].y=c,f[2].x=d,f[2].y=e,f[3].x=d,f[3].y=c,this._bufferDirty=!0,this._buffer&&this._buffer.setDirty()},b.getQuad=function(){return this._quad},b._updateForSetSpriteFrame=function(){},b._spriteFrameLoadedCallback=function(a){this.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize()),this.dispatchEvent("load")},b._textureLoadedCallback=function(a){this._renderCmd;if(!this._textureLoaded){this._textureLoaded=!0;var b=this._rect;b?cc._rectEqualToZero(b)&&(b.width=a.width,b.height=a.height):b=cc.rect(0,0,a.width,a.height),this.texture=a,this.setTextureRect(b,this._rectRotated),this.setBatchNode(this._batchNode),this.dispatchEvent("load")}},b._setTextureCoords=function(a,b){void 0===b&&(b=!0),b&&(a=cc.rectPointsToPixels(a));var c=this._node,d=this._quad,e=c._batchNode?c.textureAtlas.texture:c._texture;if(e&&d){var f,g,h,i,j,k=e.pixelsWidth,l=e.pixelsHeight;c._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*a.x+1)/(2*k),g=f+(2*a.height-2)/(2*k),h=(2*a.y+1)/(2*l),i=h+(2*a.width-2)/(2*l)):(f=a.x/k,g=(a.x+a.height)/k,h=a.y/l,i=(a.y+a.width)/l),c._flippedX&&(j=h,h=i,i=j),c._flippedY&&(j=f,f=g,g=j),d.bl.texCoords.u=f,d.bl.texCoords.v=h,d.br.texCoords.u=f,d.br.texCoords.v=i,d.tl.texCoords.u=g,d.tl.texCoords.v=h,d.tr.texCoords.u=g,d.tr.texCoords.v=i):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*a.x+1)/(2*k),g=f+(2*a.width-2)/(2*k),h=(2*a.y+1)/(2*l),i=h+(2*a.height-2)/(2*l)):(f=a.x/k,g=(a.x+a.width)/k,h=a.y/l,i=(a.y+a.height)/l),c._flippedX&&(j=f,f=g,g=j),c._flippedY&&(j=h,h=i,i=j),d.bl.texCoords.u=f,d.bl.texCoords.v=i,d.br.texCoords.u=g,d.br.texCoords.v=i,d.tl.texCoords.u=f,d.tl.texCoords.v=h,d.tr.texCoords.u=g,d.tr.texCoords.v=h),this._bufferDirty=!0,this._buffer.setDirty()}},b._updateVertexBuffer=function(){if(this._buffer){var a,b,c,d=this._stackMatrix.mat,e=this._vertices,f=this._float32View,g=0,h=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT/16;for(a=0;4>a;++a)b=e[a].x,c=e[a].y,f[g]=b*d[0]+c*d[4]+d[12],f[g+1]=b*d[1]+c*d[5]+d[13],f[g+2]=d[14],g+=h;this._bufferDirty=!0,this._buffer.setDirty()}},b.transform=function(a,b){cc.Node.WebGLRenderCmd.prototype.transform.call(this,a,b),this._updateVertexBuffer(),this._dirty=!0,this._savedDirtyFlag=!0},b._setColorDirty=function(){},b._updateColor=function(){var a=this._displayedColor,b=this._displayedOpacity,c=this._node,d={r:a.r,g:a.g,b:a.b,a:b};c._opacityModifyRGB&&(d.r*=b/255,d.g*=b/255,d.b*=b/255);var e=this._quad;e&&(e.bl.colors=d,e.br.colors=d,e.tl.colors=d,e.tr.colors=d,this._buffer.setDirty()),c._batchNode&&(c.atlasIndex!==cc.Sprite.INDEX_NOT_INITIALIZED?c.textureAtlas.updateQuad(e,c.atlasIndex):this._dirty=!0),this._bufferDirty=!0},b._updateBlendFunc=function(){if(this._batchNode)return void cc.log(cc._LogInfos.Sprite__updateBlendFunc);var a=this._node,b=a._blendFunc;a._texture&&a._texture.hasPremultipliedAlpha()?(b.src===cc.SRC_ALPHA&&b.dst===cc.BLEND_DST&&(b.src=cc.ONE),a.opacityModifyRGB=!0):(b.src===cc.ONE&&b.dst===cc.BLEND_DST&&(b.src=cc.SRC_ALPHA),a.opacityModifyRGB=!1),this._invalidBatch()},b._setTexture=function(a){var b=this._node;if(b._batchNode){if(b._batchNode.texture!==a)return void cc.log(cc._LogInfos.Sprite_setTexture)}else b._texture!==a&&(b._textureLoaded=a?a._textureLoaded:!1,b._texture=a,this._updateBlendFunc());a?this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST):this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_COLOR)},b.updateTransform=function(){var a=this,b=this._node;if(this._dirty){var c=a._quad,d=b._parent;if(!b._visible||d&&d!==b._batchNode&&d._shouldBeHidden)c.br.vertices=c.tl.vertices=c.tr.vertices=c.bl.vertices={x:0,y:0,z:0},b._shouldBeHidden=!0;else{b._shouldBeHidden=!1,0!==this._dirtyFlag&&(this.updateStatus(),this._dirtyFlag=0),d&&d!==b._batchNode?b._transformToBatch=cc.affineTransformConcat(a.getNodeToParentTransform(),d._transformToBatch):b._transformToBatch=a.getNodeToParentTransform();var e=b._transformToBatch,f=b._rect,g=b._offsetPosition.x,h=b._offsetPosition.y,i=g+f.width,j=h+f.height,k=e.tx,l=e.ty,m=e.a,n=e.b,o=e.d,p=-e.c,q=g*m-h*p+k,r=g*n+h*o+l,s=i*m-h*p+k,t=i*n+h*o+l,u=i*m-j*p+k,v=i*n+j*o+l,w=g*m-j*p+k,x=g*n+j*o+l,y=b._vertexZ;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(q=0|q,r=0|r,s=0|s,t=0|t,u=0|u,v=0|v,w=0|w,x=0|x),c.bl.vertices={x:q,y:r,z:y},c.br.vertices={x:s,y:t,z:y},c.tl.vertices={x:w,y:x,z:y},c.tr.vertices={x:u,y:v,z:y}}b.textureAtlas.updateQuad(c,b.atlasIndex),b._recursiveDirty=!1,this._dirty=!1}b._hasChildren&&b._arrayMakeObjectsPerformSelector(b._children,cc.Node._stateCallbackType.updateTransform)},b._checkTextureBoundary=function(a,b,c){if(a&&a.url){var d,e;c?(d=b.x+b.height,e=b.y+b.width):(d=b.x+b.width,e=b.y+b.height),d>a.width&&cc.error(cc._LogInfos.RectWidth,a.url),e>a.height&&cc.error(cc._LogInfos.RectHeight,a.url)}},b.needDraw=function(){return this._buffer&&this._node._texture},b.rendering=function(b){var c=this._node,d=c._texture;if(this._buffer&&(!d||d._textureLoaded&&c._rect.width&&c._rect.height)&&this._displayedOpacity){var e=b||cc._renderContext,f=this._shaderProgram;if(d){if(d._textureLoaded){f.use(),f._updateProjectionUniform(),cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst),cc.glBindTexture2DN(0,d);var g=!e.bindBuffer(e.ARRAY_BUFFER,this._buffer.vertexBuffer);(a||g)&&(e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,24,12),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,24,16),a=!1),e.drawArrays(e.TRIANGLE_STRIP,this._bufferOffset/(this.vertexBytesPerUnit/4),4)}}else f.use(),f._updateProjectionUniform(),cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst),e.bindBuffer(e.ARRAY_BUFFER,this._buffer.vertexBuffer),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,24,12),e.drawArrays(e.TRIANGLE_STRIP,this._bufferOffset/(this.vertexBytesPerUnit/4),4),a=!0;if(cc.g_NumberOfDraws++,0!==cc.SPRITE_DEBUG_DRAW||c._showNode){if(cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.current_stack.stack.push(cc.current_stack.top),cc.current_stack.top=this._stackMatrix,1===cc.SPRITE_DEBUG_DRAW||c._showNode){var h=this._vertices,i=[cc.p(h[0].x,h[0].y),cc.p(h[2].x,h[2].y),cc.p(h[3].x,h[3].y),cc.p(h[1].x,h[1].y)];cc._drawingUtil.drawPoly(i,4,!0)}else if(2===cc.SPRITE_DEBUG_DRAW){var j=c.getTextureRect(),k=c.getOffsetPosition(),l=[cc.p(k.x,k.y),cc.p(k.x+j.width,k.y),cc.p(k.x+j.width,k.y+j.height),cc.p(k.x,k.y+j.height)];cc._drawingUtil.drawPoly(l,4,!0)}cc.current_stack.top=cc.current_stack.stack.pop()}}},b.batchVertexBuffer=function(a,b,c){var d,e=this._float32View,f=this._uint32View,g=e.length,h=3;for(d=0;g>d;++d)d===h?(b[c+d]=f[d],h+=6):a[c+d]=e[d]}}(),function(){cc.LabelTTF.WebGLRenderCmd=function(a){cc.Sprite.WebGLRenderCmd.call(this,a),cc.LabelTTF.CacheRenderCmd.call(this),this.setShaderProgram(cc.shaderCache.programForKey(cc.LabelTTF._SHADER_PROGRAM));
};var a=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);a._supportBatch=!1,cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,a),a.constructor=cc.LabelTTF.WebGLRenderCmd,a._updateColor=function(){this._updateTexture(),cc.Sprite.WebGLRenderCmd.prototype._updateColor.call(this)}}(),cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(a){if(null==a&&(a=cc._renderContext),!a instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=a,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var a=this;a._initialized||(a._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),a._shader._addUniformLocation(this._colorLocation),a._shader._addUniformLocation(this._pointSizeLocation),a._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(a){this.lazy_init();var b=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c),b.bufferData(b.ARRAY_BUFFER,new Float32Array([a.x,a.y]),b.STATIC_DRAW),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0),b.drawArrays(b.POINTS,0,1),b.deleteBuffer(c),cc.incrementGLDraws(1)},drawPoints:function(a,b){if(a&&0!==a.length){this.lazy_init();var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d),c.bufferData(c.ARRAY_BUFFER,this._pointsToTypeArray(a),c.STATIC_DRAW),c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.POINTS,0,a.length),c.deleteBuffer(d),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(a){for(var b=new Float32Array(2*a.length),c=0;c<a.length;c++)b[2*c]=a[c].x,b[2*c+1]=a[c].y;return b},drawLine:function(a,b){this.lazy_init();var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d),c.bufferData(c.ARRAY_BUFFER,this._pointsToTypeArray([a,b]),c.STATIC_DRAW),c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINES,0,2),c.deleteBuffer(d),cc.incrementGLDraws(1)},drawRect:function(a,b){this.drawLine(cc.p(a.x,a.y),cc.p(b.x,a.y)),this.drawLine(cc.p(b.x,a.y),cc.p(b.x,b.y)),this.drawLine(cc.p(b.x,b.y),cc.p(a.x,b.y)),this.drawLine(cc.p(a.x,b.y),cc.p(a.x,a.y))},drawSolidRect:function(a,b,c){var d=[a,cc.p(b.x,a.y),b,cc.p(a.x,b.y)];this.drawSolidPoly(d,4,c)},drawPoly:function(a,b,c){this.lazy_init();var d=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),d.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var e=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,e),d.bufferData(d.ARRAY_BUFFER,this._pointsToTypeArray(a),d.STATIC_DRAW),d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0),c?d.drawArrays(d.LINE_LOOP,0,a.length):d.drawArrays(d.LINE_STRIP,0,a.length),d.deleteBuffer(e),cc.incrementGLDraws(1)},drawSolidPoly:function(a,b,c){this.lazy_init(),c&&this.setDrawColor(c.r,c.g,c.b,c.a);var d=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),d.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var e=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,e),d.bufferData(d.ARRAY_BUFFER,this._pointsToTypeArray(a),d.STATIC_DRAW),d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_FAN,0,a.length),d.deleteBuffer(e),cc.incrementGLDraws(1)},drawCircle:function(a,b,c,d,e){this.lazy_init();var f=1;e&&f++;var g=2*Math.PI/d,h=new Float32Array(2*(d+2));if(h){for(var i=0;d>=i;i++){var j=i*g,k=b*Math.cos(j+c)+a.x,l=b*Math.sin(j+c)+a.y;h[2*i]=k,h[2*i+1]=l}h[2*(d+1)]=a.x,h[2*(d+1)+1]=a.y;var m=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),m.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var n=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,n),m.bufferData(m.ARRAY_BUFFER,h,m.STATIC_DRAW),m.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,m.FLOAT,!1,0,0),m.drawArrays(m.LINE_STRIP,0,d+f),m.deleteBuffer(n),cc.incrementGLDraws(1)}},drawQuadBezier:function(a,b,c,d){this.lazy_init();for(var e=new Float32Array(2*(d+1)),f=0,g=0;d>g;g++)e[2*g]=Math.pow(1-f,2)*a.x+2*(1-f)*f*b.x+f*f*c.x,e[2*g+1]=Math.pow(1-f,2)*a.y+2*(1-f)*f*b.y+f*f*c.y,f+=1/d;e[2*d]=c.x,e[2*d+1]=c.y;var h=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),h.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var i=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,i),h.bufferData(h.ARRAY_BUFFER,e,h.STATIC_DRAW),h.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),h.drawArrays(h.LINE_STRIP,0,d+1),h.deleteBuffer(i),cc.incrementGLDraws(1)},drawCubicBezier:function(a,b,c,d,e){this.lazy_init();for(var f=new Float32Array(2*(e+1)),g=0,h=0;e>h;h++)f[2*h]=Math.pow(1-g,3)*a.x+3*Math.pow(1-g,2)*g*b.x+3*(1-g)*g*g*c.x+g*g*g*d.x,f[2*h+1]=Math.pow(1-g,3)*a.y+3*Math.pow(1-g,2)*g*b.y+3*(1-g)*g*g*c.y+g*g*g*d.y,g+=1/e;f[2*e]=d.x,f[2*e+1]=d.y;var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var j=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,j),i.bufferData(i.ARRAY_BUFFER,f,i.STATIC_DRAW),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINE_STRIP,0,e+1),i.deleteBuffer(j),cc.incrementGLDraws(1)},drawCatmullRom:function(a,b){this.drawCardinalSpline(a,.5,b)},drawCardinalSpline:function(a,b,c){this.lazy_init();for(var d,e,f=new Float32Array(2*(c+1)),g=1/a.length,h=0;c+1>h;h++){var i=h/c;1===i?(d=a.length-1,e=1):(d=0|i/g,e=(i-g*d)/g);var j=cc.cardinalSplineAt(cc.getControlPointAt(a,d-1),cc.getControlPointAt(a,d),cc.getControlPointAt(a,d+1),cc.getControlPointAt(a,d+2),b,e);f[2*h]=j.x,f[2*h+1]=j.y}var k=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),k.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var l=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,l),k.bufferData(k.ARRAY_BUFFER,f,k.STATIC_DRAW),k.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,k.FLOAT,!1,0,0),k.drawArrays(k.LINE_STRIP,0,c+1),k.deleteBuffer(l),cc.incrementGLDraws(1)},setDrawColor:function(a,b,c,d){this._colorArray[0]=a/255,this._colorArray[1]=b/255,this._colorArray[2]=c/255,this._colorArray[3]=d/255},setPointSize:function(a){this._pointSize=a*cc.contentScaleFactor()},setLineWidth:function(a){this._renderContext.lineWidth&&this._renderContext.lineWidth(a)}});