cc.ProgressTimer=cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(a){this._midPoint=cc.pClamp(a,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(a){this._barChangeRate=cc.pClamp(a,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},
getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(a){this._percentage!=a&&(this._percentage=cc.clampf(a,0,100),this._updateProgress())},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},_boundaryTexCoord:function(a){if(a<cc.ProgressTimer.TEXTURE_COORDS_COUNT){var b=cc.ProgressTimer.TEXTURE_COORDS;return this._reverseDirection?cc.p(b>>7-(a<<1)&1,b>>7-
((a<<1)+1)&1):cc.p(b>>(a<<1)+1&1,b>>(a<<1)&1)}return cc.p(0,0)},_origin:null,_startAngle:270,_endAngle:270,_radius:0,_counterClockWise:!1,_barRect:null,_vertexDataCount:0,_vertexData:null,_vertexArrayBuffer:null,_vertexWebGLBuffer:null,_vertexDataDirty:!1,ctor:null,_ctorForCanvas:function(a){cc.Node.prototype.ctor.call(this);this._type=cc.ProgressTimer.TYPE_RADIAL;this._percentage=0;this._midPoint=cc.p(0,0);this._barChangeRate=cc.p(0,0);this._reverseDirection=!1;this._sprite=null;this._origin=cc.p(0,
0);this._endAngle=this._startAngle=270;this._radius=0;this._counterClockWise=!1;this._barRect=cc.rect(0,0,0,0);a&&this._initWithSpriteForCanvas(a)},_ctorForWebGL:function(a){cc.Node.prototype.ctor.call(this);this._type=cc.ProgressTimer.TYPE_RADIAL;this._percentage=0;this._midPoint=cc.p(0,0);this._barChangeRate=cc.p(0,0);this._reverseDirection=!1;this._sprite=null;this._vertexWebGLBuffer=cc._renderContext.createBuffer();this._vertexDataCount=0;this._vertexArrayBuffer=this._vertexData=null;this._vertexDataDirty=
!1;a&&this._initWithSpriteForWebGL(a)},setColor:function(a){this._sprite.color=a;this._updateColor()},setOpacity:function(a){this._sprite.opacity=a;this._updateColor()},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:null,_setReverseProgressForCanvas:function(a){this._reverseDirection!==a&&(this._reverseDirection=a)},_setReverseProgressForWebGL:function(a){this._reverseDirection!==a&&(this._reverseDirection=a,this._vertexArrayBuffer=
this._vertexData=null,this._vertexDataCount=0)},setSprite:null,_setSpriteForCanvas:function(a){this._sprite!=a&&(this._sprite=a,this.width=this._sprite.width,this.height=this._sprite.height)},_setSpriteForWebGL:function(a){a&&this._sprite!=a&&(this._sprite=a,this.width=a.width,this.height=a.height,this._vertexData&&(this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0))},setType:null,_setTypeForCanvas:function(a){a!==this._type&&(this._type=a)},_setTypeForWebGL:function(a){a!==this._type&&
(this._vertexData&&(this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0),this._type=a)},setReverseDirection:null,_setReverseDirectionForCanvas:function(a){this._reverseDirection!==a&&(this._reverseDirection=a)},_setReverseDirectionForWebGL:function(a){this._reverseDirection!==a&&(this._reverseDirection=a,this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0)},_textureCoordFromAlphaPoint:function(a){var b=this._sprite;if(!b)return{u:0,v:0};var c=b.quad,f=cc.p(c.bl.texCoords.u,
c.bl.texCoords.v),c=cc.p(c.tr.texCoords.u,c.tr.texCoords.v);b.textureRectRotated&&(b=a.x,a.x=a.y,a.y=b);return{u:f.x*(1-a.x)+c.x*a.x,v:f.y*(1-a.y)+c.y*a.y}},_vertexFromAlphaPoint:function(a){if(!this._sprite)return{x:0,y:0};var b=this._sprite.quad,c=cc.p(b.bl.vertices.x,b.bl.vertices.y),b=cc.p(b.tr.vertices.x,b.tr.vertices.y);return{x:c.x*(1-a.x)+b.x*a.x,y:c.y*(1-a.y)+b.y*a.y}},initWithSprite:null,_initWithSpriteForCanvas:function(a){this.percentage=0;this.anchorY=this.anchorX=0.5;this._type=cc.ProgressTimer.TYPE_RADIAL;
this._reverseDirection=!1;this.midPoint=cc.p(0.5,0.5);this.barChangeRate=cc.p(1,1);this.sprite=a;return!0},_initWithSpriteForWebGL:function(a){this.percentage=0;this._vertexArrayBuffer=this._vertexData=null;this._vertexDataCount=0;this.anchorY=this.anchorX=0.5;this._type=cc.ProgressTimer.TYPE_RADIAL;this._reverseDirection=!1;this.midPoint=cc.p(0.5,0.5);this.barChangeRate=cc.p(1,1);this.sprite=a;this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);return!0},draw:null,_drawForCanvas:function(a){a=
a||cc._renderContext;var b=this._sprite;b._isLighterMode&&(a.globalCompositeOperation="lighter");var c=cc.view.getScaleX(),f=cc.view.getScaleY();a.globalAlpha=b._displayedOpacity/255;var d=b._rect,g=b._contentSize,e=b._offsetPosition,h=b._drawSize_Canvas,k=0|e.x,l=-e.y-d.height,m=b._textureRect_Canvas;h.width=d.width*c;h.height=d.height*f;a.save();b._flippedX&&(k=-e.x-d.width,a.scale(-1,1));b._flippedY&&(l=e.y,a.scale(1,-1));k*=c;l*=f;this._type==cc.ProgressTimer.TYPE_BAR?(d=this._barRect,a.beginPath(),
a.rect(d.x*c,d.y*f,d.width*c,d.height*f),a.clip(),a.closePath()):this._type==cc.ProgressTimer.TYPE_RADIAL&&(d=this._origin.x*c,e=this._origin.y*f,a.beginPath(),a.arc(d,e,this._radius*f,Math.PI/180*this._startAngle,Math.PI/180*this._endAngle,this._counterClockWise),a.lineTo(d,e),a.clip(),a.closePath());b._texture&&m.validRect?(c=b._texture.getHtmlElementObj(),this._colorized?a.drawImage(c,0,0,m.width,m.height,k,l,h.width,h.height):a.drawImage(c,m.x,m.y,m.width,m.height,k,l,h.width,h.height)):0!==g.width&&
(h=this.color,a.fillStyle="rgba("+h.r+","+h.g+","+h.b+",1)",a.fillRect(k,l,g.width*c,g.height*f));a.restore();cc.incrementGLDraws(1)},_drawForWebGL:function(a){a=a||cc._renderContext;if(this._vertexData&&this._sprite){cc.nodeDrawSetup(this);var b=this._sprite.getBlendFunc();cc.glBlendFunc(b.src,b.dst);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);cc.glBindTexture2D(this._sprite.texture);a.bindBuffer(a.ARRAY_BUFFER,this._vertexWebGLBuffer);this._vertexDataDirty&&(a.bufferData(a.ARRAY_BUFFER,
this._vertexArrayBuffer,a.DYNAMIC_DRAW),this._vertexDataDirty=!1);b=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,b,0);a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,b,8);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,b,12);this._type===cc.ProgressTimer.TYPE_RADIAL?a.drawArrays(a.TRIANGLE_FAN,0,this._vertexDataCount):this._type==cc.ProgressTimer.TYPE_BAR&&(this._reverseDirection?(a.drawArrays(a.TRIANGLE_STRIP,0,this._vertexDataCount/
2),a.drawArrays(a.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):a.drawArrays(a.TRIANGLE_STRIP,0,this._vertexDataCount));cc.g_NumberOfDraws++}},_updateRadial:function(){if(this._sprite){var a,b=this._midPoint;a=this._percentage/100;var c=2*cc.PI*(this._reverseDirection?a:1-a),f=cc.p(b.x,1),d=cc.pRotateByAngle(f,b,c),c=0;if(0==a)d=f,c=0;else if(1==a)d=f,c=4;else{var g=cc.FLT_MAX,e=cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(a=0;a<=e;++a){var h=(a+(e-1))%e,k=this._boundaryTexCoord(a%
e),h=this._boundaryTexCoord(h);0==a?h=cc.pLerp(k,h,1-b.x):4==a&&(k=cc.pLerp(k,h,1-b.x));var l=cc.p(0,0);if(cc.pLineIntersect(k,h,b,d,l)&&(!(0==a||4==a)||0<=l.x&&1>=l.x)&&0<=l.y&&l.y<g)g=l.y,c=a}d=cc.pAdd(b,cc.pMult(cc.pSub(d,b),g))}g=!0;this._vertexDataCount!=c+3&&(g=!1,this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0);if(!this._vertexData){e=this._vertexDataCount=c+3;k=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(e*k);h=[];for(a=0;a<e;a++)h[a]=new cc.V2F_C4B_T2F(null,
null,null,this._vertexArrayBuffer,a*k);this._vertexData=h;if(!this._vertexData){cc.log("cc.ProgressTimer._updateRadial() : Not enough memory");return}}this._updateColor();e=this._vertexData;if(!g){e[0].texCoords=this._textureCoordFromAlphaPoint(b);e[0].vertices=this._vertexFromAlphaPoint(b);e[1].texCoords=this._textureCoordFromAlphaPoint(f);e[1].vertices=this._vertexFromAlphaPoint(f);for(a=0;a<c;a++)b=this._boundaryTexCoord(a),e[a+2].texCoords=this._textureCoordFromAlphaPoint(b),e[a+2].vertices=this._vertexFromAlphaPoint(b)}e[this._vertexDataCount-
1].texCoords=this._textureCoordFromAlphaPoint(d);e[this._vertexDataCount-1].vertices=this._vertexFromAlphaPoint(d)}},_updateBar:function(){if(this._sprite){var a,b=this._percentage/100,c=this._barChangeRate,c=cc.pMult(cc.p(1-c.x+b*c.x,1-c.y+b*c.y),0.5),b=cc.pSub(this._midPoint,c),c=cc.pAdd(this._midPoint,c);0>b.x&&(c.x+=-b.x,b.x=0);1<c.x&&(b.x-=c.x-1,c.x=1);0>b.y&&(c.y+=-b.y,b.y=0);1<c.y&&(b.y-=c.y-1,c.y=1);if(this._reverseDirection){if(!this._vertexData){this._vertexDataCount=8;var f=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;
this._vertexArrayBuffer=new ArrayBuffer(8*f);var d=[];for(a=0;8>a;a++)d[a]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,a*f);d[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,1));d[0].vertices=this._vertexFromAlphaPoint(cc.p(0,1));d[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,0));d[1].vertices=this._vertexFromAlphaPoint(cc.p(0,0));d[6].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,1));d[6].vertices=this._vertexFromAlphaPoint(cc.p(1,1));d[7].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,
0));d[7].vertices=this._vertexFromAlphaPoint(cc.p(1,0));this._vertexData=d}a=this._vertexData;a[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(b.x,c.y));a[2].vertices=this._vertexFromAlphaPoint(cc.p(b.x,c.y));a[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(b.x,b.y));a[3].vertices=this._vertexFromAlphaPoint(cc.p(b.x,b.y));a[4].texCoords=this._textureCoordFromAlphaPoint(cc.p(c.x,c.y));a[4].vertices=this._vertexFromAlphaPoint(cc.p(c.x,c.y));a[5].texCoords=this._textureCoordFromAlphaPoint(cc.p(c.x,
b.y));a[5].vertices=this._vertexFromAlphaPoint(cc.p(c.x,b.y))}else{if(!this._vertexData){this._vertexDataCount=4;f=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(4*f);this._vertexData=[];for(a=0;4>a;a++)this._vertexData[a]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,a*f)}a=this._vertexData;a[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(b.x,c.y));a[0].vertices=this._vertexFromAlphaPoint(cc.p(b.x,c.y));a[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(b.x,
b.y));a[1].vertices=this._vertexFromAlphaPoint(cc.p(b.x,b.y));a[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(c.x,c.y));a[2].vertices=this._vertexFromAlphaPoint(cc.p(c.x,c.y));a[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(c.x,b.y));a[3].vertices=this._vertexFromAlphaPoint(cc.p(c.x,b.y))}this._updateColor()}},_updateColor:function(){if(this._sprite&&this._vertexData){for(var a=this._sprite.quad.tl.colors,b=this._vertexData,c=0,f=this._vertexDataCount;c<f;++c)b[c].colors=a;this._vertexDataDirty=
!0}},_updateProgress:null,_updateProgressForCanvas:function(){var a=this._sprite,b=a.width,c=a.height,f=this._midPoint;if(this._type==cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(b*b+c*c));var d,g=!1,e=this._origin;e.x=b*f.x;e.y=-c*f.y;this._reverseDirection?(d=270,f=270-3.6*this._percentage):(f=-90,d=-90+3.6*this._percentage);a._flippedX&&(e.x-=b*2*this._midPoint.x,f=-f-180,d=-d-180,g=!g);a._flippedY&&(e.y+=c*2*this._midPoint.y,g=!g,f=-f,d=-d);this._startAngle=f;this._endAngle=
d;this._counterClockWise=g}else{d=this._barChangeRate;e=this._percentage/100;g=this._barRect;d=cc.size(b*(1-d.x),c*(1-d.y));var e=cc.size((b-d.width)*e,(c-d.height)*e),e=cc.size(d.width+e.width,d.height+e.height),h=cc.p(b*f.x,c*f.y);d=h.x-e.width/2;0.5<f.x&&e.width/2>=b-h.x&&(d=b-e.width);b=h.y-e.height/2;0.5<f.y&&e.height/2>=c-h.y&&(b=c-e.height);g.x=0;c=1;a._flippedX&&(g.x-=e.width,c=-1);0<d&&(g.x+=d*c);g.y=0;c=1;a._flippedY&&(g.y+=e.height,c=-1);0<b&&(g.y-=b*c);g.width=e.width;g.height=-e.height}},
_updateProgressForWebGL:function(){var a=this._type;a===cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():a===cc.ProgressTimer.TYPE_BAR&&this._updateBar();this._vertexDataDirty=!0}});var _p=cc.ProgressTimer.prototype;
cc._renderType==cc._RENDER_TYPE_WEBGL?(_p.ctor=_p._ctorForWebGL,_p.setReverseProgress=_p._setReverseProgressForWebGL,_p.setSprite=_p._setSpriteForWebGL,_p.setType=_p._setTypeForWebGL,_p.setReverseDirection=_p._setReverseDirectionForWebGL,_p.initWithSprite=_p._initWithSpriteForWebGL,_p.draw=_p._drawForWebGL,_p._updateProgress=_p._updateProgressForWebGL):(_p.ctor=_p._ctorForCanvas,_p.setReverseProgress=_p._setReverseProgressForCanvas,_p.setSprite=_p._setSpriteForCanvas,_p.setType=_p._setTypeForCanvas,
_p.setReverseDirection=_p._setReverseDirectionForCanvas,_p.initWithSprite=_p._initWithSpriteForCanvas,_p.draw=_p._drawForCanvas,_p._updateProgress=cc.ProgressTimer.prototype._updateProgressForCanvas);cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint);cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate);cc.defineGetterSetter(_p,"type",_p.getType,_p.setType);cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage);
cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite);cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection);cc.ProgressTimer.create=function(a){return new cc.ProgressTimer(a)};cc.ProgressTimer.TEXTURE_COORDS_COUNT=4;cc.ProgressTimer.TEXTURE_COORDS=75;cc.ProgressTimer.TYPE_RADIAL=0;cc.ProgressTimer.TYPE_BAR=1;cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);this._from=this._to=0;void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._to=b,!0):!1},clone:function(){var a=new cc.ProgressTo;a.initWithDuration(this._duration,this._to);return a},reverse:function(){cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported.");return null},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._from=a.percentage;100==this._from&&(this._from=0)},update:function(a){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*a)}});cc.ProgressTo.create=function(a,b){return new cc.ProgressTo(a,b)};
cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(a,b,c){cc.ActionInterval.prototype.ctor.call(this);this._from=this._to=0;void 0!==c&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._to=c,this._from=b,!0):!1},clone:function(){var a=new cc.ProgressFromTo;a.initWithDuration(this._duration,this._from,this._to);return a},reverse:function(){return cc.ProgressFromTo.create(this._duration,this._to,
this._from)},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a)},update:function(a){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*a)}});cc.ProgressFromTo.create=function(a,b,c){return new cc.ProgressFromTo(a,b,c)};