(function(){cc.PhysicsSprite=cc.Sprite.extend({_ignoreBodyRotation:!1,_body:null,_rotation:1,ctor:function(b,c){cc.Sprite.prototype.ctor.call(this);if(void 0===b)cc.PhysicsSprite.prototype.init.call(this);else if("string"===typeof b)if("#"===b[0]){var a=b.substr(1,b.length-1),a=cc.spriteFrameCache.getSpriteFrame(a);this.initWithSpriteFrame(a)}else this.init(b,c);else"object"===typeof b&&(b instanceof cc.Texture2D?this.initWithTexture(b,c):b instanceof cc.SpriteFrame&&this.initWithSpriteFrame(b))},
setBody:function(b){this._body=b},getBody:function(){return this._body},getPosition:function(){var b=this._body;return{x:b.p.x,y:b.p.y}},getPositionX:function(){return this._body.p.x},getPositionY:function(){return this._body.p.y},setPosition:function(b,a){void 0===a?(this._body.p.x=b.x,this._body.p.y=b.y):(this._body.p.x=b,this._body.p.y=a)},setPositionX:function(b){this._body.p.x=b},setPositionY:function(b){this._body.p.y=b},_syncPosition:function(){var b=this._position,a=this._body;(b.x!=a.p.x||
b.y!=a.p.y)&&cc.Sprite.prototype.setPosition.call(this,a.p.x,a.p.y)},getRotation:function(){return this._ignoreBodyRotation?cc.radiansToDegrees(this._rotationRadiansX):-cc.radiansToDegrees(this._body.a)},setRotation:function(b){this._ignoreBodyRotation?cc.Sprite.prototype.setRotation.call(this,b):this._body.a=-cc.degreesToRadians(b)},_syncRotation:function(){this._rotationRadiansX!=-this._body.a&&cc.Sprite.prototype.setRotation.call(this,-cc.radiansToDegrees(this._body.a))},nodeToParentTransform:function(){if(cc._renderType===
cc._RENDER_TYPE_CANVAS)return this._nodeToParentTransformForCanvas();var b=this._body,a=this._anchorPointInPoints,d=this._scaleX,e=this._scaleY,g=b.p.x,h=b.p.y;this._ignoreAnchorPointForPosition&&(g+=a.x,h+=a.y);var f=b.a,b=Math.cos(f),f=Math.sin(f);cc._rectEqualToZero(a)||(g+=b*-a.x*d+-f*-a.y*e,h+=f*-a.x*d+b*-a.y*e);return this._transform=cc.AffineTransformMake(b*d,f*d,-f*e,b*e,g,h)},_nodeToParentTransformForCanvas:function(){if(this.dirty){var b=this._transform,a=this._body,d=this._scaleX,e=this._scaleY,
g=this._anchorPointInPoints;b.tx=a.p.x;b.ty=a.p.y;var a=-a.a,h=1,f=0;a&&(h=Math.cos(a),f=Math.sin(a));b.a=b.d=h;b.b=-f;b.c=f;if(1!==d||1!==e)b.a*=d,b.c*=d,b.b*=e,b.d*=e;b.tx+=h*-g.x*d+-f*g.y*e;b.ty-=f*-g.x*d+h*g.y*e;this._ignoreAnchorPointForPosition&&(b.tx+=g.x,b.ty+=g.y);this._transformDirty=!1}return this._transform},isDirty:function(){return!this._body.isSleeping()},setDirty:function(){},setIgnoreBodyRotation:function(b){this._ignoreBodyRotation=b}});cc.PhysicsSprite._className="PhysicsSprite";
var a=cc.PhysicsSprite.prototype;cc.defineGetterSetter(a,"body",a.getBody,a.setBody);cc.defineGetterSetter(a,"dirty",a.isDirty,a.setDirty);cc.PhysicsSprite.create=function(b,a){return new cc.PhysicsSprite(b,a)}})();cc.__convertVerts=function(a){for(var b=[],c=0;c<a.length/2;c++)b[c]={x:a[2*c],y:a[2*c+1]};return b};cc.ColorForBody=function(a){return a.isRogue()||a.isSleeping()?cc.color(128,128,128,128):a.nodeIdleTime>a.space.sleepTimeThreshold?cc.color(84,84,84,128):cc.color(255,0,0,128)};
cc.DrawShape=function(a,b){var c=a.body,d=cc.ColorForBody(c);switch(a.collisionCode){case cp.CircleShape.prototype.collisionCode:this.drawDot(a.tc,Math.max(a.r,1),d);this.drawSegment(a.tc,cp.v.add(a.tc,cp.v.mult(c.rot,a.r)),1,d);break;case cp.SegmentShape.prototype.collisionCode:this.drawSegment(a.ta,a.tb,Math.max(a.r,2),d);break;case cp.PolyShape.prototype.collisionCode:c=cc.color(d.r,d.g,d.b,cc.lerp(d.a,255,0.5));this.drawPoly(cc.__convertVerts(a.tVerts),d,1,c);break;default:cc.log("cc.DrawShape(): Bad assertion in DrawShape()")}};
cc.DrawConstraint=function(a,b){var c=a.a,d=a.b,e;a instanceof cp.PinJoint?(e=c.local2World(a.anchr1),c=d.local2World(a.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(c,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,c,1,cc.CONSTRAINT_COLOR)):a instanceof cp.SlideJoint?(e=c.local2World(a.anchr1),c=d.local2World(a.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(c,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,c,1,cc.CONSTRAINT_COLOR)):a instanceof cp.PivotJoint?(e=c.local2World(a.anchr1),
c=d.local2World(a.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(c,3,cc.CONSTRAINT_COLOR)):a instanceof cp.GrooveJoint&&(e=c.local2World(a.grv_a),c=c.local2World(a.grv_b),d=d.local2World(a.anchr2),this.drawDot(d,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,c,1,cc.CONSTRAINT_COLOR))};cc.CONSTRAINT_COLOR=cc.color(0,255,0,128);
cc.PhysicsDebugNode=cc.DrawNode.extend({space:null,_spaceObj:null,_className:"PhysicsDebugNode",getSpace:function(){return this.space},setSpace:function(a){this.space=a},draw:function(a){this.space&&(this.space.eachShape(cc.DrawShape.bind(this)),this.space.eachConstraint(cc.DrawConstraint.bind(this)),cc.DrawNode.prototype.draw.call(this),this.clear())}});cc.PhysicsDebugNode.debugNodeForChipmunkSpace=function(a){var b=new cc.PhysicsDebugNode;return b.init()?(b._spaceObj=a,b.space=a.space,b):null};
cc.PhysicsDebugNode.debugNodeForCPSpace=function(a){var b=new cc.PhysicsDebugNode;return b.init()?(b.space=a,b):null};cc.PhysicsDebugNode.create=cc.PhysicsDebugNode.debugNodeForCPSpace;