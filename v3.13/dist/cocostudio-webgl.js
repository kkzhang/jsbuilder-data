!function(){ccs.Armature.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._parentCmd=null,this._realAnchorPointInPoints=new cc.Point(0,0)};var a=ccs.Armature.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,a),a.constructor=ccs.Armature.WebGLRenderCmd,a.uploadData=function(a,b,c){for(var d,e=this._node,f=this._parentCmd||this,g=e._children,h=cc.BlendFunc.ALPHA_PREMULTIPLIED,i=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,j=0,k=g.length;j<k;j++){var l=g[j],m=l._renderCmd;if(l&&l.getDisplayRenderNode){var n=l.getDisplayRenderNode();if(null===n)continue;switch(d=n._renderCmd,l.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(n instanceof ccs.Skin){n.setShaderProgram(this._shaderProgram),this._updateColorAndOpacity(d,l),d.transform(f);var o=l.getBlendFunc();if(o.src!==h.src||o.dst!==h.dst)n.setBlendFunc(l.getBlendFunc());else{var p=n.getTexture();e._blendFunc.src===h.src&&e._blendFunc.dst===h.dst&&p&&!p.hasPremultipliedAlpha()?n.setBlendFunc(i):n.setBlendFunc(e._blendFunc)}cc.renderer._uploadBufferData(d)}break;case ccs.DISPLAY_TYPE_ARMATURE:n.setShaderProgram(this._shaderProgram),d._parentCmd=this;default:m._syncStatus(f),d._syncStatus(m),d.uploadData?cc.renderer._uploadBufferData(d):d.rendering&&(cc.renderer._batchRendering(),d.rendering(cc._renderContext))}}else l instanceof cc.Node&&(l.setShaderProgram(this._shaderProgram),m._syncStatus(f),m.uploadData?cc.renderer._uploadBufferData(m):m.rendering&&(cc.renderer._batchRendering(),m.rendering(cc._renderContext)))}return this._parentCmd=null,0},a.initShaderCache=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},a.setShaderProgram=function(a){this._shaderProgram=a},a._updateColorAndOpacity=function(a,b){var c=b._renderCmd._displayedColor,d=b._renderCmd._displayedOpacity,e=cc.Node._dirtyFlags,f=a._dirtyFlag,g=f&e.colorDirty,h=f&e.opacityDirty;g&&a._updateDisplayColor(c),h&&a._updateDisplayOpacity(d),(g||h)&&a._updateColor()},a.visit=function(a){var b=this._node;if(b._visible){a=a||this.getParentRenderCmd(),a&&(this._curLevel=a._curLevel+1),this._syncStatus(a),b.sortAllChildren();var c,d,e=cc.renderer,f=b._children,g=f.length;for(isNaN(b._customZ)&&(b._vertexZ=e.assignedZ,e.assignedZ+=e.assignedZStep),d=0;d<g&&(c=f[d],c._localZOrder<0);d++)isNaN(c._customZ)&&(c._vertexZ=e.assignedZ,e.assignedZ+=e.assignedZStep);for(e.pushRenderCommand(this);d<g;d++)c=f[d],isNaN(c._customZ)&&(c._vertexZ=e.assignedZ,e.assignedZ+=e.assignedZStep);this._dirtyFlag=0}}}();