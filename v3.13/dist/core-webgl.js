cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var a=cc.Director.prototype,b=function(a){if(a&&a._renderCmd){a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);var c,d=a._children;for(c=0;c<d.length;c++)b(d[c])}};cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var a=(cc.director,cc.director._scenesStack),c=0;c<a.length;c++)b(a[c])}),a.setProjection=function(a){var b=this,c=b._winSizeInPoints;b.setViewport();var d=b._openGLView,e=d._viewPortRect.x/d._scaleX,f=d._viewPortRect.y/d._scaleY;switch(a){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var g=cc.math.Matrix4.createOrthographicProjection(0,c.width,0,c.height,-1024,1024);cc.kmGLMultMatrix(g),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var h=b.getZEye(),i=new cc.math.Matrix4,j=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),i=cc.math.Matrix4.createPerspectiveProjection(60,c.width/c.height,.1,2*h),cc.kmGLMultMatrix(i),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();var k=new cc.math.Vec3(-e+c.width/2,-f+c.height/2,h),l=new cc.math.Vec3(-e+c.width/2,-f+c.height/2,0),m=new cc.math.Vec3(0,1,0);j.lookAt(k,l,m),cc.kmGLMultMatrix(j);break;case cc.Director.PROJECTION_CUSTOM:b._projectionDelegate&&b._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}b._projection=a,cc.eventManager.dispatchEvent(b._eventProjectionChanged),cc.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},a.setDepthTest=function(a){cc.renderer.setDepthTest(a)},a.setClearColor=function(a){cc.renderer._clearColor=a},a.setOpenGLView=function(a){var b=this;b._winSizeInPoints.width=cc._canvas.width,b._winSizeInPoints.height=cc._canvas.height,b._openGLView=a||cc.view;var c=cc.configuration;c.gatherGPUInfo(),c.dumpInfo(),b.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},a._clear=function(){var a=cc._renderContext;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},a.getVisibleSize=function(){return this._openGLView.getVisibleSize()},a.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},a.getZEye=function(){return this._winSizeInPoints.height/1.1566},a.setViewport=function(){var a=this._openGLView;if(a){var b=this._winSizeInPoints;a.setViewPortInPoints(-a._viewPortRect.x/a._scaleX,-a._viewPortRect.y/a._scaleY,b.width,b.height)}},a.getOpenGLView=function(){return this._openGLView},a.getProjection=function(){return this._projection},a.setAlphaBlending=function(a){a?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},a.setGLDefaultValues=function(){var a=this;a.setAlphaBlending(!0),a.setProjection(a._projection),cc._renderContext.clearColor(0,0,0,0)}}}),cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var a=this._valueDict;a["cocos2d.x.version"]=cc.ENGINE_VERSION,a["cocos2d.x.compiled_with_profiler"]=!1,a["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(a){return this._GlExtensions.indexOf(a)>-1},getValue:function(a,b){this._inited||this._init();var c=this._valueDict;return c[a]?c[a]:b},setValue:function(a,b){this._valueDict[a]=b},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var a=cc._renderContext,b=this._valueDict;b["gl.vendor"]=a.getParameter(a.VENDOR),b["gl.renderer"]=a.getParameter(a.RENDERER),b["gl.version"]=a.getParameter(a.VERSION),this._GlExtensions="";for(var c=a.getSupportedExtensions(),d=0;d<c.length;d++)this._GlExtensions+=c[d]+" ";this._maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),b["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),b["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),b["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,b["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),b["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),b["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),b["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(a){this._inited||this._init();var b=cc.loader.getRes(a);if(!b)throw new Error("Please load the resource first : "+a);cc.assert(b,cc._LogInfos.configuration_loadConfigFile_2,a);var c=b.data;if(!c)return void cc.log(cc._LogInfos.configuration_loadConfigFile,a);for(var d in c)this._valueDict[d]=c[d]}},cc.rendererWebGL=function(){function a(a){var b=cc._renderContext;if(d){b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d);for(var c=new Uint16Array(6*a),g=0,m=0,n=6*a;m<n;m+=6)c[m]=g+0,c[m+1]=g+1,c[m+2]=g+2,c[m+3]=g+1,c[m+4]=g+2,c[m+5]=g+3,g+=4;b.bufferData(b.ELEMENT_ARRAY_BUFFER,c,b.STATIC_DRAW)}if(e){j=4*a*h;var o=4*j;i=new ArrayBuffer(o),k=new Float32Array(i),l=new Uint32Array(i),b.bindBuffer(b.ARRAY_BUFFER,e),b.bufferData(b.ARRAY_BUFFER,k,b.DYNAMIC_DRAW)}f=4*a}function b(b){var c=cc._renderContext;null===d?(e=c.createBuffer(),d=c.createBuffer(),a(b)):a(b)}var c={texture:null,blendSrc:null,blendDst:null,shader:null},d=null,e=null,f=0,g=0,h=6,i=null,j=0,k=null,l=null,m=!1;return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),init:function(){var a=cc._renderContext;a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),b(2e3),cc.sys.os===cc.sys.OS_IOS&&(m=!0)},getVertexSize:function(){return f},getRenderCmd:function(a){return a._createRenderCmd()},_turnToCacheMode:function(a){this._isCacheToBufferOn=!0,a=a||0,this._cacheToBufferCmds[a]?this._cacheToBufferCmds[a].length=0:this._cacheToBufferCmds[a]=[],this._cacheInstanceIds.indexOf(a)===-1&&this._cacheInstanceIds.push(a),this._currentID=a},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(a){a=a||this._currentID;var b=this._cacheToBufferCmds[a];b&&(b.length=0,delete this._cacheToBufferCmds[a]);var c=this._cacheInstanceIds;cc.arrayRemoveObject(c,a)},_renderingToBuffer:function(a){a=a||this._currentID;var b=this._cacheToBufferCmds[a],c=cc._renderContext;this.rendering(c,b),this._removeCache(a);var d=this._cacheInstanceIds;0===d.length?this._isCacheToBufferOn=!1:this._currentID=d[d.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var a=this._transformNodePool;a.sort(this._sortNodeByLevelAsc);var b,c,d;for(b=0,c=a.length;b<c;b++)d=a[b],d.updateStatus();a.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(a,b){return a._curLevel-b._curLevel},pushDirtyNode:function(a){this._transformNodePool.push(a)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var a=cc._renderContext;a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},setDepthTest:function(a){var b=cc._renderContext;a?(b.clearDepth(1),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL)):b.disable(b.DEPTH_TEST)},pushRenderCommand:function(a){if(a.needDraw())if(this._isCacheToBufferOn){var b=this._currentID,c=this._cacheToBufferCmds,d=c[b];d.indexOf(a)===-1&&d.push(a)}else this._renderCmds.indexOf(a)===-1&&this._renderCmds.push(a)},_increaseBatchingSize:function(a){g+=a},_uploadBufferData:function(a){g>=f&&this._batchRendering();var b=a._node._texture,d=a._node._blendFunc.src,e=a._node._blendFunc.dst,i=a._shaderProgram;c.texture===b&&c.blendSrc===d&&c.blendDst===e&&c.shader===i||(this._batchRendering(),c.texture=b,c.blendSrc=d,c.blendDst=e,c.shader=i);var j=a.uploadData(k,l,g*h);j>0&&(g+=j)},_batchRendering:function(){if(0!==g&&c.texture){var a=cc._renderContext,b=c.texture,i=c.shader,j=g/4;i&&(i.use(),i._updateProjectionUniform()),cc.glBlendFunc(c.blendSrc,c.blendDst),cc.glBindTexture2DN(0,b);var l=!a.bindBuffer(a.ARRAY_BUFFER,e);if(g>.5*f)a.bufferData(a.ARRAY_BUFFER,k,a.DYNAMIC_DRAW);else{var m=k.subarray(0,g*h);a.bufferData(a.ARRAY_BUFFER,m,a.DYNAMIC_DRAW)}l&&(a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),a.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),a.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,a.FLOAT,!1,24,0),a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,24,12),a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,24,16)),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d),a.drawElements(a.TRIANGLES,6*j,a.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,g=0}},rendering:function(a,b){var d,e,f,h=b||this._renderCmds,i=a||cc._renderContext;for(i.bindBuffer(gl.ARRAY_BUFFER,null),d=0,e=h.length;d<e;++d)f=h[d],f.uploadData?this._uploadBufferData(f):(g>0&&this._batchRendering(),f.rendering(i));this._batchRendering(),c.texture=null}}}(),function(){cc.Node.WebGLRenderCmd=function(a){cc.Node.RenderCmd.call(this,a),this._shaderProgram=null};var a=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);a.constructor=cc.Node.WebGLRenderCmd,a._updateColor=function(){},a.setShaderProgram=function(a){this._shaderProgram=a},a.getShaderProgram=function(){return this._shaderProgram}}(),function(){cc.Layer.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a)};var a=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.Layer.WebGLRenderCmd,a.bake=function(){},a.unbake=function(){},a._bakeForAddChild=function(){}}(),function(){cc.LayerColor.WebGLRenderCmd=function(a){cc.Layer.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity();var b=this;b._squareVerticesAB=new ArrayBuffer(48),b._squareColorsAB=new ArrayBuffer(16);var c=b._squareVerticesAB,d=b._squareColorsAB,e=cc.Vertex3F.BYTES_PER_ELEMENT,f=cc.Color.BYTES_PER_ELEMENT;b._squareVertices=[new cc.Vertex3F(0,0,0,c,0),new cc.Vertex3F(0,0,0,c,e),new cc.Vertex3F(0,0,0,c,2*e),new cc.Vertex3F(0,0,0,c,3*e)],b._squareColors=[cc.color(0,0,0,255,d,0),cc.color(0,0,0,255,d,f),cc.color(0,0,0,255,d,2*f),cc.color(0,0,0,255,d,3*f)],b._verticesFloat32Buffer=cc._renderContext.createBuffer(),b._colorsUint8Buffer=cc._renderContext.createBuffer(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR)};var a=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);a.constructor=cc.LayerColor.WebGLRenderCmd,a.rendering=function(a){var b=a||cc._renderContext,c=this._node,d=this._worldTransform;this._matrix.mat[0]=d.a,this._matrix.mat[4]=d.c,this._matrix.mat[12]=d.tx,this._matrix.mat[1]=d.b,this._matrix.mat[5]=d.d,this._matrix.mat[13]=d.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst),b.bindBuffer(b.ARRAY_BUFFER,this._verticesFloat32Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._colorsUint8Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,0,0),b.drawArrays(b.TRIANGLE_STRIP,0,this._squareVertices.length)},a.transform=function(a,b){this.originTransform(a,b);var c=this._node,d=c._contentSize.width,e=c._contentSize.height,f=this._squareVertices;f[1].x=d,f[2].y=e,f[3].x=d,f[3].y=e,f[0].z=f[1].z=f[2].z=f[3].z=c._vertexZ,this._bindLayerVerticesBufferData()},a._updateColor=function(){for(var a=this._displayedColor,b=this._displayedOpacity,c=this._squareColors,d=0;d<4;d++)c[d].r=a.r,c[d].g=a.g,c[d].b=a.b,c[d].a=b;this._bindLayerColorsBufferData()},a._bindLayerVerticesBufferData=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._verticesFloat32Buffer),a.bufferData(a.ARRAY_BUFFER,this._squareVerticesAB,a.DYNAMIC_DRAW)},a._bindLayerColorsBufferData=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._colorsUint8Buffer),a.bufferData(a.ARRAY_BUFFER,this._squareColorsAB,a.STATIC_DRAW)},a.updateBlendFunc=function(a){}}(),function(){cc.LayerGradient.WebGLRenderCmd=function(a){cc.LayerColor.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._clipRect=new cc.Rect,this._clippingRectDirty=!1};var a=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);a.constructor=cc.LayerGradient.WebGLRenderCmd,a.updateStatus=function(){var a=cc.Node._dirtyFlags,b=this._dirtyFlag;b&a.gradientDirty&&(this._dirtyFlag|=a.colorDirty,this._updateVertex(),this._dirtyFlag=b&a.gradientDirty^b),cc.Node.RenderCmd.prototype.updateStatus.call(this)},a._syncStatus=function(a){var b=cc.Node._dirtyFlags,c=this._dirtyFlag;c&b.gradientDirty&&(this._dirtyFlag|=b.colorDirty,this._updateVertex(),this._dirtyFlag=c&b.gradientDirty^c),cc.Node.RenderCmd.prototype._syncStatus.call(this,a)},a.transform=function(a,b){this.originTransform(a,b),this._updateVertex()},a._updateVertex=function(){var a=this._node,b=a._colorStops;if(b&&!(b.length<2)){this._clippingRectDirty=!0;var c,d=b.length,e=2*d,f=a._contentSize,g=this._squareVertices;if(g.length<e){this._squareVerticesAB=new ArrayBuffer(12*e),g.length=0;var h=this._squareVerticesAB,i=cc.Vertex3F.BYTES_PER_ELEMENT;for(c=0;c<e;c++)g.push(new cc.Vertex3F(0,0,0,h,i*c))}var j=Math.PI+cc.pAngleSigned(cc.p(0,-1),a._alongVector),k=cc.p(f.width/2,f.height/2),l=Math.round(cc.radiansToDegrees(j)),m=cc.affineTransformMake(1,0,0,1,k.x,k.y);m=cc.affineTransformRotate(m,j);var n,o;l<90?(n=cc.p(-k.x,k.y),o=cc.p(k.x,k.y)):l<180?(n=cc.p(k.x,k.y),o=cc.p(k.x,-k.y)):l<270?(n=cc.p(k.x,-k.y),o=cc.p(-k.x,-k.y)):(n=cc.p(-k.x,-k.y),o=cc.p(-k.x,k.y));var p=Math.sin(j),q=Math.cos(j),r=Math.abs((n.x*q-n.y*p)/k.x),s=Math.abs((o.x*p+o.y*q)/k.y);for(m=cc.affineTransformScale(m,r,s),c=0;c<d;c++){var t=b[c],u=t.p*f.height,v=cc.pointApplyAffineTransform(-k.x,u-k.y,m);g[2*c].x=v.x,g[2*c].y=v.y,g[2*c].z=a._vertexZ;var w=cc.pointApplyAffineTransform(f.width-k.x,u-k.y,m);g[2*c+1].x=w.x,g[2*c+1].y=w.y,g[2*c+1].z=a._vertexZ}this._bindLayerVerticesBufferData()}},a._updateColor=function(){var a=this._node,b=a._colorStops;if(b&&!(b.length<2)){var c=b.length,d=this._squareColors,e=2*c;if(d.length<e){this._squareColorsAB=new ArrayBuffer(4*e),d.length=0;var f=this._squareColorsAB,g=cc.Color.BYTES_PER_ELEMENT;for(i=0;i<e;i++)d.push(cc.color(0,0,0,255,f,g*i))}var h=this._displayedOpacity/255;for(i=0;i<c;i++){var j=b[i].color,k=d[2*i],l=d[2*i+1];k.r=j.r,k.g=j.g,k.b=j.b,k.a=j.a*h,l.r=j.r,l.g=j.g,l.b=j.b,l.a=j.a*h}this._bindLayerColorsBufferData()}},a.rendering=function(a){var b=a||cc._renderContext,c=this._node,d=this._getClippingRect();b.enable(b.SCISSOR_TEST),cc.view.setScissorInPoints(d.x,d.y,d.width,d.height);var e=this._worldTransform;this._matrix.mat[0]=e.a,this._matrix.mat[4]=e.c,this._matrix.mat[12]=e.tx,this._matrix.mat[1]=e.b,this._matrix.mat[5]=e.d,this._matrix.mat[13]=e.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst),b.bindBuffer(b.ARRAY_BUFFER,this._verticesFloat32Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._colorsUint8Buffer),b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,0,0),b.drawArrays(b.TRIANGLE_STRIP,0,this._squareVertices.length),b.disable(b.SCISSOR_TEST)},a._getClippingRect=function(){if(this._clippingRectDirty){var a=this._node,b=cc.rect(0,0,a._contentSize.width,a._contentSize.height),c=a.getNodeToWorldTransform();this._clipRect=cc._rectApplyAffineTransformIn(b,c)}return this._clipRect}}(),function(){cc.Sprite.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._color=new Uint32Array(1),this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)};var a=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.Sprite.WebGLRenderCmd,a.updateBlendFunc=function(a){},a.setDirtyFlag=function(a){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,a),this._dirty=!0},a.setDirtyRecursively=function(a){this._recursiveDirty=a,this._dirty=a;for(var b,c=this._node._children,d=c?c.length:0,e=0;e<d;e++)b=c[e],b instanceof cc.Sprite&&b._renderCmd.setDirtyRecursively(a)},a._setBatchNodeForAddChild=function(a){var b=this._node;if(b._batchNode){if(!(a instanceof cc.Sprite))return cc.log(cc._LogInfos.Sprite_addChild),!1;a.texture._webTextureObj!==b.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2),b._batchNode.appendChild(a),b._reorderChildDirty||b._setReorderChildDirtyRecursively()}return!0},a._handleTextureForRotatedTexture=function(a){return a},a.isFrameDisplayed=function(a){var b=this._node;return cc.rectEqualToRect(a.getRect(),b._rect)&&a.getTexture().getName()===b._texture.getName()&&cc.pointEqualToPoint(a.getOffset(),b._unflippedOffsetPositionFromCenter)},a._textureLoadedCallback=function(a){if(!this._textureLoaded){this._textureLoaded=!0;var b=this._rect;b?cc._rectEqualToZero(b)&&(b.width=a.width,b.height=a.height):b=cc.rect(0,0,a.width,a.height),this.texture=a,this.setTextureRect(b,this._rectRotated),this.setBatchNode(this._batchNode),this.dispatchEvent("load"),cc.renderer.childrenOrderDirty=!0}},a._setTextureCoords=function(a,b){void 0===b&&(b=!0),b&&(a=cc.rectPointsToPixels(a));var c=this._node,d=c._batchNode?c.textureAtlas.texture:c._texture,e=this._vertices;if(d){var f,g,h,i,j,k=d.pixelsWidth,l=d.pixelsHeight;c._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*a.x+1)/(2*k),g=f+(2*a.height-2)/(2*k),h=(2*a.y+1)/(2*l),i=h+(2*a.width-2)/(2*l)):(f=a.x/k,g=(a.x+a.height)/k,h=a.y/l,i=(a.y+a.width)/l),c._flippedX&&(j=h,h=i,i=j),c._flippedY&&(j=f,f=g,g=j),e[0].u=g,e[0].v=h,e[1].u=f,e[1].v=h,e[2].u=g,e[2].v=i,e[3].u=f,e[3].v=i):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*a.x+1)/(2*k),g=f+(2*a.width-2)/(2*k),h=(2*a.y+1)/(2*l),i=h+(2*a.height-2)/(2*l)):(f=a.x/k,g=(a.x+a.width)/k,h=a.y/l,i=(a.y+a.height)/l),c._flippedX&&(j=f,f=g,g=j),c._flippedY&&(j=h,h=i,i=j),e[0].u=f,e[0].v=h,e[1].u=f,e[1].v=i,e[2].u=g,e[2].v=h,e[3].u=g,e[3].v=i)}},a._setColorDirty=function(){},a._updateBlendFunc=function(){if(this._batchNode)return void cc.log(cc._LogInfos.Sprite__updateBlendFunc);var a=this._node,b=a._blendFunc;a._texture&&a._texture.hasPremultipliedAlpha()?(b.src===cc.SRC_ALPHA&&b.dst===cc.BLEND_DST&&(b.src=cc.ONE),a.opacityModifyRGB=!0):(b.src===cc.ONE&&b.dst===cc.BLEND_DST&&(b.src=cc.SRC_ALPHA),a.opacityModifyRGB=!1)},a._setTexture=function(a){var b=this._node;if(b._batchNode){if(b._batchNode.texture!==a)return void cc.log(cc._LogInfos.Sprite_setTexture)}else b._texture!==a&&(b._textureLoaded=!!a&&a._textureLoaded,b._texture=a,this._updateBlendFunc(),b._textureLoaded&&(cc.renderer.childrenOrderDirty=!0))},a._checkTextureBoundary=function(a,b,c){if(a&&a.url){var d,e;c?(d=b.x+b.height,e=b.y+b.width):(d=b.x+b.width,e=b.y+b.height),d>a.width&&cc.error(cc._LogInfos.RectWidth,a.url),e>a.height&&cc.error(cc._LogInfos.RectHeight,a.url)}},a.transform=function(a,b){this.originTransform(a,b);var c=this._node,d=c._offsetPosition.x,e=d+c._rect.width,f=c._offsetPosition.y,g=f+c._rect.height,h=this._worldTransform,i=this._vertices;i[0].x=d*h.a+g*h.c+h.tx,i[0].y=d*h.b+g*h.d+h.ty,i[1].x=d*h.a+f*h.c+h.tx,i[1].y=d*h.b+f*h.d+h.ty,i[2].x=e*h.a+g*h.c+h.tx,i[2].y=e*h.b+g*h.d+h.ty,i[3].x=e*h.a+f*h.c+h.tx,i[3].y=e*h.b+f*h.d+h.ty},a.needDraw=function(){var a=this._node,b=a._texture;return this._needDraw&&b},a.uploadData=function(a,b,c){var d=this._node,e=d._texture;if(!(e&&e._textureLoaded&&d._rect.width&&d._rect.height&&this._displayedOpacity))return!1;var f=this._displayedOpacity,g=this._displayedColor.r,h=this._displayedColor.g,i=this._displayedColor.b;if(d._opacityModifyRGB){var j=f/255;g*=j,h*=j,i*=j}this._color[0]=f<<24|i<<16|h<<8|g;var k,l,m=d._vertexZ,n=this._vertices,o=n.length,p=c;for(k=0;k<o;++k)l=n[k],a[p]=l.x,a[p+1]=l.y,a[p+2]=m,b[p+3]=this._color[0],a[p+4]=l.u,a[p+5]=l.v,p+=6;return o}}(),function(){cc.LabelTTF.WebGLRenderCmd=function(a){cc.Sprite.WebGLRenderCmd.call(this,a),cc.LabelTTF.CacheRenderCmd.call(this)};var a=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,a),a.constructor=cc.LabelTTF.WebGLRenderCmd,a._updateColor=function(){}}(),cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(a){if(null==a&&(a=cc._renderContext),!a instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=a,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var a=this;a._initialized||(a._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),a._shader._addUniformLocation(this._colorLocation),a._shader._addUniformLocation(this._pointSizeLocation),a._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(a){this.lazy_init();var b=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c),b.bufferData(b.ARRAY_BUFFER,new Float32Array([a.x,a.y]),b.STATIC_DRAW),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0),b.drawArrays(b.POINTS,0,1),b.deleteBuffer(c),cc.incrementGLDraws(1)},drawPoints:function(a,b){if(a&&0!==a.length){this.lazy_init();var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d),c.bufferData(c.ARRAY_BUFFER,this._pointsToTypeArray(a),c.STATIC_DRAW),c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.POINTS,0,a.length),c.deleteBuffer(d),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(a){for(var b=new Float32Array(2*a.length),c=0;c<a.length;c++)b[2*c]=a[c].x,b[2*c+1]=a[c].y;return b},drawLine:function(a,b){this.lazy_init();var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d),c.bufferData(c.ARRAY_BUFFER,this._pointsToTypeArray([a,b]),c.STATIC_DRAW),c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINES,0,2),c.deleteBuffer(d),cc.incrementGLDraws(1)},drawRect:function(a,b){this.drawLine(cc.p(a.x,a.y),cc.p(b.x,a.y)),this.drawLine(cc.p(b.x,a.y),cc.p(b.x,b.y)),this.drawLine(cc.p(b.x,b.y),cc.p(a.x,b.y)),this.drawLine(cc.p(a.x,b.y),cc.p(a.x,a.y))},drawSolidRect:function(a,b,c){var d=[a,cc.p(b.x,a.y),b,cc.p(a.x,b.y)];this.drawSolidPoly(d,4,c)},drawPoly:function(a,b,c){this.lazy_init();var d=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),d.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var e=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,e),d.bufferData(d.ARRAY_BUFFER,this._pointsToTypeArray(a),d.STATIC_DRAW),d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0),c?d.drawArrays(d.LINE_LOOP,0,a.length):d.drawArrays(d.LINE_STRIP,0,a.length),d.deleteBuffer(e),cc.incrementGLDraws(1)},drawSolidPoly:function(a,b,c){this.lazy_init(),c&&this.setDrawColor(c.r,c.g,c.b,c.a);var d=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),d.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var e=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,e),d.bufferData(d.ARRAY_BUFFER,this._pointsToTypeArray(a),d.STATIC_DRAW),d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0),d.drawArrays(d.TRIANGLE_FAN,0,a.length),d.deleteBuffer(e),cc.incrementGLDraws(1)},drawCircle:function(a,b,c,d,e){this.lazy_init();var f=1;e&&f++;var g=2*Math.PI/d,h=new Float32Array(2*(d+2));if(h){for(var i=0;i<=d;i++){var j=i*g,k=b*Math.cos(j+c)+a.x,l=b*Math.sin(j+c)+a.y;h[2*i]=k,h[2*i+1]=l}h[2*(d+1)]=a.x,h[2*(d+1)+1]=a.y;var m=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),m.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var n=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,n),m.bufferData(m.ARRAY_BUFFER,h,m.STATIC_DRAW),m.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,m.FLOAT,!1,0,0),m.drawArrays(m.LINE_STRIP,0,d+f),m.deleteBuffer(n),cc.incrementGLDraws(1)}},drawQuadBezier:function(a,b,c,d){this.lazy_init();for(var e=new Float32Array(2*(d+1)),f=0,g=0;g<d;g++)e[2*g]=Math.pow(1-f,2)*a.x+2*(1-f)*f*b.x+f*f*c.x,e[2*g+1]=Math.pow(1-f,2)*a.y+2*(1-f)*f*b.y+f*f*c.y,f+=1/d;e[2*d]=c.x,e[2*d+1]=c.y;var h=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),h.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var i=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,i),h.bufferData(h.ARRAY_BUFFER,e,h.STATIC_DRAW),h.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),h.drawArrays(h.LINE_STRIP,0,d+1),h.deleteBuffer(i),cc.incrementGLDraws(1)},drawCubicBezier:function(a,b,c,d,e){this.lazy_init();for(var f=new Float32Array(2*(e+1)),g=0,h=0;h<e;h++)f[2*h]=Math.pow(1-g,3)*a.x+3*Math.pow(1-g,2)*g*b.x+3*(1-g)*g*g*c.x+g*g*g*d.x,f[2*h+1]=Math.pow(1-g,3)*a.y+3*Math.pow(1-g,2)*g*b.y+3*(1-g)*g*g*c.y+g*g*g*d.y,g+=1/e;f[2*e]=d.x,f[2*e+1]=d.y;var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var j=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,j),i.bufferData(i.ARRAY_BUFFER,f,i.STATIC_DRAW),i.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINE_STRIP,0,e+1),i.deleteBuffer(j),cc.incrementGLDraws(1)},drawCatmullRom:function(a,b){this.drawCardinalSpline(a,.5,b)},drawCardinalSpline:function(a,b,c){this.lazy_init();for(var d,e,f=new Float32Array(2*(c+1)),g=1/a.length,h=0;h<c+1;h++){var i=h/c;1===i?(d=a.length-1,e=1):(d=0|i/g,e=(i-g*d)/g);var j=cc.cardinalSplineAt(cc.getControlPointAt(a,d-1),cc.getControlPointAt(a,d),cc.getControlPointAt(a,d+1),cc.getControlPointAt(a,d+2),b,e);f[2*h]=j.x,f[2*h+1]=j.y}var k=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),k.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var l=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,l),k.bufferData(k.ARRAY_BUFFER,f,k.STATIC_DRAW),k.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,k.FLOAT,!1,0,0),k.drawArrays(k.LINE_STRIP,0,c+1),k.deleteBuffer(l),cc.incrementGLDraws(1)},setDrawColor:function(a,b,c,d){this._colorArray[0]=a/255,this._colorArray[1]=b/255,this._colorArray[2]=c/255,this._colorArray[3]=d/255},setPointSize:function(a){this._pointSize=a*cc.contentScaleFactor()},setLineWidth:function(a){this._renderContext.lineWidth&&this._renderContext.lineWidth(a)}});